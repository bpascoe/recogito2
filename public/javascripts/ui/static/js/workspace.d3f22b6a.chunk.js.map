{"version":3,"sources":["common/header/Breadcrumbs.jsx","common/documents/Readme.jsx","common/account/IdentityInfo.jsx","common/account/ActivityHistory.jsx","common/account/TopCollaborators.jsx","common/documents/table/rows/BaseRowComponent.jsx","common/documents/table/rows/DocumentRow.jsx","common/documents/table/rows/FolderRow.jsx","common/documents/table/rows/HeaderRow.jsx","common/documents/table/preferences/ColumnOrder.jsx","common/documents/table/preferences/PreferencesModal.jsx","common/documents/table/TablePane.jsx","common/documents/grid/Document.jsx","common/documents/grid/Folder.jsx","common/documents/grid/GridPane.jsx","common/documents/table/Columns.js","common/Modal.jsx","common/documents/Selection.js","common/account/Avatar.jsx","common/documents/FiledropHint.jsx","workspace/initialState.js","workspace/operations/ModalForm.jsx","workspace/operations/folder/index.js","common/Meter.jsx","workspace/operations/importing/ImportProgressModal.jsx","workspace/operations/importing/Importer.jsx","workspace/operations/importing/shine/SHINEModal.jsx","workspace/operations/importing/index.js","workspace/operations/ner/progress/NERProgressModal.jsx","workspace/operations/ner/configuration/authorities/AuthoritySelection.jsx","workspace/operations/ner/configuration/engines/EngineSelection.jsx","workspace/operations/ner/configuration/NERConfigurationModal.jsx","workspace/operations/ner/EntityRecognition.jsx","workspace/operations/readme/index.js","workspace/operations/move/FolderBrowser.jsx","workspace/operations/prompt.js","workspace/operations/alert.js","workspace/operations/sharing/public/PublicAccess.jsx","workspace/operations/sharing/collaborators/PermissionSelector.js","common/UserSearch.jsx","workspace/operations/sharing/collaborators/Collaborators.jsx","workspace/operations/sharing/copies/DistributeCopies.jsx","workspace/operations/sharing/ShareModal.jsx","workspace/operations/network/NetworkModal.js","workspace/operations/index.js","workspace/operations/importing/shine/index.js","workspace/operations/selection/index.js","workspace/operations/move/index.js","workspace/operations/sharing/index.js","workspace/operations/network/index.js","workspace/operations/ner/index.js","common/Menu.jsx","workspace/header/search/AdvancedSearch.jsx","workspace/header/search/Search.jsx","workspace/header/Header.jsx","workspace/sidebar/sections/Account.jsx","workspace/sidebar/sections/NewContent.jsx","workspace/sidebar/sections/Views.jsx","workspace/sidebar/sections/Storage.jsx","workspace/sidebar/sections/MyActivity.jsx","workspace/sidebar/Sidebar.jsx","workspace/Workspace.jsx","workspace/App.jsx","common/documents/table/rows/TypeIcons.js","common/header/HeaderIcon.jsx"],"names":["react__WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","react__WEBPACK_IMPORTED_MODULE_0___default","n","VIEW_LABELS","MY_DOCUMENTS","SHARED_WITH_ME","SEARCH","Breadcrumbs","props","title","view","label","a","createElement","className","href","path","map","b","concat","id","key","docCount","undefined","children","INITIAL_STATE","editing","modifiedContent","Readme","state","onKeydown","evt","which","_this","onCancel","ctrlKey","onSave","document","addEventListener","this","setState","_","value","removeEventListener","onDelete","onUpdate","content","react__WEBPACK_IMPORTED_MODULE_5___default","react_markdown__WEBPACK_IMPORTED_MODULE_6___default","source","onClick","onEdit","bind","react_sane_contenteditable__WEBPACK_IMPORTED_MODULE_7__","tagName","editable","multiLine","onChange","editOnOpen","renderEdit","renderView","Component","IdentityInfo","url","replace","dataAvailable","account","username","member_since","_Avatar_jsx__WEBPACK_IMPORTED_MODULE_6__","real_name","Fragment","Intl","DateTimeFormat","year","month","day","format","Date","bio","website","formatURL","LINE_STYLE","stroke","strokeWidth","AXIS_STYLE","fontSize","color","tickFormatter","tick","ActivityHistory","toTimestamp","empty","Array","fill","reduce","arr","last","length","push","reverse","timestamp","t","toTime","getTime","createEmptySeries","timeseries","stats","over_time","parse","date","padTimeseries","react_number_format__WEBPACK_IMPORTED_MODULE_10___default","displayType","total_contributions","thousandSeparator","recharts__WEBPACK_IMPORTED_MODULE_6__","width","height","barCategoryGap","data","computeChart","recharts__WEBPACK_IMPORTED_MODULE_7__","strokeDasharray","horizontal","recharts__WEBPACK_IMPORTED_MODULE_8__","type","dataKey","axisLine","tickSize","tickCount","tickLine","domain","padding","left","right","recharts__WEBPACK_IMPORTED_MODULE_9__","TopCollaborators","collaborators","fetchCollaborators","_this2","axios","get","then","result","user","_Avatar_jsx__WEBPACK_IMPORTED_MODULE_7__","BaseRowComponent","Object","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","updateTotalRowSpan","next","_totalSpan","columns","total","field","Columns","getSpan","FORMATTERS","language","toUpperCase","uploaded_at","datetime","last_edit_at","react_default","lib_default","public_visibility","visibility","access_level","level","annotations","number_format_default","status_ratio","ratio","verified","unverified","not_identifiable","pctGreen","pctYellow","labels","tooltip","count","slice","style","cloned_from","clonedFrom","has_clones","hasClones","AGGREGATE_FIELDS","agg_document","item","author","DocumentRow","substring","prototype","formatter","filetypes","selected","startsWith","createAggregateField","createField","src","Icons","alt","FolderRow","makeEditable","_input","select","preventDefault","stopPropagation","target","onKeyPress","onRename","ref","i","onKeyDown","HeaderRow","onSort","HEADER_NAMES","sortColumn","sortAsc","SortableItem","SortableElement","_ref","SortableList","SortableContainer","_ref2","items","idx","index","ColumnOrder","onSortEnd","e","oldIndex","newIndex","PreferencesModal","states","COLUMNS","forEach","isChecked","includes","checked","_this3","toAppend","filter","checkAll","setAllRows","name","prev","indexOf","splice","arrayMove","_this4","Modal","onClose","onClickAll","toggleOne","htmlFor","ColumnOrder_ColumnOrder","TablePane","drag","tablePreferencesOpen","showPreferences","visible","onSavePreferences","onChangeColumnConfig","sortBy","asc","config","sorting","by","onDrag","active","onDrop","files","dataTransfer","getData","hostname","onDropFiles","window","location","onDropSourceURL","args","selection","FolderRow_FolderRow","onRowClick","onRenameFolder","DocumentRow_DocumentRow","handleClick","onSelect","tablePane","es","rowCount","rowHeight","rowRenderer","FiledropHint","busy","HeaderRow_HeaderRow","enableFiledrop","dist_es","disableClick","onDragEnter","onDragLeave","PreferencesModal_PreferencesModal","Document","isStacked","fileCount","Folder","GridPane","itemsPerRow","fromIndex","itemsInRow","Math","min","renderedItems","rowIdx","Folder_Folder","onTileClick","Document_Document","file_count","gridPane","floor","ceil","disableFiledrop","COLUMNS_SHARED_WITH_ME","date_freeform","last_edit_by","owner","shared_by","COLUMN_WIDTH","AGGREGATE_COLUMNS","_home_simonr_Workspaces_pelagios_recogito2_workspace_frontend_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","_home_simonr_Workspaces_pelagios_recogito2_workspace_frontend_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__","w","c","react_draggable__WEBPACK_IMPORTED_MODULE_6___default","handle","Selection","selectedItems","selectItem","isCtrlPressed","thisIdx","_selection","isSelected","cloned","selectRange","allItems","toIdx","selectedIndices","minIdx","apply","maxIdx","max","isOutside","from","to","find","ft","isShift","getModifierState","isCtrl","newSelection","Avatar","str","hash","charCodeAt","stringToHslColor","backgroundColor","charAt","AnimatedDiv","posed","div","open","bottom","transition","ease","duration","closed","pose","DEFAULT_STATE","presentation","search_scope","page","breadcrumbs","readme","total_count","table_config","initialState","stored","localStorage","getItem","JSON","objectSpread","persistState","prefixed","setItem","stringify","ModalForm","handleKeydown","onOk","CreateFolderForm","folderName","ModalForm_ModalForm","autoFocus","placeholder","Meter","position","FileProgress","upload","file","status","ImportProgressModal","totalLoaded","uploads","u","progress","errors","error","phase","ImportProgressModal_FileProgress","join","Meter_Meter","totalSize","Uploader","updateUploadState","diff","initNewDocument","formdata","FormData","append","post","headers","X-Requested-With","uploadFiles","requests","uploadId","onUploadProgress","loaded","filepartId","uuid","catch","response","Promise","all","finalizeDocument","withError","currentFolder","tasks","running_tasks","pollTaskProgress","document_id","onComplete","documentId","taskTypes","subtasks","filepart_id","isComplete","setTimeout","start","f","size","remoteSource","sourceType","importRemoteSource","importing_ImportProgressModal","SHINEModal","SHINEFileUpload","convertedFiles","newFile","File","onUploadFiles","handleSHINEModalClick","styles","shineModal","shineBrowserContainer","index_es","primary","borderRadius","fontFamily","text","close","handleFileUpload","zIndex","top","display","alignItems","justifyContent","maxHeight","maxWidth","margin","boxShadow","URLInputForm","importContent","resolve","container","body","appendChild","render","Importer_Uploader","remove","NERProgressModal","tasksCompleted","pollProgress","jobId","tasksFailed","isDone","AuthoritySelection","identifier","currentIdx","useAll","onToggleAll","authorities","authority","homepage","rel","shortname","fullname","EngineSelection","cellSpacing","engines","engine","group","languages","lang","description","NERModal","available_engines","available_authorities","selected_engine","selected_all_authorities","selected_authorities","initAvailableAuthorities","initAvailableEngines","all_authorities","onStart","EngineSelection_EngineSelection","changeEngine","AuthoritySelection_AuthoritySelection","toggleAllAuthorities","changeAuthorities","EntityRecognition","running","textDocuments","getItems","isDocument","hasTextParts","taskDefinition","task_type","documents","d","job_id","NERProgressModal_NERProgressModal","NERConfigurationModal_NERModal","getUrl","currentFolderId","TITLES","FolderItem","has_subfolders","onNavigateInto","DisabledDocumentItem","docType","FolderBrowser","pageToState","parent","goToFolder","goToViewsOverview","navigateUp","navigateInto","folderId","move","destination","getDocuments","folders","getFolders","fDocs","put","action","fFolders","FolderBrowser_DisabledDocumentItem","FolderBrowser_FolderItem","react_draggable_default","ReactCSSTransitionReplace_default","transitionName","transitionEnterTimeout","transitionLeaveTimeout","disabled","Prompt","onNo","toLowerCase","message","onYes","prompt","promptRoot","setAttribute","prompt_Prompt","onConfirm","Alert","PublicAccess","updateSetting","update","ids","onChangeVisibility","onChangeAccessLevel","_result$data","PermissionSelector","onMousedown","_node","contains","handleCancel","onChangeLevel","changeLevel","accessLevel","UserSearch","isLoading","options","inputValue","fetchSuggestions","query","exclude","onInputChange","clear","getInstance","_this$state","lib","r","onSearch","Collaborators","storeCollaborator","setting","openPermissionsSelector","collaborator","root","PermissionSelector_PermissionSelector","openSelector","nodeName","parentNode","removeCollaborator","delete","addCollaborator","toConsumableArray","UserSearch_UserSearch","DistributeCopies","recipients","removeRecipient","recipient","addRecipient","sendCopies","ShareModal","setView","getView","PublicAccess_PublicAccess","Collaborators_Collaborators","DistributeCopies_DistributeCopies","NetworkTreeNode","edits_since","merge","onMergeComplete","cloned_at","encodeURIComponent","contributions","feature_toggles","doc","assign","NetworkModal","network","_this5","docId","NetworkModal_NetworkTreeNode","operations","createFolder","folder_CreateFolderForm","renameFolder","folder","importSource","typ","endsWith","identifySource","onResolve","shine_SHINEModal","done","importing_URLInputForm","updateReadme","currentPageState","deleteReadme","deleteSelection","onSuccess","onError","deleteDocuments","deleteFolders","moveSelection","FolderBrowser_FolderBrowser","duplicateSelection","isSingleDocument","alert_Alert","alert","shareSelection","ShareModal_ShareModal","exploreNetwork","NetworkModal_NetworkModal","entityRecognition","EntityRecognition_EntityRecognition","Menu","assertThisInitialized","Group","classNames","Item","link","icon","in","lastModified","AdvancedSearch","onChangeSearchIn","onChangeDocType","onChangeOwner","onChangeQuery","onChangeLastModified","onClear","isClickOutside","isClickOnToggle","classList","searchIn","SCOPE_NAMES","Search","searchScope","onQuit","toggleAdvancedSearch","advancedSearchOpen","executeSearch","tableConfig","onResponse","scope","q","advancedSearch","settings","_rootEl","getElementById","AdvancedSearch_AdvancedSearch","OptionsMenu","canDuplicate","canShare","isSingleFolder","hasNetwork","common_Menu","isSingleSelection","onMoveSelection","onDuplicateSelection","onDeleteSelection","onShareSelection","onExploreNetwork","includesText","onNER","Header","optionsMenuVisible","showOptionsMenu","closeOptionsMenu","closeAndThen","fn","hasSelection","isEmpty","Search_Search","onSearchResponse","onQuitSearch","HeaderIcon","onCreateReadme","react_transition_group","timeout","Header_OptionsMenu","onTogglePresentation","Account","menuVisible","openMenu","closeMenu","NewContent","onOpenMenu","onCloseMenu","onOpenFileExplorer","click","hasFeature","multiple","onCreateFolder","onImportSource","ViewListItem","current","Views","Views_ViewListItem","onChangeView","Storage","storage","quota","quota_mb","used","used_mb","MyActivity","Sidebar","Account_Account","NewContent_NewContent","sections_Views","sections_Storage","sections_MyActivity","Workspace","sidebar_Sidebar","Header_Header","onUpdateReadme","onDeleteReadme","onSortTable","App","querySelector","refreshPage","expandAggregatedColumns","sort","changeFolder","changeView","togglePresentation","sortTable","changeColumConfig","createReadme","onhashchange","workspace_Workspace","App_App","ICONS","TEXT_PLAIN","TEXT_TEIXML","IMAGE_UPLOAD","IMAGE_IIIF","DATA_CSV","TypeIcons"],"mappings":"0FAAA,IAAAA,EAAAC,EAAA,GAAAC,EAAAD,EAAAE,EAAAH,GAEMI,EAAc,CAClBC,aAAc,eACdC,eAAgB,iBAChBC,OAAQ,kBAwBKC,IArBK,SAAAC,GAClB,IAAMC,EAAQD,EAAME,KAAOP,EAAYK,EAAME,MAAQF,EAAMG,MAE3D,OACEV,EAAAW,EAAAC,cAAA,OAAKC,UAAU,eACbb,EAAAW,EAAAC,cAAA,UACEZ,EAAAW,EAAAC,cAAA,KAAGC,UAAU,OAAOC,KAAK,KAAKN,GAC7BD,EAAMQ,MAAQR,EAAMQ,KAAKC,IAAI,SAAAC,GAAC,OAC7BjB,EAAAW,EAAAC,cAAA,KAAGC,UAAU,SAASC,KAAI,IAAAI,OAAMD,EAAEE,IAAMC,IAAKH,EAAEE,IAAKF,EAAET,UAIrC,OAAnBD,EAAMc,eAAwCC,IAAnBf,EAAMc,UACjCrB,EAAAW,EAAAC,cAAA,QAAMC,UAAU,SAAhB,IAAAK,OAA6BX,EAAMc,SAAnC,MAEAd,EAAMgB,+JCnBRC,EAAgB,CACpBC,SAAS,EACTC,gBAAiB,MAGEC,6MAEnBC,MAAQ,KAERC,UAAY,SAACC,GACO,KAAdA,EAAIC,MACNC,EAAKC,WACEH,EAAII,SAAyB,KAAdJ,EAAIC,OAC1BC,EAAKG,kFAIPC,SAASC,iBAAiB,UAAWC,KAAKT,WAAW,GACrDS,KAAKC,SAAS,CAAEd,SAAS,qCAGlBe,EAAGC,GACVH,KAAKC,SAAS,CAAEb,gBAAiBe,uCAIjCL,SAASM,oBAAoB,UAAWJ,KAAKT,WAAW,GACxDS,KAAK/B,MAAMoC,UAAYL,KAAK/B,MAAMoC,4CAIlCP,SAASM,oBAAoB,UAAWJ,KAAKT,WAAW,GACxDS,KAAK/B,MAAMqC,UAAYN,KAAK/B,MAAMqC,SAASN,KAAKV,MAAMF,iBACtDY,KAAKC,SAASf,sCAIdY,SAASM,oBAAoB,UAAWJ,KAAKT,WAAW,GACtB,mBAAvBS,KAAK/B,MAAMsC,QACpBP,KAAKK,WAELL,KAAKC,SAASf,sCAGPqB,GACT,OACEC,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,UACbiC,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,WACbiC,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,WACbiC,EAAAnC,EAAAC,cAACmC,EAAApC,EAAD,CAAeqC,OAAQH,KAGxBP,KAAK/B,MAAMqC,UAAYN,KAAK/B,MAAMoC,UACjCG,EAAAnC,EAAAC,cAAA,QAAMC,UAAU,kBACdiC,EAAAnC,EAAAC,cAAA,UACEC,UAAU,eACVL,MAAM,OACNyC,QAASX,KAAKY,OAAOC,KAAKb,OAH5B,gDAWDO,GACT,OACEC,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,kBACbiC,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,WACbiC,EAAAnC,EAAAC,cAACwC,EAAA,EAAD,CACEC,QAAQ,MACRxC,UAAU,UACVgC,QAASA,EACTS,UAAU,EACVC,WAAW,EACXC,SAAUlB,KAAKkB,SAASL,KAAKb,QAE/BQ,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,WACbiC,EAAAnC,EAAAC,cAAA,QAAMC,UAAU,QAAhB,yBAA6CiC,EAAAnC,EAAAC,cAAA,KAAGE,KAAK,MAAR,aAC7CgC,EAAAnC,EAAAC,cAAA,QAAMC,UAAU,WACdiC,EAAAnC,EAAAC,cAAA,UACEC,UAAU,gBACVoC,QAASX,KAAKK,SAASQ,KAAKb,OAF9B,sBAIAQ,EAAAnC,EAAAC,cAAA,UACEC,UAAU,eACVoC,QAASX,KAAKH,OAAOgB,KAAKb,OAF5B,UAIAQ,EAAAnC,EAAAC,cAAA,UACEC,UAAU,eACVoC,QAASX,KAAKL,SAASkB,KAAKb,OAF9B,+CAWV,IAAMmB,EAA2C,mBAAvBnB,KAAK/B,MAAMsC,QAEjCY,GACFrB,SAASC,iBAAiB,UAAWC,KAAKT,WAAW,GAEvD,IAAMgB,EAAUY,EAAa,GAC1BnB,KAAKV,MAAMF,gBAAkBY,KAAKV,MAAMF,gBAAkBY,KAAK/B,MAAMsC,QAExE,OAAQP,KAAKV,MAAMH,SAAWgC,EAAcnB,KAAKoB,WAAWb,GAAWP,KAAKqB,WAAWd,UAtGvDe,8ICLfC,oLAETC,GACR,OAAOA,EAAIC,QAAQ,gBAAiB,qCAIpC,IAAMC,EACJ1B,KAAK/B,MAAM0D,SACX3B,KAAK/B,MAAM0D,QAAQC,UACnB5B,KAAK/B,MAAM0D,QAAQE,aAErB,OACErB,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,YACbiC,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,QACbiC,EAAAnC,EAAAC,cAACwD,EAAA,EAAD,CAAQF,SAAUF,GAAiB1B,KAAK/B,MAAM0D,QAAQC,WAEtDpB,EAAAnC,EAAAC,cAAA,UACIoD,EACI1B,KAAK/B,MAAM0D,QAAQI,UACnB/B,KAAK/B,MAAM0D,QAAQI,UAAY/B,KAAK/B,MAAM0D,QAAQC,SAEnDpB,EAAAnC,EAAAC,cAAA,QAAMC,UAAU,iBAGvBiC,EAAAnC,EAAAC,cAAA,KAAGC,UAAU,gBACTmD,EACAlB,EAAAnC,EAAAC,cAACkC,EAAAnC,EAAM2D,SAAP,kBACc,IAAIC,KAAKC,eAAe,QAAS,CAC3CC,KAAO,UACPC,MAAO,QACPC,IAAO,YACNC,OAAO,IAAIC,KAAKvC,KAAK/B,MAAM0D,QAAQE,gBACpBrB,EAAAnC,EAAAC,cAAA,QAAMC,UAAU,kBAK1CiC,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,iBACXmD,GAAiB1B,KAAK/B,MAAM0D,QAAQa,KACpChC,EAAAnC,EAAAC,cAAA,KAAGC,UAAU,OAAOyB,KAAK/B,MAAM0D,QAAQa,KAEvCd,GAAiB1B,KAAK/B,MAAM0D,QAAQc,SACpCjC,EAAAnC,EAAAC,cAAA,KAAGC,UAAU,YACXiC,EAAAnC,EAAAC,cAAA,KAAGE,KAAMwB,KAAK/B,MAAM0D,QAAQc,SAAUzC,KAAK0C,UAAU1C,KAAK/B,MAAM0D,QAAQc,oBA5C5CnB,2LCApCqB,EAAa,CACjBC,OAAQ,UACRC,YAAY,GAGRC,EAAa,CACjBC,SAAS,OACTC,MAAM,WAKFC,EAAgB,SAACC,GAAD,OAAU,IAAIjB,KAAKC,eAAe,QAAS,CAC/DE,MAAO,UACNE,OAAO,IAAIC,KAAKW,KAEEC,4LAGDxF,EAAGyF,GACnB,IAAMC,EAAQ,IAAIC,MAAM3F,GASxB,OARA0F,EAAME,KAAK,GAEQF,EAAMG,OAAO,SAACC,EAAKvD,GACpC,IAAMwD,EAAOD,EAAIA,EAAIE,OAAS,GAE9B,OADAF,EAAIG,KAAKF,EAfF,QAgBAD,GACN,CAAEL,EAjBI,SAiBkBS,UAETnF,IAAI,SAAAoF,GACpB,MAAO,CAAEA,UAAWA,EAAW3D,MAAO,2CAI5B4D,GACZ,IAAMC,EAASD,EAAEJ,OAAS,EAAII,EAAE,GAAGD,WAAY,IAAIvB,MAAO0B,UAE1D,OADgBjE,KAAKkE,kBAAkB,GAAKH,EAAEJ,OAAQK,GACvCpF,OAAOmF,0CAKtB,IAAMI,EAAanE,KAAK/B,MAAMmG,MAAMC,UAAU3F,IAAI,SAAAqF,GAChD,MAAO,CAAED,UAAWvB,KAAK+B,MAAMP,EAAEQ,MAAOpE,MAAO4D,EAAE5D,SAGnD,OAAIgE,EAAWR,OAAS,GACf3D,KAAKwE,cAAcL,GAEnBA,mCAKT,OACE3D,EAAAnC,EAAAC,cAAA,OAAKC,UAAWyB,KAAK/B,MAAMM,UAAX,mBAAAK,OACKoB,KAAK/B,MAAMM,WAAc,mBAE5CiC,EAAAnC,EAAAC,cAAA,qBACG0B,KAAK/B,MAAMmG,OACV5D,EAAAnC,EAAAC,cAAA,QAAMC,UAAU,SACdiC,EAAAnC,EAAAC,cAACmG,EAAApG,EAAD,CACEqG,YAAY,OACZvE,MAAOH,KAAK/B,MAAMmG,MAAMO,oBACxBC,mBAAmB,IAJvB,WASH5E,KAAK/B,MAAMmG,OACV5D,EAAAnC,EAAAC,cAACuG,EAAA,EAAD,CACEC,MAAO9E,KAAK/B,MAAM6G,MAClBC,OAAQ/E,KAAK/B,MAAM8G,OACnBC,eAAgB,IAChBC,KAAMjF,KAAKkF,gBAEX1E,EAAAnC,EAAAC,cAAC6G,EAAA,EAAD,CACEC,gBAAgB,IAChBC,YAAY,IAEd7E,EAAAnC,EAAAC,cAACgH,EAAA,EAAD,CACEC,KAAK,SACLC,QAAQ,YAERC,SAAU9C,EAEVO,KAAMJ,EACN4C,SAAU,EACVC,UAAW,EACXC,SAAUjD,EACVM,cAAeA,EAEf8B,OAAQ,GACRc,OAAQ,CAAC,UAAW,WACpBC,QAAS,CAAEC,KAAM,EAAGC,MAAO,KAE7BxF,EAAAnC,EAAAC,cAAC2H,EAAA,EAAD,CACET,QAAQ,QACRjC,KAAMvD,KAAK/B,MAAMsF,gBAlFcjC,+JCfxB4E,6MAEnB5G,MAAQ,CACN6G,cAAe,iGAIfnG,KAAKoG,kEAGc,IAAAC,EAAArG,KACfA,KAAK/B,MAAM2D,WAAa5B,KAAKV,MAAM6G,eACrCG,IACGC,IADH,gBAAA3H,OACuBoB,KAAK/B,MAAM2D,SADlC,mBAEG4E,KAAK,SAAAC,GAAM,OAAIJ,EAAKpG,SAAS,CAAEkG,cAAeM,EAAOxB,0CAGnD,IACCkB,EAAkBnG,KAAKV,MAAvB6G,cACR,OACE3F,EAAAnC,EAAAC,cAACkC,EAAAnC,EAAM2D,SAAP,KACGmE,GAAiBA,EAAcxC,OAAS,GACvCnD,EAAAnC,EAAAC,cAAA,OAAKC,UAAWyB,KAAK/B,MAAMM,UAAX,qBAAAK,OAA4CoB,KAAK/B,MAAMM,WAAc,qBACnFiC,EAAAnC,EAAAC,cAAA,UAAK0B,KAAK/B,MAAMC,OAChBsC,EAAAnC,EAAAC,cAAA,UACG0B,KAAKV,MAAM6G,cAAczH,IAAI,SAAAgI,GAAI,OAChClG,EAAAnC,EAAAC,cAAA,MAAIQ,IAAK4H,EAAK9E,UACZpB,EAAAnC,EAAAC,cAAA,KAAGE,KAAI,IAAAI,OAAM8H,EAAK9E,UAAY1D,MAAOwI,EAAK9E,UACxCpB,EAAAnC,EAAAC,cAACqI,EAAA,EAAD,CAAQ/E,SAAU8E,EAAK9E,yBA5BGN,iLCFzBsF,cAEnB,SAAAA,EAAY3I,GAAO,IAAAyB,EAAA,OAAAmH,OAAAC,EAAA,EAAAD,CAAA7G,KAAA4G,IACjBlH,EAAAmH,OAAAE,EAAA,EAAAF,CAAA7G,KAAA6G,OAAAG,EAAA,EAAAH,CAAAD,GAAAK,KAAAjH,KAAM/B,KACDiJ,mBAAmBjJ,GAFPyB,yFAKOyH,GACxBnH,KAAKkH,mBAAmBC,8CAIPlJ,GACjB+B,KAAKoH,WAAanJ,EAAMoJ,QAAQ7D,OAAO,SAAC8D,EAAOC,GAAR,OAAkBD,EAAQE,IAAQC,QAAQF,IAAQ,oCAGlFA,GAEP,OADaC,IAAQC,QAAQF,GACfvH,KAAKoH,kBAlBuB9F,aCIxCoG,EAAa,CACjBC,SAAU,SAAAA,GAAQ,OAChBA,EAASC,eAEXC,YAAa,SAAAC,GAAQ,OACnB,IAAI7F,KAAKC,eAAe,QAAS,CAC/BC,KAAO,UACPC,MAAO,QACPC,IAAO,YACNC,OAAO,IAAIC,KAAKuF,KAErBC,aAAc,SAAAD,GAAQ,OACpBE,EAAA3J,EAAAC,cAAC2J,EAAA5J,EAAD,CAASkG,KAAMuD,KAEjBI,kBAAmB,SAACC,GAClB,MAAmB,WAAfA,EACOH,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,OAAOL,MAAM,kBAA7B,UACa,cAAfiK,EACEH,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,OAAOL,MAAM,gCAA7B,UAEA8J,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,OAAOL,MAAM,WAA7B,WAGbkK,aAAc,SAAAC,GACZ,MAAc,UAAVA,EACOL,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,OAAOL,MAAM,SAA7B,UACQ,UAAVmK,EACEL,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,OAAOL,MAAM,SAA7B,UAEA8J,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,OAAOL,MAAM,QAA7B,WAGboK,YAAa,SAAAA,GAAW,OACtBN,EAAA3J,EAAAC,cAACiK,EAAAlK,EAAD,CACEqG,YAAY,OACZvE,MAAOmI,EACP1D,mBAAmB,KAEvB4D,aAAc,SAAAC,GACZ,IAAMnB,EAAQmB,EAAMC,SAAWD,EAAME,WAAaF,EAAMG,iBAClDC,EAAWJ,EAAMC,SAAWpB,EAAQ,IACpCwB,EAAYL,EAAMG,iBAAmBtB,EAAQ,IAE7CyB,EAAS,CACbL,SAAY,WACZC,WAAc,aACdC,iBAAoB,WAGhBI,EAAU,CAAC,WAAY,aAAc,oBAAoBxF,OAAO,SAACwF,EAAS7B,GAC9E,IAAM8B,EAAQR,EAAMtB,GACpB,OAAc,IAAV8B,EACKD,EAEP,GAAApK,OAAUoK,EAAV,KAAApK,OAAqBqK,EAArB,KAAArK,OAA8BmK,EAAO5B,GAArC,MACD,IAAI+B,MAAM,GAAI,GAEjB,OACElB,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,MAAML,MAAO8K,GAC3BhB,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,WAAW4K,MAAO,CAAErE,MAAK,GAAAlG,OAAKiK,EAAL,QACzCb,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,mBAAmB4K,MAAO,CAAErE,MAAK,GAAAlG,OAAKkK,EAAL,UAKvDM,YAAa,SAAAC,GAAU,OACrBrB,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,eACdyJ,EAAA3J,EAAAC,cAAA,YAAO+K,EAAWzH,UADpB,MACuCoG,EAAA3J,EAAAC,cAAA,YAAO+K,EAAWxK,MAG3DyK,WAAY,SAAAC,GAAS,OACnBvB,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,cAAcgL,KAK5BC,EAAmB,CACvBC,aAAc,SAACC,GAAD,OAAWA,EAAKC,OAAN,GAAA/K,OACK8K,EAAKC,OADV,MAAA/K,OACqB8K,EAAKxL,OAAUwL,EAAKxL,QAG9C0L,+LAEEpI,EAAK+F,GACxB,OACES,EAAA3J,EAAAC,cAAA,KACEQ,IAAKyI,EACL/I,KAAMgD,EACNjD,UAAWgJ,EAAMsC,UAAU,GAC3BV,MAAO,CAAErE,MAAK,GAAAlG,OAAK,IAAAiI,OAAAN,EAAA,EAAAM,QAAAG,EAAA,EAAAH,CAAA+C,EAAAE,WAAA,WAAA9J,MAAAiH,KAAAjH,KAAqBuH,GAA1B,OAEbiC,EAAiBjC,GAAOvH,KAAK/B,MAAMyL,2CAK9BlI,EAAK+F,GACf,IAAMwC,EAAYrC,EAAWH,GAEvBpH,OAAmCnB,IAA3BgB,KAAK/B,MAAMyL,KAAKnC,GAC3BwC,EAAYA,EAAU/J,KAAK/B,MAAMyL,KAAKnC,IAAUvH,KAAK/B,MAAMyL,KAAKnC,GACjE,GAEF,OACES,EAAA3J,EAAAC,cAAA,KACEQ,IAAKyI,EACL/I,KAAMgD,EACNjD,UAAWgJ,EACX4B,MAAO,CAAErE,MAAK,GAAAlG,OAAK,IAAAiI,OAAAN,EAAA,EAAAM,QAAAG,EAAA,EAAAH,CAAA+C,EAAAE,WAAA,WAAA9J,MAAAiH,KAAAjH,KAAqBuH,GAA1B,OAAwCpH,oCAInD,IAAAT,EAAAM,KACDuF,EAAOvF,KAAK/B,MAAMyL,KAAKM,UAAU,GACjCxI,EAAG,YAAA5C,OAAeoB,KAAK/B,MAAMyL,KAAK7K,GAA/B,gBAET,OACEmJ,EAAA3J,EAAAC,cAAA,OACEC,UAAS,MAAAK,OAASoB,KAAK/B,MAAMgM,SAAY,YAAc,IACvDd,MAAOnJ,KAAK/B,MAAMkL,MAClBxI,QAASX,KAAK/B,MAAM0C,SAElBX,KAAK/B,MAAMoJ,QAAQ3I,IAAI,SAAA6I,GAAK,OAAIA,EAAM2C,WAAW,QACjDxK,EAAKyK,qBAAqB3I,EAAK+F,GAAS7H,EAAK0K,YAAY5I,EAAK+F,KAEhES,EAAA3J,EAAAC,cAAA,QAAMC,UAAS,aAAAK,OAAe2G,IAC5ByC,EAAA3J,EAAAC,cAAA,OAAK+L,IAAG,kBAAAzL,OAAoB0L,IAAM/D,IAAIhB,IAASgF,IAAG,aAAA3L,OAAe2G,cA7ClCqB,WCtFpB4D,6MAEnBlL,MAAQ,CACNpB,MAAOwB,EAAKzB,MAAMyL,KAAKxL,MACvB8C,UAAU,KAUZyJ,aAAe,SAACjL,GACdE,EAAKO,SAAS,CAAEe,UAAU,GACxB,kBAAMtB,EAAKgL,OAAOC,WAEpBnL,EAAIoL,iBACJpL,EAAIqL,qBAGN3J,SAAW,SAAC1B,GACVE,EAAKO,SAAS,CAAE/B,MAAOsB,EAAIsL,OAAO3K,WAGpC4K,WAAa,SAACvL,GACM,KAAdA,EAAIC,OACNC,EAAKO,SAAS,CAAEe,UAAU,GACxB,kBAAMtB,EAAKzB,MAAM+M,SAAStL,EAAKzB,MAAMyL,KAAMhK,EAAKJ,MAAMpB,mGAtBlCiJ,GACxBnH,KAAKC,SAAS,CACZ/B,MAAOiJ,EAAKuC,KAAKxL,MACjB8C,UAAU,qCAuBL,IAAAqF,EAAArG,KACP,OACEgI,EAAA3J,EAAAC,cAAA,KACEE,KAAI,IAAAI,OAAMoB,KAAK/B,MAAMyL,KAAK7K,IAC1BsK,MAAOnJ,KAAK/B,MAAMkL,MAClB5K,UAAS,aAAAK,OAAgBoB,KAAK/B,MAAMgM,SAAY,YAAc,IAC9DtJ,QAASX,KAAK/B,MAAM0C,SAEpBqH,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,gBACZyB,KAAKV,MAAM0B,SACXgH,EAAA3J,EAAAC,cAAA,SACE2M,IAAK,SAAAC,GAAC,OAAI7E,EAAKqE,OAASQ,GACxB/K,MAAOH,KAAKV,MAAMpB,MAClByC,QAASX,KAAKyK,aACdvJ,SAAUlB,KAAKkB,SACfiK,UAAWnL,KAAK+K,aAClB/C,EAAA3J,EAAAC,cAAA,QACEC,UAAU,WACVoC,QAASX,KAAKyK,cAAgBzK,KAAKV,MAAMpB,QAG/C8J,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,aAAhB,kBAtD+B+C,aCElB8J,mLAEV,IAAA1L,EAAAM,KACP,OACEgI,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,iBACZyB,KAAK/B,MAAMoJ,QAAQ3I,IAAI,SAAA6I,GAAK,OAC3BS,EAAA3J,EAAAC,cAAA,QACEQ,IAAKyI,EACL4B,MAAO,CAAErE,MAAK,GAAAlG,OAAK,IAAAiI,OAAAN,EAAA,EAAAM,QAAAG,EAAA,EAAAH,CAAAuE,EAAAtB,WAAA,WAAApK,GAAAuH,KAAAvH,EAAqB6H,GAA1B,MACdhJ,UAAS,SAAAK,OAAW2I,GACpB5G,QAASjB,EAAKzB,MAAMoN,OAAOxK,KAAKnB,EAAM6H,IACtCS,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,iBACdyJ,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,SACb+M,IAAa/D,IAAUA,GAEzB7H,EAAKzB,MAAMsN,aAAehE,GACzBS,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,aACdyJ,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,SACZmB,EAAKzB,MAAMuN,QAAW,SAAW,uBAlBhB5E,mBCAjC6E,EAAeC,0BAAgB,SAAAC,GAAA,IAAGvN,EAAHuN,EAAGvN,MAAH,OACnC4J,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,QAAQH,KAGnBwN,EAAeC,4BAAkB,SAAAC,GAAA,IAAGC,EAAHD,EAAGC,MAAH,OACrC/D,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,gBACZwN,EAAMrN,IAAI,SAACgL,EAAMsC,GAAP,OACThE,EAAA3J,EAAAC,cAACmN,EAAD,CAAc3M,IAAG,QAAAF,OAAUoN,GAAOC,MAAOD,EAAK5N,MAAOkN,IAAa5B,UAKnDwC,mLAEV,IAAAxM,EAAAM,KACP,OACEgI,EAAA3J,EAAAC,cAACsN,EAAD,CACEG,MAAO/L,KAAK/B,MAAM8N,MAClBI,UAAW,SAAAC,GAAC,OAAI1M,EAAKzB,MAAMkO,UAAUC,EAAEC,SAAUD,EAAEE,oBANlBhL,aCVpBiL,cAEnB,SAAAA,EAAYtO,GAAO,IAAAyB,EAAA,OAAAmH,OAAAC,EAAA,EAAAD,CAAA7G,KAAAuM,IACjB7M,EAAAmH,OAAAE,EAAA,EAAAF,CAAA7G,KAAA6G,OAAAG,EAAA,EAAAH,CAAA0F,GAAAtF,KAAAjH,KAAM/B,KACDqB,MAAQ,CACX+H,QAASpJ,EAAMoJ,QAAQ6B,MAAM,IAHdxJ,yFAOOyH,GACpBA,EAAKE,UAAYrH,KAAK/B,MAAMoJ,SAC9BrH,KAAKC,SAAS,CAAEoH,QAASF,EAAKE,QAAQ6B,MAAM,+CAI9BjL,GAAO,IAAAoI,EAAArG,KACjBwM,EAAS,GAOf,OALAC,IAAQC,QAAQ,SAAAnF,GACd,IAAMoF,EAAYtG,EAAK/G,MAAM+H,QAAQuF,SAASrF,GAC9CiF,EAAOjF,GAASoF,IAGXH,qCAIEK,GAAS,IAAAC,EAAA9M,KAYd6M,EAXa,WACf,IAAME,EACJN,IAAQO,OAAO,SAAAzF,GAAK,OAAKuF,EAAKxN,MAAM+H,QAAQuF,SAASrF,KAEvDuF,EAAK7M,SAAS,CAAEoH,QAASyF,EAAKxN,MAAM+H,QAAQzI,OAAOmO,KAQnDE,GAJAH,EAAK7M,SAAS,CAAEoH,QAAS,0CAcJoF,IAAQ9I,SAAW3D,KAAKV,MAAM+H,QAAQ1D,OAE3D3D,KAAKkN,YAAW,GAEhBlN,KAAKkN,YAAW,qCAIVC,GACRnN,KAAKC,SAAS,SAAAmN,GACZ,IAAMpB,EAAMoB,EAAK/F,QAAQgG,QAAQF,GAMjC,OALInB,EAAM,EACRoB,EAAK/F,QAAQzD,KAAKuJ,GAElBC,EAAK/F,QAAQiG,OAAOtB,EAAK,GAEpBoB,mCAIJf,EAAUC,GACftM,KAAKC,SAAS,CACZoH,QAASkG,oBAAUvN,KAAKV,MAAM+H,QAASgF,EAAUC,sCAI5C,IAAAkB,EAAAxN,KAaP,OACEgI,EAAA3J,EAAAC,cAACmP,EAAA,EAAD,CACElP,UAAU,cACVL,MAAM,oBACNwP,QAAS1N,KAAK/B,MAAM0B,UAEpBqI,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,eACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,oBACbyJ,EAAA3J,EAAAC,cAAA,UACEC,UAAU,cACVoC,QAASX,KAAK2N,WAAW9M,KAAKb,OAFhC,OAGAgI,EAAA3J,EAAAC,cAAA,UACImO,IAAQ/N,IAvBF,SAAA6I,GAAK,OACrBS,EAAA3J,EAAAC,cAAA,MAAIQ,IAAKyI,GACPS,EAAA3J,EAAAC,cAAA,SACEiH,KAAK,WACL1G,GAAI0I,EACJ4F,KAAM5F,EACNsF,QAASW,EAAKlO,MAAM+H,QAAQuF,SAASrF,GACrCrG,SAAUsM,EAAKI,UAAU/M,KAAK2M,EAAMjG,KACtCS,EAAA3J,EAAAC,cAAA,SAAOuP,QAAStG,GAAQ+D,IAAa/D,SAmBnCS,EAAA3J,EAAAC,cAACwP,EAAD,CACE/B,MAAO/L,KAAKV,MAAM+H,QAClB8E,UAAWnM,KAAKqL,OAAOxK,KAAKb,SAGhCgI,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,WACbyJ,EAAA3J,EAAAC,cAAA,UACEC,UAAU,MACVoC,QAASX,KAAK/B,MAAM4B,OAAOgB,KAAKb,KAAMA,KAAKV,MAAM+H,UAFnD,QAIAW,EAAA3J,EAAAC,cAAA,UACEC,UAAU,cACVoC,QAASX,KAAK/B,MAAM0B,UAFtB,mBAnHoC2B,iDCGzByM,6MAEnBzO,MAAQ,CACN0O,MAAM,EACNC,sBAAsB,KAoCxBC,gBAAkB,SAAAC,GAChBzO,EAAKO,SAAS,CAAEgO,qBAAsBE,OAGxCC,kBAAoB,SAAA/G,GAClB3H,EAAKO,SAAS,CAAEgO,sBAAsB,IACtCvO,EAAKzB,MAAMoQ,qBAAqBhH,MAGlCiH,OAAS,SAAA/G,GACP,IAAMgH,EAAM7O,EAAKzB,MAAMuQ,OAAOC,QAAQC,KAAOnH,IACzC7H,EAAKzB,MAAMuQ,OAAOC,QAAQF,IAC9B7O,EAAKzB,MAAMoN,OAAO,CAAEqD,GAAInH,EAAOgH,IAAKA,OAGtCI,OAAS,SAAAC,GACPlP,EAAKO,SAAS,CAAE+N,KAAMY,OAGxBC,OAAS,SAACC,EAAO5O,EAAGV,GAClB,IAAMgC,EAAMhC,EAAIuP,aAAaC,QAAQ,OAE/BC,EAAWzN,EAAO,WACtB,IAAMnD,EAAIyB,SAASxB,cAAc,KAEjC,OADAD,EAAEG,KAAOgD,EACFnD,EAAE4Q,SAHa,GAIjB,KAEPvP,EAAKO,SAAS,CAAE+N,MAAM,IAElBc,EAAMnL,OAAS,EACjBjE,EAAKzB,MAAMiR,YAAYJ,GAChBtN,GAAOyN,IAAaE,OAAOC,SAASH,UAC3CvP,EAAKzB,MAAMoR,gBAAgB7N,iFAlEjB,IAAA6E,EAAArG,KACZ,OAAQ,SAACsP,GACP,IAAM5F,EAAOrD,EAAKpI,MAAM8N,MAAMuD,EAAKrD,OAC7BhC,EAAW5D,EAAKpI,MAAMsR,WAC1BlJ,EAAKpI,MAAMsR,UAAU3C,SAASlD,GAEhC,MAAsB,WAAdA,EAAKnE,KACXyC,EAAA3J,EAAAC,cAACkR,EAAD,CACE1Q,IAAKwQ,EAAKxQ,IACVqK,MAAOmG,EAAKnG,MACZO,KAAMA,EACNO,SAAUA,EACVtJ,QAAS,SAAAyL,GAAC,OAAI/F,EAAKoJ,WAAWrD,EAAG1C,EAAM4F,EAAKrD,QAC5CjB,SAAU3E,EAAKpI,MAAMyR,iBAEvB1H,EAAA3J,EAAAC,cAACqR,EAAD,CACE7Q,IAAKwQ,EAAKxQ,IACVqK,MAAOmG,EAAKnG,MACZ9B,QAAShB,EAAKpI,MAAMuQ,OAAOnH,QAC3BqC,KAAMA,EACNO,SAAUA,EACVtJ,QAAS,SAAAyL,GAAC,OAAI/F,EAAKoJ,WAAWrD,EAAG1C,EAAM4F,EAAKrD,8CAIzCzM,EAAKkK,EAAMsC,GACpB,IAAMuD,EAAYvP,KAAK/B,MAAMsR,WAC3BvP,KAAK/B,MAAMsR,UAAUK,YAAYpQ,EAAKkK,EAAMsC,EAAKhM,KAAK/B,MAAM8N,OAE1DwD,GACFvP,KAAK/B,MAAM4R,SAASN,oCAuCf,IAAAzC,EAAA9M,KACD8P,EACJ9H,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,6BACbyJ,EAAA3J,EAAAC,cAACyR,EAAA,EAAD,KACG,SAAApE,GAAA,IAAG5G,EAAH4G,EAAG5G,OAAQD,EAAX6G,EAAW7G,MAAX,OACCkD,EAAA3J,EAAAC,cAACyR,EAAA,EAAD,CACExR,UAAU,mBACVuG,MAAOA,EACPC,OAAQA,EACRiL,SAAUlD,EAAK7O,MAAM8N,MAAMpI,OAC3BsM,UAAW,GACXC,YAAapD,EAAKoD,kBAItBlQ,KAAKV,MAAM0O,MACXhG,EAAA3J,EAAAC,cAAC6R,EAAA,EAAD,MAEAnQ,KAAK/B,MAAMmS,MACVpI,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,eAGtB,OACEyJ,EAAA3J,EAAAC,cAAC0J,EAAA3J,EAAM2D,SAAP,KACEgG,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,0BACbyJ,EAAA3J,EAAAC,cAAC+R,EAAD,CACEhJ,QAASrH,KAAK/B,MAAMuQ,OAAOnH,QAC3BkE,WAAYvL,KAAK/B,MAAMuQ,OAAOC,QAAQC,GACtClD,QAASxL,KAAK/B,MAAMuQ,OAAOC,QAAQF,IACnClD,OAAQrL,KAAKsO,SAEftG,EAAA3J,EAAAC,cAAA,UACEC,UAAU,kCACVoC,QAAS,kBAAMmM,EAAKoB,iBAAgB,KAFtC,WAKAlO,KAAK/B,MAAMqS,eACXtI,EAAA3J,EAAAC,cAACiS,EAAA,EAAD,CACEhS,UAAU,WACViS,cAAc,EACdC,YAAa,kBAAM3D,EAAK6B,QAAO,IAC/B+B,YAAa,kBAAM5D,EAAK6B,QAAO,IAC/BE,OAAQ7O,KAAK6O,QACXiB,GACUA,EAGd9P,KAAKV,MAAM2O,sBACXjG,EAAA3J,EAAAC,cAACqS,EAAD,CACEtJ,QAASrH,KAAK/B,MAAMuQ,OAAOnH,QAC3B1H,SAAU,kBAAMmN,EAAKoB,iBAAgB,IACrCrO,OAAQG,KAAKoO,4BA/Hc9M,sHCPlBsP,mLAGjB,IAAMrL,EAAOvF,KAAK/B,MAAM+L,UAAU,GAC5B6G,EAAY7Q,KAAK/B,MAAM6S,UAAY,EAEzC,OACE9I,EAAA3J,EAAAC,cAAA,KAAGE,KAAI,YAAAI,OAAcoB,KAAK/B,MAAMY,GAAzB,gBACLN,UAAS,OAAAK,OAAUoB,KAAK/B,MAAMgM,SAAY,YAAc,IACxDtJ,QAASX,KAAK/B,MAAM0C,SAEpBqH,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,SACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAS,eAAAK,OAAiBiS,EAAY,WAAa,KACpDA,GAAa7I,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,UAC9ByJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAS,YAAAK,OAAc2G,IAC1ByC,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,SACZyB,KAAK/B,MAAMC,kBAhBUoD,aCAjByP,mLAGjB,OACE/I,EAAA3J,EAAAC,cAAA,KAAGE,KAAI,IAAAI,OAAMoB,KAAK/B,MAAMY,IACtBN,UAAS,OAAAK,OAAUoB,KAAK/B,MAAMgM,SAAY,YAAc,IACxDtJ,QAASX,KAAK/B,MAAM0C,SAEpBqH,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,SACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,gBACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,UACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,SACZyB,KAAK/B,MAAMC,kBAZQoD,qDCKpC,IAQqB0P,6MAEnB1R,MAAQ,CACN0O,MAAM,KAyDRW,OAAS,SAACC,GACRlP,EAAKO,SAAS,CAAE+N,KAAMY,OAGxBC,OAAS,SAACC,EAAO5O,EAAGV,GAClB,IAAMgC,EAAMhC,EAAIuP,aAAaC,QAAQ,OAErCtP,EAAKO,SAAS,CAAE+N,MAAM,IAElBc,EAAMnL,OAAS,EAAGjE,EAAKzB,MAAMiR,YAAYJ,GACpCtN,GAAK9B,EAAKzB,MAAMoR,gBAAgB7N,+EAhE/BhC,EAAKkK,EAAMsC,GACrB,IAAMuD,EACJvP,KAAK/B,MAAMsR,WAAavP,KAAK/B,MAAMsR,UAAUK,YAAYpQ,EAAKkK,EAAMsC,EAAKhM,KAAK/B,MAAM8N,OAElFwD,GACFvP,KAAK/B,MAAM4R,SAASN,uCAGZ0B,GAAa,IAAA5K,EAAArG,KACvB,OAAQ,SAAAsP,GACN,IAAM4B,EAAY5B,EAAKrD,MAAQgF,EAEzBE,EADUC,KAAKC,IAAIH,EAAYD,EAAa5K,EAAKpI,MAAM8N,MAAMpI,QACtCuN,EAEvBI,EAAgB,IAAIhO,MAAM6N,GAAY5N,UAAKvE,GAAWN,IAAI,SAACwB,EAAGqR,GAClE,IAAMvF,EAAMuF,EAASL,EACfxH,EAAOrD,EAAKpI,MAAM8N,MAAMC,GACxB/B,EAAW5D,EAAKpI,MAAMsR,WAAalJ,EAAKpI,MAAMsR,UAAU3C,SAASlD,GAEvE,MAAsB,WAAdA,EAAKnE,KACTyC,EAAA3J,EAAAC,cAACkT,EAAD,CACE1S,IAAKkN,EACLnN,GAAI6K,EAAK7K,GACTX,MAAOwL,EAAKxL,MACZ+L,SAAUA,EACVtJ,QAAS,SAAAyL,GAAC,OAAI/F,EAAKoL,YAAYrF,EAAG1C,EAAMsC,MAE1ChE,EAAA3J,EAAAC,cAACoT,EAAD,CACE5S,IAAKkN,EACLnN,GAAI6K,EAAK7K,GACTX,MAAOwL,EAAKxL,MACZ8L,UAAWN,EAAKM,UAChB8G,UAAWpH,EAAKiI,WAChB1H,SAAUA,EACVtJ,QAAS,SAAAyL,GAAC,OAAI/F,EAAKoL,YAAYrF,EAAG1C,EAAMsC,QAShD,OANImF,EAAaF,GACfK,EAAc1N,KAAK,IAAIN,MAAM2N,EAAcE,GAAY5N,UAAKvE,GAAWN,IAAI,SAACwB,EAAG8L,GAAJ,OACzEhE,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,aAAaO,IAAG,SAAAF,OAAWoN,QAK5ChE,EAAA3J,EAAAC,cAAA,OACEQ,IAAKwQ,EAAKxQ,IACVqK,MAAOmG,EAAKnG,MACZ5K,UAAU,OACT+S,qCAmBA,IAAAxE,EAAA9M,KACD4R,EACJ5J,EAAA3J,EAAAC,cAACiS,EAAA,EAAD,KACG,SAAA5E,GAAuB,IAApB5G,EAAoB4G,EAApB5G,OAAQD,EAAY6G,EAAZ7G,MACJmM,EAAcG,KAAKS,MAAM/M,EArFvB,KAsFFkL,EAAWoB,KAAKU,KAAKhF,EAAK7O,MAAM8N,MAAMpI,OAASsN,GAErD,OACEjJ,EAAA3J,EAAAC,cAACiS,EAAA,EAAD,CACEhS,UAAU,mBACVuG,MAAOA,EACPC,OAAQA,EACRiL,SAAUA,EACVC,UA9FI,IA+FJC,YAAapD,EAAKoD,YAAYe,OAKxC,OACEjJ,EAAA3J,EAAAC,cAAC0J,EAAA3J,EAAM2D,SAAP,KACEgG,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,4BACZyB,KAAK/B,MAAM8T,gBAAkBH,EAC5B5J,EAAA3J,EAAAC,cAACyR,EAAA,EAAD,CACExR,UAAU,WACViS,cAAc,EACdC,YAAa,kBAAM3D,EAAK6B,QAAO,IAC/B+B,YAAa,kBAAM5D,EAAK6B,QAAO,IAC/BE,OAAQ7O,KAAK6O,QAEZ+C,GAKH5R,KAAKV,MAAM0O,MAAQhG,EAAA3J,EAAAC,cAAC6R,EAAA,EAAD,eA5GO7O,gKCMhC0Q,EAAyB,CAC7B,QACA,YACA,gBAGWvF,EA1BW,CAKtB,SACA,QACA,WACA,gBACA,cACA,eACA,eACA,cACA,oBACA,eACA,cACA,cAUqC7N,OAAOoT,GAGjC1G,EAAe,CAG1B3B,OAAoB,SACpBzL,MAAoB,QACpByJ,SAAoB,WACpBsK,cAAoB,OACpBpK,YAAoB,cACpBE,aAAoB,YACpBmK,aAAoB,eACpB5J,YAAoB,cACpBJ,kBAAoB,aACpBM,aAAoB,qBACpBY,YAAoB,cACpBE,WAAoB,aAEpB6I,MAAoB,iBACpBC,UAAoB,YACpBhK,aAAoB,UAITiK,EAAe,CAC1B5I,aAAkB,KAElBE,OAAoB,IACpBzL,MAAoB,IACpByJ,SAAoB,IACpBsK,cAAoB,IACpBpK,YAAoB,IACpBE,aAAoB,IACpBmK,aAAoB,IACpB5J,YAAoB,IACpBJ,kBAAoB,IACpBM,aAAoB,IACpBY,YAAoB,IACpBE,WAAoB,IAEpB6I,MAAoB,IACpBC,UAAoB,IACpBhK,aAAoB,KAGTkK,EAAoB,CAC/B7I,aAAc,CAAE,SAAU,aAIfjC,EAAb,oBAAAA,IAAAX,OAAA0L,EAAA,EAAA1L,CAAA7G,KAAAwH,GAAA,OAAAX,OAAA2L,EAAA,EAAA3L,CAAAW,EAAA,OAAA1I,IAAA,UAAAqB,MAAA,SAEiBoH,GACb,IAAMkL,EAAIJ,EAAa9K,GACvB,MAAU,OAANkL,EACK,EACM,MAANA,EACA,EACM,MAANA,EACA,EACM,MAANA,EACA,OADJ,IAVT,CAAA3T,IAAA,0BAAAqB,MAAA,SAeiCkH,GAC7B,OAAOA,EAAQ7D,OAAO,SAACiD,EAAQc,GAO7B,OANIA,EAAM2C,WAAW,QACnBzD,EAASA,EAAO7H,OAAO0T,EAAkB/K,IAGzCd,EAAO7C,KAAK2D,GAEPd,GACN,MAxBP,CAAA3H,IAAA,eAAAqB,MAAA,SA4BsBkH,EAASlJ,GAC3B,MAAa,iBAATA,EAEKkJ,EAAQ2F,OAAO,SAAA0F,GAAC,OAAKV,EAAuBpF,SAAS8F,KAGrDrL,MAlCbG,EAAA,4IC3EqBiG,mLAGjB,OACEjN,EAAAnC,EAAAC,cAAA,OAAKC,UAAS,aAAAK,OAAeoB,KAAK/B,MAAMM,YACtCiC,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,iBACbiC,EAAAnC,EAAAC,cAACqU,EAAAtU,EAAD,CAAWuU,OAAO,iBAChBpS,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,SACbiC,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,gBACbiC,EAAAnC,EAAAC,cAAA,MAAIC,UAAU,SAASyB,KAAK/B,MAAMC,OAClCsC,EAAAnC,EAAAC,cAAA,UACEC,UAAU,gBACVoC,QAASX,KAAK/B,MAAMyP,SAFtB,WAKFlN,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,cACZyB,KAAK/B,MAAMgB,qBAhBOqC,sICHduR,aAEnB,SAAAA,EAAYC,GAAe,IAAApT,EAAAM,KAAA6G,OAAA0L,EAAA,EAAA1L,CAAA7G,KAAA6S,GAAA7S,KAmD3B+S,WAAa,SAACrJ,EAAMsJ,GAClB,GAAIA,EAAe,CACjB,IAAMC,EAAUvT,EAAKwT,WAAW7F,QAAQ3D,GAClCyJ,EAAaF,GAAW,EAE1BG,EAAS1T,EAAKwT,WAAWhK,MAAM,GASnC,OANIiK,EACFC,EAAO9F,OAAO2F,EAAS,GAEvBG,EAAOxP,KAAK8F,GAGP,IAAImJ,EAAUO,GAGrB,OAAO,IAAIP,EAAU,CAAEnJ,KApEA1J,KAgF3BqT,YAAc,SAACC,EAAUC,GACvB,IAAMC,EAAkB9T,EAAKwT,WAAWxU,IAAI,SAAAgL,GAC1C,OAAO4J,EAASjG,QAAQ3D,KAGpB+J,EAASrC,KAAKC,IAAIqC,MAAM,KAAMF,GAC9BG,EAASvC,KAAKwC,IAAIF,MAAM,KAAMF,GAE9BK,EAAaN,EAAQI,GAAYJ,EAAQE,EAEzCvK,EAAQ,SAAC4K,EAAMC,GAAP,OAAcT,EAASpK,MAAM4K,EAAMC,EAAK,IAEtD,OAES,IAAIlB,EAFTgB,GAAaN,EAAQI,EAEFzK,EAAMuK,EAAQF,GAC5BM,EAEc3K,EAAMqK,EAAOI,GAGbzK,EAAMuK,EAAQF,KAlGnCvT,KAAKkT,WADHJ,GAGgB,yDAIpB,OAAkC,IAA3B9S,KAAKkT,WAAWvP,wCAGhB+F,GACP,OAAO1J,KAAKkT,WAAWtG,SAASlD,+CAIhC,OAAkC,IAA3B1J,KAAKkT,WAAWvP,gDAIvB,OAAkC,IAA3B3D,KAAKkT,WAAWvP,QAA4C,WAA5B3D,KAAKkT,WAAW,GAAG3N,gDAI1D,OAAkC,IAA3BvF,KAAKkT,WAAWvP,QAA4C,aAA5B3D,KAAKkT,WAAW,GAAG3N,4CAO1D,OAHiBvF,KAAKkT,WAAWlG,OAAO,SAAAtD,GACtC,OAAOA,EAAKM,WAAaN,EAAKM,UAAUgK,KAAK,SAAAC,GAAE,OAAIA,EAAG/J,WAAW,YAEnDvG,OAAS,8BAGvBqI,GACF,OAAOhM,KAAKkT,WAAWlH,sCAIvB,OAAOhM,KAAKkT,gDAIZ,OAAOlT,KAAKkT,WAAWlG,OAAO,SAAA9B,GAAC,MAAe,WAAXA,EAAE3F,8CAIrC,OAAOvF,KAAKkT,WAAWlG,OAAO,SAAA9B,GAAC,MAAe,aAAXA,EAAE3F,2CA4D3B/F,EAAKkK,EAAMsC,EAAKsH,GAC1B,IAAMY,EAAU1U,EAAI2U,iBAAiB,SAC/BC,EAAS5U,EAAI2U,iBAAiB,WAMpC,GAFGD,GAAWE,IAAYpU,KAAK4M,SAASlD,GAEpB,CAClB,IAAM2K,EAAeH,EACnBlU,KAAKqT,YAAYC,EAAUtH,GAC3BhM,KAAK+S,WAAWrJ,EAAM0K,GAGxB,OADA5U,EAAIoL,iBACGyJ,oICzHQC,2LAGFC,GAEf,IADA,IAAIC,EAAO,EACFtJ,EAAE,EAAGA,EAAEqJ,EAAI5Q,OAAQuH,IAC1BsJ,EAAOD,EAAIE,WAAWvJ,KAAOsJ,GAAQ,GAAKA,GAE5C,OAAOA,EAAO,qCAId,IAAMxR,EAAQhD,KAAK/B,MAAM2D,SAAX,OAAAhD,OAA6BoB,KAAK0U,iBAAiB1U,KAAK/B,MAAM2D,UAA9D,eAAuF,UAErG,OACEpB,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,SAAS4K,MAAO,CAAEwL,gBAAiB3R,IAChDxC,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,SACXyB,KAAK/B,MAAM2D,UAAY5B,KAAK/B,MAAM2D,SAASgT,OAAO,GAAGhN,uBAjB7BtG,qICC9BuT,SAAcC,EAAMC,IAAI,CAC5BC,KAAQ,CACNC,OAAQ,OACRC,WAAY,CACVC,KAAM,UACNC,SAAS,MAGbC,OAAQ,CAAEJ,OAAQ,YAGC9E,6MAEnB7Q,MAAQ,CACN6O,SAAS,sFAITnO,KAAKC,SAAS,CAAEkO,SAAS,qCAIzB,OACE3N,EAAAnC,EAAAC,cAAA,OAAKC,UAAU,iBACbiC,EAAAnC,EAAAC,cAACuW,EAAD,CAAatW,UAAU,QAAQ+W,KAAMtV,KAAKV,MAAM6O,QAAU,OAAS,UACjE3N,EAAAnC,EAAAC,cAAA,QAAMC,UAAU,QAAhB,UACAiC,EAAAnC,EAAAC,cAAA,KAAGC,UAAU,gBAAb,mEAGAiC,EAAAnC,EAAAC,cAAA,KAAGC,UAAU,aAAb,qFAlBgC+C,oLCZpCiU,EAAgB,CACpB5T,QAAS,KAETxD,KAAM,eACNqX,aAAc,QAEdC,aAAc,KAEdC,KAAM,CACJC,YAAa,KACbC,OAAQ,KACRC,YAAa,EACb9J,MAAO,IAGTwD,UAAW,IAAIsD,IAEfiD,aAAc,CACZzO,QAAS,CACP,SACA,QACA,WACA,gBACA,cACA,gBAEFoH,QAAS,CAAEC,GAAI,KAAMH,KAAK,IAG5B6B,MAAM,GAGK2F,EAAe,WAE1B,IAAMC,EAAS,GAUf,MAFA,CAAC,OAAQ,eAAgB,gBAAgBtX,IALpB,SAACI,GACpB,IAAMqB,EAAQ8V,aAAaC,QAAb,sBAAAtX,OAA2CE,IACrDqB,IAAO6V,EAAOlX,GAAOqX,KAAK7R,MAAMnE,MAK/B0G,OAAAuP,EAAA,EAAAvP,CAAA,GAAK0O,EAAkBS,IAGnBK,EAAe,SAACvX,EAAKqB,GAChC,IAAMmW,EAAQ,sBAAA1X,OAAyBE,GACvCmX,aAAaM,QAAQD,EAAUH,KAAKK,UAAUrW,KCjD3BsW,6MAUnBC,cAAgB,SAAClX,GACG,KAAdA,EAAIC,OAAcC,EAAKzB,MAAM0B,+FARjCG,SAASC,iBAAiB,UAAWC,KAAK0W,eAAe,kDAIzD5W,SAASM,oBAAoB,UAAWJ,KAAK0W,eAAe,oCAQ5D,OACE1O,EAAA3J,EAAAC,cAAA,OAAKC,UAAS,aAAAK,OAAeoB,KAAK/B,MAAMM,YACtCyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAS,oCAAAK,OAAsCoB,KAAK/B,MAAMM,YAC7DyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,SACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,eACbyJ,EAAA3J,EAAAC,cAAA,WACG0B,KAAK/B,MAAMgB,UAGd+I,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,UACbyJ,EAAA3J,EAAAC,cAAA,UACEC,UAAU,mBACVoC,QAASX,KAAK/B,MAAM0B,UAFtB,UAIAqI,EAAA3J,EAAAC,cAAA,UACEC,UAAU,WACVoC,QAASX,KAAK/B,MAAM0Y,MAFtB,kBA7BuBrV,aCIjCsV,6MAEJtX,MAAQ,CACNuX,WAAa,MAGf3V,SAAW,SAAA1B,GACTE,EAAKO,SAAS,CAAE4W,WAAYrX,EAAIsL,OAAO3K,WAGzC4K,WAAa,SAAAvL,GACO,KAAdA,EAAIC,OACNC,EAAKiX,UAGTA,KAAO,WACLjX,EAAKzB,MAAM0Y,KAAKjX,EAAKJ,MAAMuX,qFAI3B,OACE7O,EAAA3J,EAAAC,cAACwY,EAAD,CACEH,KAAM3W,KAAK2W,KACXhX,SAAUK,KAAK/B,MAAM0B,UAErBqI,EAAA3J,EAAAC,cAAA,SACEiH,KAAK,OACLwR,WAAW,EACXC,YAAY,cACZ7W,MAAOH,KAAKV,MAAMuX,WAClB3V,SAAUlB,KAAKkB,SACf6J,WAAY/K,KAAK+K,qBA/BIzJ,aCJV2V,mLAGjB,OACEjP,EAAA3J,EAAAC,cAAA,OACEC,UAAU,QACV4K,MAAO,CAAE+N,SAAU,aAEnBlP,EAAA3J,EAAAC,cAAA,OACEC,UAAU,MACV4K,MAAO,CACLrE,MAAK,GAAAlG,OAAK,IAAMoB,KAAK/B,MAAMkC,MAAtB,KACL4E,OAAQ,kBAZezD,aCC7B6V,EAAe,SAAAlZ,GAEnB,OACE+J,EAAA3J,EAAAC,cAAA,UACGL,EAAMmZ,OAAOC,KAAKlK,KACnBnF,EAAA3J,EAAAC,cAAA,QAAMC,UAAS,gBAAAK,OAAkBX,EAAMmZ,OAAOE,YAiDrCC,EA3Ca,SAAAtZ,GAC1B,IAAMuZ,EAAcvZ,EAAMwZ,QAAQjU,OAAO,SAAC8D,EAAOoQ,GAAR,OAAcpQ,EAAQoQ,EAAEC,UAAU,GAErEC,EAAS3Z,EAAMwZ,QAAQjU,OAAO,SAACoU,EAAQF,GAE3C,OADIA,EAAEG,OAAOD,EAAOhU,KAAK8T,EAAEG,OACpBD,GACN,IAEH,OACE5P,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,mBACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,SACXN,EAAM6Z,MAER9P,EAAA3J,EAAAC,cAAA,UACEC,UAAU,gBACVoC,QAAS1C,EAAMyP,SAFjB,WAKF1F,EAAA3J,EAAAC,cAAA,MAAIC,UAAS,QAAAK,OAAWgZ,EAAOjU,OAAS,EAAK,cAAgB,KACzD1F,EAAMwZ,QAAQ/Y,IAAI,SAAAgZ,GAAC,OAAI1P,EAAA3J,EAAAC,cAACyZ,EAAD,CAAcjZ,IAAK4Y,EAAEL,KAAKlK,KAAMiK,OAAQM,MAEtC,IAAzBzZ,EAAMwZ,QAAQ9T,QACdqE,EAAA3J,EAAAC,cAAA,mDAEE0J,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,2BAKpBqZ,EAAOjU,OAAS,GAChBqE,EAAA3J,EAAAC,cAAA,MAAIC,UAAU,UACZyJ,EAAA3J,EAAAC,cAAA,UAAKsZ,EAAOI,SAIhBhQ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,YACbyJ,EAAA3J,EAAAC,cAAC2Z,EAAD,CAAO9X,MAAOqX,EAAcvZ,EAAMia,eC1CrBC,cAEnB,SAAAA,EAAYla,GAAO,IAAAyB,EAAA,OAAAmH,OAAAC,EAAA,EAAAD,CAAA7G,KAAAmY,IACjBzY,EAAAmH,OAAAE,EAAA,EAAAF,CAAA7G,KAAA6G,OAAAG,EAAA,EAAAH,CAAAsR,GAAAlR,KAAAjH,KAAM/B,KA4BRma,kBAAoB,SAAChB,EAAQiB,GAC3B3Y,EAAKO,SAAS,SAAAmN,GACZ,MAAO,CACLqK,QAASrK,EAAKqK,QAAQ/Y,IAAI,SAAAgZ,GAAC,OAAIA,EAAEL,OAASD,EAAOC,KAAlBxQ,OAAAuP,EAAA,EAAAvP,CAAA,GAA8B6Q,EAAMW,GAASX,QAhC/DhY,EAyCnB4Y,gBAAkB,WAChB,IAAMpa,EAAuC,IAA9BwB,EAAKJ,MAAMmY,QAAQ9T,OAAgBjE,EAAKJ,MAAMmY,QAAQ,GAAGJ,KAAKlK,KAAO,eAC9EoL,EAAW,IAAIC,SAGrB,OAFAD,EAASE,OAAO,QAASva,GAElBoI,IAAMoS,KAAK,aAAcH,EAAU,CACxCI,QAAS,CAAEC,mBAAoB,qBA/ChBlZ,EAoDnBmZ,YAAc,WAEZ,IA0BMC,EAAWpZ,EAAKJ,MAAMmY,QAAQ/Y,IA1BlB,SAAA0Y,GAChB,IAAMmB,EAAW,IAAIC,SACrBD,EAASE,OAAO,OAAQrB,EAAOC,MAM/B,OAAO/Q,IAAMoS,KAAN,cAAA9Z,OAAyBc,EAAKJ,MAAMyZ,SAApC,SAAqDR,EAAU,CACpEI,QAAS,CAAEC,mBAAoB,kBAC/BI,iBANuB,SAACxZ,GACxBE,EAAK0Y,kBAAkBhB,EAAQ,CAAEO,SAAUnY,EAAIyZ,YAM9CzS,KAAK,SAAAC,GAIN,OAHA/G,EAAK0Y,kBAAkBhB,EAAQ,CAC7B8B,WAAYzS,EAAOxB,KAAKkU,OAEnB1S,IACN2S,MAAM,SAAAvB,GAKP,MAJAnY,EAAK0Y,kBAAkBhB,EAAQ,CAC7BE,OAAQ,SACRO,MAAOA,EAAMwB,SAASpU,OAElB4S,MAQV,OAAOyB,QAAQC,IAAIT,IAnFFpZ,EAkGnB8Z,iBAAmB,SAAAC,GACjB,IAAMC,EAAgB5Z,SAASsP,SAASoF,KAAK3K,UAAU,GAEjDrI,EAAMkY,EAAa,cAAA9a,OACTc,EAAKJ,MAAMyZ,SADF,qBAAAna,OAC8B8a,GAD9B,cAAA9a,OAETc,EAAKJ,MAAMyZ,SAFF,aAIzB,OAAOzS,IAAMoS,KAAKlX,EAAK,CACrBmX,QAAS,CAAEC,mBAAoB,oBAC9BpS,KAAK,SAAAC,GACN,IAAMkT,EAAQlT,EAAOxB,KAAK2U,cAEtBD,GAASA,EAAMhW,OAAS,GAC1BjE,EAAKO,SAAS,CAAE6X,MAAO,iBACvBpY,EAAKma,iBAAiBpT,EAAOxB,KAAK6U,YAAaH,KAE/Cja,EAAKO,SAAS,CAAE6X,MAAO,cACvBpY,EAAKJ,MAAMmY,QAAQ/K,QAAQ,SAAAgL,GACR,WAAbA,EAAEJ,QAAqB5X,EAAK0Y,kBAAkBV,EAAG,CAAEJ,OAAQ,gBAE5DmC,GACH/Z,EAAKzB,MAAM8b,iBAvHAra,EA4HnBma,iBAAmB,SAACG,EAAYC,GAC9B3T,IAAMC,IAAN,eAAA3H,OAAyBob,IACtBxT,KAAK,SAAAC,GACJ/G,EAAKJ,MAAMmY,QAAQ/K,QAAQ,SAAAgL,GACzB,IAAMC,EAAWlR,EAAOxB,KAAKiV,SAASlG,KAAK,SAAAjQ,GAAC,OAAIA,EAAEoW,cAAgBzC,EAAEwB,aAChEvB,EACFjY,EAAK0Y,kBAAkBV,EAAG,CAAEJ,OAAQK,EAASL,SAE7C5X,EAAK0Y,kBAAkBV,EAAG,CAAEJ,OAAQ,gBAGrB5X,EAAKJ,MAAMmY,QAAQjU,OAAO,SAAC4W,EAAY1C,GACxD,OAAO0C,GAA2B,cAAb1C,EAAEJ,SACtB,IAGD5X,EAAKO,SAAS,CAAE6X,MAAO,cACvBpY,EAAKzB,MAAM8b,cAEXM,WAAW,kBAAM3a,EAAKma,iBAAiBG,EAAYC,IAAY,OAEhEb,MAAM,SAAAvB,GACuB,MAA1BA,EAAMwB,SAAS/B,QAEjB+C,WAAW,kBAAM3a,EAAKma,iBAAiBG,EAAYC,IAAY,QAlJrEva,EAAKJ,MAAQI,EAAKqW,aAAa9X,GAC/ByB,EAAK4a,QAHY5a,4EAMNzB,GACX,MAAO,CACL6Z,MAAO,YACPI,UAAWja,EAAM6Q,MAAMtL,OAAO,SAAC8D,EAAOiT,GAAR,OAAcA,EAAEC,KAAOlT,GAAO,GAC5DyR,SAAU,KACVtB,QAASxZ,EAAM6Q,MAAMpQ,IAAI,SAAA6b,GACvB,MAAO,CACLlD,KAAMkD,EACNrB,WAAY,KACZ5B,OAAQ,YACRK,SAAU,EACVE,MAAO,QAGXA,MAAO,wDAIe5Z,GACxB+B,KAAKC,SAASD,KAAK+V,aAAa9X,iDA8DhC+B,KAAKC,SAAS,CAAE6X,MAAO,cAEvB,IAAMS,EAAW,IAAIC,SAIrB,OAHAD,EAASE,OAAO,MAAOzY,KAAK/B,MAAMwc,aAAajZ,KAC/C+W,EAASE,OAAO,OAAQzY,KAAK/B,MAAMwc,aAAaC,YAEzCpU,IAAMoS,KAAN,cAAA9Z,OAAyBoB,KAAKV,MAAMyZ,SAApC,SAAqDR,EAAU,CACpEI,QAAS,CAAEC,mBAAoB,oDAqE3B,IAAAvS,EAAArG,KACNA,KAAKsY,kBAAkB9R,KAAK,SAACC,GAG3B,OAFAJ,EAAKpG,SAAS,CAAE8Y,SAAUtS,EAAOxB,KAAKpG,KAE/BwH,EAAKpI,MAAMwc,aAChBpU,EAAKsU,qBAAuBtU,EAAKwS,gBAEpCrS,KAAK,kBAAMH,EAAKmT,kBAAiB,KACjCJ,MAAM,SAAAvB,GAGL,MAFAxR,EAAKpG,SAAS,CAAE4X,MAAOA,IACvBxR,EAAKmT,kBAAiB,GAChB3B,qCAKR,OACE7P,EAAA3J,EAAAC,cAACsc,EAAD,CACE9C,MAAO9X,KAAKV,MAAMwY,MAClBI,UAAWlY,KAAKV,MAAM4Y,UACtBT,QAASzX,KAAKV,MAAMmY,QACpBI,MAAO7X,KAAKV,MAAMuY,MAClBnK,QAAS1N,KAAK/B,MAAMyP,iBA3LUpM,sBCLhCuZ,6MAEJC,gBAAkB,SAAAhM,GAChB,IAAIiM,EAAiB,GAGrBjM,EAAMpC,QAAQ,SAAA2K,GACZ,IAAI2D,EAAU,IAAIC,KAAK,CAAC5D,EAAK9W,SAAf,GAAA3B,OAA4ByY,EAAKlK,MAAQ,YAAzC,QAA4D,CACxE5H,KAAM,eAERwV,EAAenX,KAAKoX,KAGtBtb,EAAKzB,MAAMid,cAAcH,MAG3BI,sBAAwB,SAAC/O,GACJ,eAAhBA,EAAEtB,OAAOjM,IACZa,EAAKzB,MAAMyP,mFAIX,OACE1F,EAAA3J,EAAAC,cAAA,OACE6K,MAAOiS,EAAOC,WACdxc,GAAG,aACH8B,QAASX,KAAKmb,uBAEdnT,EAAA3J,EAAAC,cAAA,OAAK6K,MAAOiS,EAAOE,uBACjBtT,EAAA3J,EAAAC,cAACid,EAAA,EAAD,CACEH,OAAQ,CACNI,QAAS,UACTC,aAAc,EACdC,WAAY,YACZC,KAAM,WAERC,MAAO5b,KAAK/B,MAAMyP,QAClBmO,iBAAkB7b,KAAK8a,2BArCVxZ,aA6CnB8Z,EAAS,CACbC,WAAY,CACVnE,SAAU,QACVvC,gBAAiB,iBACjBmH,OAAQ,IACRC,IAAK,EACLhW,KAAM,EACNC,MAAO,EACPiP,OAAQ,EACR+G,QAAS,OACTC,WAAY,SACZC,eAAgB,UAElBZ,sBAAuB,CACrBa,UAAW,IACXC,SAAU,KACVC,OAAQ,GACRvX,MAAO,OACPC,OAAQ,OACRuX,UAAW,iCAIAzB,IC5DT0B,6MAEJjd,MAAQ,CACNkC,IAAM,MAGRN,SAAW,SAAA1B,GACTE,EAAKO,SAAS,CAAEuB,IAAKhC,EAAIsL,OAAO3K,WAGlC0O,OAAS,SAAArP,GACP,IAAMgC,EAAMhC,EAAIuP,aAAaC,QAAQ,QACrCtP,EAAKO,SAAS,CAAEuB,IAAKA,OAGvBuJ,WAAa,SAAAvL,GACO,KAAdA,EAAIC,OACNC,EAAKiX,UAGTA,KAAO,WACLjX,EAAKzB,MAAM0Y,KAAKjX,EAAKJ,MAAMkC,8EAI3B,OACEwG,EAAA3J,EAAAC,cAACwY,EAAD,CACEH,KAAM3W,KAAK2W,KACXhX,SAAUK,KAAK/B,MAAM0B,UAErBqI,EAAA3J,EAAAC,cAAA,SACEiH,KAAK,OACLwR,WAAW,EACXC,YAAY,oBACZ7W,MAAOH,KAAKV,MAAMkC,IAClBN,SAAUlB,KAAKkB,SACf2N,OAAQ7O,KAAK6O,OACb9D,WAAY/K,KAAK+K,qBArCAzJ,aA0ErBkb,EAAgB,SAAC1N,EAAO2L,GAC5B,OAAO,IAAInB,QAAQ,SAAAmD,GACjB,IAAMC,EAAY5c,SAASxB,cAAc,OACzCwB,SAAS6c,KAAKC,YAAYF,GAW1BG,iBAAO7U,EAAA3J,EAAAC,cAACwe,EAAD,CACLhO,MAAOA,EACP2L,aAAcA,EACdV,WAZiB,WACjB2C,EAAUK,SACVN,KAWA/O,QARc,SAAAjH,GACdiW,EAAUK,YAOYL,MAKf7D,EAAc,SAAA/J,GACzB,OAAO0N,EAAc1N,ICzGFkO,cAEnB,SAAAA,EAAY/e,GAAO,IAAAyB,EAAA,OAAAmH,OAAAC,EAAA,EAAAD,CAAA7G,KAAAgd,IACjBtd,EAAAmH,OAAAE,EAAA,EAAAF,CAAA7G,KAAA6G,OAAAG,EAAA,EAAAH,CAAAmW,GAAA/V,KAAAjH,KAAM/B,KAEDqB,MAAQ,CACXgY,OAAQ,UACRK,SAAU,EACVgC,MAAO,EACPsD,eAAgB,GAGlBvd,EAAKwd,eAVYxd,8EAaJ,IAAA2G,EAAArG,KACbsG,IAAMC,IAAN,YAAA3H,OAAsBoB,KAAK/B,MAAMkf,QAC9B3W,KAAK,SAAAC,GACJJ,EAAKpG,SAAS,CACZqX,OAAQ7Q,EAAOxB,KAAKqS,OACpBK,SAAUlR,EAAOxB,KAAK0S,SACtBgC,MAAOlT,EAAOxB,KAAKiV,SAASvW,OAC5BsZ,eAAgBxW,EAAOxB,KAAKiV,SAASlN,OAAO,SAAAjJ,GAAC,MAAiB,cAAbA,EAAEuT,SAAwB3T,OAC3EyZ,YAAa3W,EAAOxB,KAAKiV,SAASlN,OAAO,SAAAjJ,GAAC,MAAiB,WAAbA,EAAEuT,SAAqB3T,SAGjC,cAAvB8C,EAAOxB,KAAKqS,QAAiD,WAAvB7Q,EAAOxB,KAAKqS,OAE/DjR,EAAKpI,MAAM8b,YAAc1T,EAAKpI,MAAM8b,aAEpCM,WAAW,kBAAMhU,EAAK6W,gBAAgB,OAEzC9D,MAAM,SAAAvB,GACyB,MAA1BA,EAAMwB,SAAS/B,QAEjB+C,WAAW,kBAAMhU,EAAK6W,gBAAgB,wCAK5C,IAAMG,EACkB,cAAtBrd,KAAKV,MAAMgY,QACW,WAAtBtX,KAAKV,MAAMgY,OAEb,OACEtP,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,gBACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,UAAf,4BAC6B8e,GAAUrV,EAAA3J,EAAAC,cAAA,UACnCC,UAAU,gBACVoC,QAASX,KAAK/B,MAAMyP,SAFe,WAMvC1F,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,QACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,WAAf,UACUyB,KAAKV,MAAM2d,eADrB,OACyCjd,KAAKV,MAAMqa,MADpD,SAEE3R,EAAA3J,EAAAC,cAAA,QAAMC,UAAS,gBAAAK,OAAkBoB,KAAKV,MAAMgY,WAG9CtP,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,YACbyJ,EAAA3J,EAAAC,cAAC2Z,EAAD,CAAO9X,MAAOH,KAAKV,MAAMqY,SAAW,gBA5DFrW,qBCFzBgc,mLAEVC,GACP,IAAMhO,EAAYvP,KAAK/B,MAAMgM,SACvBuT,EAAajO,EAAUlC,QAAQkQ,GAEjCC,EAAa,EACfjO,EAAU3L,KAAK2Z,GAEfhO,EAAUjC,OAAOkQ,EAAY,GAE/Bxd,KAAK/B,MAAMiD,SAASqO,oCAGb,IAAA7P,EAAAM,KACP,OACEgI,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,eACbyJ,EAAA3J,EAAAC,cAAA,6BAEA0J,EAAA3J,EAAAC,cAAA,SACEiH,KAAK,WACL1G,GAAG,sBACHgO,QAAS7M,KAAK/B,MAAMwf,OACpBvc,SAAUlB,KAAK/B,MAAMyf,cACvB1V,EAAA3J,EAAAC,cAAA,SAAOuP,QAAQ,uBAAf,2DAEA7F,EAAA3J,EAAAC,cAAA,OAAKC,UAAS,iBAAAK,OAAmBoB,KAAK/B,MAAMwf,OAAS,YAAc,KACjEzV,EAAA3J,EAAAC,cAAA,aACE0J,EAAA3J,EAAAC,cAAA,aACG0B,KAAK/B,MAAM0f,YAAYjf,IAAI,SAAAkf,GAAS,OACnC5V,EAAA3J,EAAAC,cAAA,MAAIQ,IAAK8e,EAAUL,YACjBvV,EAAA3J,EAAAC,cAAA,UACE0J,EAAA3J,EAAAC,cAAA,SACEiH,KAAK,WACL1G,GAAI+e,EAAUL,WACd1Q,QAASnN,EAAKzB,MAAMgM,SAAS2C,SAASgR,EAAUL,YAChDrc,SAAUxB,EAAKwB,SAASL,KAAKnB,EAAMke,EAAUL,cAC/CvV,EAAA3J,EAAAC,cAAA,SAAOuP,QAAS+P,EAAUL,cAG5BvV,EAAA3J,EAAAC,cAAA,MAAIC,UAAU,aACZyJ,EAAA3J,EAAAC,cAAA,QAAM6K,MAAO,CAAEwL,gBAAiBiJ,EAAU5a,QACvC4a,EAAUC,SACT7V,EAAA3J,EAAAC,cAAA,KAAGE,KAAMof,EAAUC,SACjB/S,OAAO,SACPgT,IAAI,uBAAuBF,EAAUG,WAEvCH,EAAUG,YAKhB/V,EAAA3J,EAAAC,cAAA,MAAIC,UAAU,YACXqf,EAAUI,wBArDiB1c,aCA3B2c,mLAEV,IAAAve,EAAAM,KACP,OACEgI,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,WACbyJ,EAAA3J,EAAAC,cAAA,iCACA0J,EAAA3J,EAAAC,cAAA,SAAO4f,YAAY,KACjBlW,EAAA3J,EAAAC,cAAA,aACG0B,KAAK/B,MAAMkgB,QAAQzf,IAAI,SAAC0f,EAAQpS,GAAT,OACtBhE,EAAA3J,EAAAC,cAAC0J,EAAA3J,EAAM2D,SAAP,CAAgBlD,IAAKkN,GACnBhE,EAAA3J,EAAAC,cAAA,UACE0J,EAAA3J,EAAAC,cAAA,MAAIC,UAAU,QACZyJ,EAAA3J,EAAAC,cAAA,SACEO,GAAIuf,EAAOb,WACXhY,KAAK,QACL8Y,MAAM,UACNxR,QAASnN,EAAKzB,MAAMgM,WAAamU,EAAOb,WACxCrc,SAAUxB,EAAKzB,MAAMiD,SAASL,KAAKnB,EAAM0e,EAAOb,cAElDvV,EAAA3J,EAAAC,cAAA,SAAOuP,QAASuQ,EAAOb,YACrBvV,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,QAAQ6f,EAAOjR,QAInCnF,EAAA3J,EAAAC,cAAA,MAAIC,UAAU,aACV6f,EAAOE,UAAU5f,IAAI,SAAA6f,GAAI,OAAIvW,EAAA3J,EAAAC,cAAA,QAAMQ,IAAKyf,GAAOA,MAGnDvW,EAAA3J,EAAAC,cAAA,MAAIC,UAAU,eACX6f,EAAOI,cAIZxW,EAAA3J,EAAAC,cAAA,MAAIC,UAAU,gBAKtByJ,EAAA3J,EAAAC,cAAA,KAAGC,UAAU,QAAb,sHAtCqC+C,aCIxBmd,cAEnB,SAAAA,EAAYxgB,GAAO,IAAAyB,EAAA,OAAAmH,OAAAC,EAAA,EAAAD,CAAA7G,KAAAye,IACjB/e,EAAAmH,OAAAE,EAAA,EAAAF,CAAA7G,KAAA6G,OAAAG,EAAA,EAAAH,CAAA4X,GAAAxX,KAAAjH,KAAM/B,KAEDqB,MAAQ,CACXof,kBAAmB,GACnBC,sBAAuB,GAEvBC,gBAAiB,KACjBC,0BAA0B,EAC1BC,qBAAsB,IAGxBpf,EAAKqf,2BACLrf,EAAKsf,uBAbYtf,gFAiBjB,OAAOM,KAAKV,MAAMof,kBAAkB/a,OAAS,GAC3C3D,KAAKV,MAAMqf,sBAAsBhb,OAAS,iDAGvB,IAAA0C,EAAArG,KACuB,IAAxCA,KAAKV,MAAMof,kBAAkB/a,QAC/B2C,IAAMC,IAAI,oBACPC,KAAK,SAAAC,GACJ,IAAM4R,EAAO,CAAEqG,kBAAmBjY,EAAOxB,MAEpCoB,EAAK/G,MAAMsf,kBACdvG,EAAKuG,gBAAkBnY,EAAOxB,KAAK,IAAMwB,EAAOxB,KAAK,GAAGsY,YAE1DlX,EAAKpG,SAASoY,wDAIK,IAAAvL,EAAA9M,KACzBsG,IAAMC,IAAI,+BACPC,KAAK,SAAAC,GACJ,IAAM4R,EAAO,CAAEsG,sBAAuBlY,EAAOxB,OAEzC6H,EAAKxN,MAAMuf,2BACR/R,EAAKxN,MAAMuf,0BAAuE,IAA3C/R,EAAKxN,MAAMwf,qBAAqBnb,UAC5E0U,EAAKyG,qBAAuBrY,EAAOxB,KAAKvG,IAAI,SAAAL,GAAC,OAAIA,EAAEkf,cAErDzQ,EAAK7M,SAASoY,0CAIPkF,GACXvd,KAAKC,SAAS,CAAE2e,gBAAiBrB,mDAIjCvd,KAAKC,SAAS,SAAAmN,GACZ,MAAO,CAAEyR,0BAA2BzR,EAAKyR,sEAI3BlB,GAChB3d,KAAKC,SAAS,CAAE6e,qBAAsBnB,sCAItC,IAAMtE,EAAW,CAAE+E,OAAQpe,KAAKV,MAAMsf,iBAElC5e,KAAKV,MAAMuf,yBACbxF,EAAS4F,iBAAkB,EAE3B5F,EAASsE,YAAc3d,KAAKV,MAAMwf,qBAEpC9e,KAAK/B,MAAMihB,QAAQ7F,oCAInB,OACErR,EAAA3J,EAAAC,cAACmP,EAAA,EAAD,CACElP,UAAU,MACVL,MAAM,iCACNwP,QAAS1N,KAAK/B,MAAM0B,UAEpBqI,EAAA3J,EAAAC,cAAA,uIAKA0J,EAAA3J,EAAAC,cAAC6gB,EAAD,CACEhB,QAASne,KAAKV,MAAMof,kBACpBzU,SAAUjK,KAAKV,MAAMsf,gBACrB1d,SAAUlB,KAAKof,aAAave,KAAKb,QAEnCgI,EAAA3J,EAAAC,cAAC+gB,EAAD,CACE1B,YAAa3d,KAAKV,MAAMqf,sBACxBlB,OAAQzd,KAAKV,MAAMuf,yBACnB5U,SAAUjK,KAAKV,MAAMwf,qBACrBpB,YAAa1d,KAAKsf,qBAAqBze,KAAKb,MAC5CkB,SAAUlB,KAAKuf,kBAAkB1e,KAAKb,QAExCgI,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,WACbyJ,EAAA3J,EAAAC,cAAA,UACEC,UAAU,YACVoC,QAASX,KAAKkf,QAAQre,KAAKb,OAF7B,aAIAgI,EAAA3J,EAAAC,cAAA,UACEC,UAAU,qBACVoC,QAASX,KAAK/B,MAAM0B,UAFtB,mBAvG4B2B,aCGjBke,6MAEnBlgB,MAAQ,CACNmgB,SAAS,EACTtC,MAAO,QAGT7C,MAAQ,SAAA9L,GACN,IAAMkR,EAAgBhgB,EAAKzB,MAAMsR,UAAUoQ,WAAW3S,OAAO,SAAAtD,GAC3D,IAAMkW,EAA2B,aAAdlW,EAAKnE,KAClBsa,EAAenW,EAAKM,UAAUgD,OAAO,SAAAjJ,GAAC,OAAIA,EAAEmG,WAAW,UAASvG,OAAS,EAC/E,OAAOic,GAAcC,IAGjBC,EAAcjZ,OAAAuP,EAAA,EAAAvP,CAAA,GACf,CAAEkZ,UAAW,MAAOC,UAAWN,EAAchhB,IAAI,SAAAuhB,GAAC,OAAIA,EAAEphB,MACxD2P,GAGLlI,IAAMoS,KAAK,WAAYoH,GAAgBtZ,KAAK,SAAA6S,GAC1C3Z,EAAKO,SAAS,CACZwf,SAAS,EACTtC,MAAO9D,EAASpU,KAAKib,oFAMzB,OAAOlgB,KAAKV,MAAMmgB,QAChBzX,EAAA3J,EAAAC,cAAC6hB,EAAD,CACEhD,MAAOnd,KAAKV,MAAM6d,MAClBpD,WAAY/Z,KAAK/B,MAAM8b,WACvBrM,QAAS1N,KAAK/B,MAAMyP,UAEtB1F,EAAA3J,EAAAC,cAAC8hB,EAAD,CACElB,QAASlf,KAAKsa,MACd3a,SAAUK,KAAK/B,MAAM0B,kBApCkB2B,aCNzC+e,EAAS,WACb,IAAMC,EAAkBxgB,SAASsP,SAASoF,KAAK3K,UAAU,GACzD,OAAOyW,EAAe,eAAA1hB,OACL0hB,EADK,WACsB,uECAxCC,EAAS,CACb1iB,aAAc,eACdC,eAAgB,kBAGZ0iB,EAAa,SAAAviB,GAAK,OACtB+J,EAAA3J,EAAAC,cAAA,MACEC,UAAWN,EAAMgM,SAAW,kBAAoB,SAChDtJ,QAAS,kBAAM1C,EAAM4R,SAAS5R,EAAMyL,KAAK7K,MAAMZ,EAAMyL,KAAKxL,MACxDD,EAAMyL,KAAK+W,gBACXzY,EAAA3J,EAAAC,cAAA,UACEC,UAAU,eACVoC,QAAS,SAAAnB,GAAG,OAAIvB,EAAMyiB,eAAeziB,EAAMyL,KAAK7K,GAAIW,KAFtD,YAOAmhB,EAAuB,SAAA1iB,GAE3B,IAAM2iB,EAAU3iB,EAAMyL,KAAKM,UAAU,GAErC,OACEhC,EAAA3J,EAAAC,cAAA,MAAIC,UAAU,YACZyJ,EAAA3J,EAAAC,cAAA,OAAK+L,IAAG,kBAAAzL,OAAoB0L,IAAM/D,IAAIqa,IAAYrW,IAAG,aAAA3L,OAAegiB,KACnE3iB,EAAMyL,KAAKxL,QAKG2iB,cAEnB,SAAAA,EAAY5iB,GAAO,IAAAyB,EAAA,OAAAmH,OAAAC,EAAA,EAAAD,CAAA7G,KAAA6gB,IACjBnhB,EAAAmH,OAAAE,EAAA,EAAAF,CAAA7G,KAAA6G,OAAAG,EAAA,EAAAH,CAAAga,GAAA5Z,KAAAjH,KAAM/B,KAQR6iB,YAAc,SAAApL,GACZ,IAAM/W,EAAI+W,EAAKC,YAOf,MAAO,CACLvG,SALezQ,EAAEgF,OAAS,EAAXkD,OAAAuP,EAAA,EAAAvP,CAAA,GACVlI,EAAEA,EAAEgF,OAAS,GADH,CACOod,OAAQpiB,EAAEA,EAAEgF,OAAS,GAAG9E,KAC9CF,EAAEgF,OAAS,EAAIhF,EAAEA,EAAEgF,OAAS,GAAK,OAIjCoI,MAAO2J,EAAK3J,MACZ9B,SAAU,KACViL,WAAY,OArBGxV,EAyBnBiL,OAAS,SAAA9L,GAAE,OAAIa,EAAKO,SAAS,CAAEgK,SAAUpL,KAzBtBa,EA2BnBshB,WAAa,SAAAniB,GACX,IAAM2C,EACgB,iBAApB9B,EAAKzB,MAAME,KACPU,EAAE,qBAAAD,OAAwBC,GAAO,oBACjCA,EAAE,4BAAAD,OAA+BC,GAAO,2BAE9CyH,IAAMC,IAAI/E,GAAKgF,KAAK,SAAAC,GAClB/G,EAAKO,SAASP,EAAKohB,YAAYra,EAAOxB,UAlCvBvF,EAsCnBuhB,kBAAoB,WAClBvhB,EAAKO,SAAS,CACZmP,SAAU,QACVrD,MAAO,CACL,CAAE7N,MAAO,eAAgBuiB,gBAAgB,IAE3CxW,SAAU,KACViL,WAAY,QA7CGxV,EAiDnBwhB,WAAa,WASXxhB,EAAKO,SAAS,CAAEiV,WAAY,MARf,WAAM,IACT9F,EAAa1P,EAAKJ,MAAlB8P,SACS,SAAbA,EACF1P,EAAKuhB,oBAELvhB,EAAKshB,WAAW5R,EAAS2R,WAvDZrhB,EA6DnByhB,aAAe,SAACC,EAAU5hB,GACxBA,EAAIqL,kBAEJnL,EAAKO,SAAS,CAAEiV,WAAY,QADb,kBAAMxV,EAAKshB,WAAWI,MA/DpB1hB,EAmEnB2hB,KAAO,WAAM,IACH9R,EAAc7P,EAAKzB,MAAnBsR,UACF+R,EAAc5hB,EAAKJ,MAAM2K,SAEzB+V,EAAYzQ,EAAUgS,eACtBC,EAAUjS,EAAUkS,aAEpBC,EAAQ1B,EAAUrc,OAAS,EAC/B2C,IAAMqb,IAAI,qBAAsB,CAC9BC,OAAQ,UACRN,cACAtB,UAAWtgB,EAAKzB,MAAMsR,UAAUgS,eAAe7iB,IAAI,SAAAuhB,GAAC,OAAIA,EAAEphB,OACvDya,QAAQmD,UAEToF,EAAWL,EAAQ7d,OAAS,EAChC2C,IAAMqb,IAAI,mBAAoB,CAC5BC,OAAQ,UACRN,cACAE,QAAS9hB,EAAKzB,MAAMsR,UAAUkS,aAAa/iB,IAAI,SAAAuhB,GAAC,OAAIA,EAAEphB,OACnDya,QAAQmD,UAEfnD,QAAQC,IAAI,CAAEmI,EAAOG,IAAYrb,KAAK,kBAAM9G,EAAKzB,MAAM8b,gBAtFvDra,EAAKJ,MAAQI,EAAKohB,YAAY7iB,EAAMyX,MAFnBhW,wEA2FV,IAAA2G,EAAArG,KACD9B,EACoB,UAAxB8B,KAAKV,MAAM8P,SAAuB,YACR,SAAxBpP,KAAKV,MAAM8P,SAAsBmR,EAAOvgB,KAAK/B,MAAME,MAAQ6B,KAAKV,MAAM8P,SAASlR,MAE7EY,EACJkB,KAAKV,MAAM8P,SAASvQ,GAAKmB,KAAKV,MAAM8P,SAASvQ,GAAKmB,KAAKV,MAAM8P,SAEzDrD,EAAQ/L,KAAKV,MAAMyM,MAAMrN,IAAI,SAAA6b,GAAC,MAAe,aAAXA,EAAEhV,KACxCyC,EAAA3J,EAAAC,cAACwjB,EAAD,CACEhjB,IAAKyb,EAAE1b,GAAK0b,EAAE1b,GAAK0b,EAAErc,MACrBwL,KAAM6Q,IAERvS,EAAA3J,EAAAC,cAACyjB,EAAD,CACEjjB,IAAKyb,EAAE1b,GAAK0b,EAAE1b,GAAK0b,EAAErc,MACrBwL,KAAM6Q,EACNtQ,SAAU5D,EAAK/G,MAAM2K,WAAasQ,EAAE1b,GACpCgR,SAAUxJ,EAAKsE,OACf+V,eAAgBra,EAAK8a,iBAGzB,OACEnZ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,aACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,iBACbyJ,EAAA3J,EAAAC,cAAC0jB,EAAA3jB,EAAD,CAAWuU,OAAO,WAChB5K,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,wBACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,UACa,UAAxByB,KAAKV,MAAM8P,UACXpH,EAAA3J,EAAAC,cAAA,UACEC,UAAU,kBACVoC,QAASX,KAAKkhB,YAFhB,UAKFlZ,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,SAASL,GAEzB8J,EAAA3J,EAAAC,cAAA,UACEC,UAAU,sBACVoC,QAASX,KAAK/B,MAAM0B,UAFtB,WAKFqI,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,QACbyJ,EAAA3J,EAAAC,cAAC2jB,EAAA5jB,EAAD,CACE6jB,eAAe,OACfC,uBAAwB,IACxBC,uBAAwB,KAExBpa,EAAA3J,EAAAC,cAAA,MAAIC,UAAqC,OAA1ByB,KAAKV,MAAM4V,WAAsB,KAAO,OACnDpW,IAAKA,GAAMiN,KAKnB/D,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,UACbyJ,EAAA3J,EAAAC,cAAA,UACEC,UAAU,MACV8jB,SAAkC,OAAxBriB,KAAKV,MAAM2K,SACrBtJ,QAASX,KAAKqhB,MAHhB,yBAlJ2B/f,aC/BrCghB,6MAUJ/iB,UAAY,SAACC,GACO,KAAdA,EAAIC,OAAcC,EAAKzB,MAAMskB,2FARjCziB,SAASC,iBAAiB,UAAWC,KAAKT,WAAW,kDAIrDO,SAASM,oBAAoB,UAAWJ,KAAKT,WAAW,oCAQxD,IAAMhB,EAAayB,KAAK/B,MAAMsH,KAAZ,UAAA3G,OAA8BoB,KAAK/B,MAAMsH,KAAKid,eAAkB,SAElF,OACExa,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,aACbyJ,EAAA3J,EAAAC,cAAC0jB,EAAA3jB,EAAD,CAAWuU,OAAO,kBAChB5K,EAAA3J,EAAAC,cAAA,OAAKC,UAAWA,GACdyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,iBACbyJ,EAAA3J,EAAAC,cAAA,MAAIC,UAAU,SAASyB,KAAK/B,MAAMC,QAGpC8J,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,eACbyJ,EAAA3J,EAAAC,cAAA,KAAGC,UAAU,WAAWyB,KAAK/B,MAAMwkB,SACnCza,EAAA3J,EAAAC,cAAA,KAAGC,UAAU,WACVyJ,EAAA3J,EAAAC,cAAA,UAAQC,UAAU,UAAUoC,QAASX,KAAK/B,MAAMykB,OAAhD,OACA1a,EAAA3J,EAAAC,cAAA,UAAQC,UAAU,iBAAiBoC,QAASX,KAAK/B,MAAMskB,MAAvD,kBA7BIjhB,aAwCRqhB,EAAS,SAAA1kB,GACpB,IAAM2kB,EAAa9iB,SAASxB,cAAc,OAC1CskB,EAAWC,aAAa,KAAM,uBAC9B/iB,SAAS6c,KAAKlE,OAAOmK,GAYrB/F,iBACE7U,EAAA3J,EAAAC,cAACwkB,EAAD,CACE5kB,MAAOD,EAAMC,MACbqH,KAAMtH,EAAMsH,KACZkd,QAASxkB,EAAMwkB,QACfC,MAfU,WACZE,EAAW7F,SACX9e,EAAM8kB,aAcJR,KAXS,WACXK,EAAW7F,SACX9e,EAAM0B,UAAY1B,EAAM0B,cASNijB,IC7DhBI,6MAUJzjB,UAAY,SAACC,GACO,KAAdA,EAAIC,OAAcC,EAAKzB,MAAMyP,8FARjC5N,SAASC,iBAAiB,UAAWC,KAAKT,WAAW,kDAIrDO,SAASM,oBAAoB,UAAWJ,KAAKT,WAAW,oCAQxD,IAAMhB,EAAayB,KAAK/B,MAAMsH,KAAZ,UAAA3G,OAA8BoB,KAAK/B,MAAMsH,KAAKid,eAAkB,SAElF,OACExa,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,aACbyJ,EAAA3J,EAAAC,cAAC0jB,EAAA3jB,EAAD,CAAWuU,OAAO,kBAChB5K,EAAA3J,EAAAC,cAAA,OAAKC,UAAWA,GACdyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,iBACbyJ,EAAA3J,EAAAC,cAAA,MAAIC,UAAU,SAASyB,KAAK/B,MAAMC,QAGpC8J,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,eACbyJ,EAAA3J,EAAAC,cAAA,KAAGC,UAAU,WAAWyB,KAAK/B,MAAMwkB,SACnCza,EAAA3J,EAAAC,cAAA,KAAGC,UAAU,WACXyJ,EAAA3J,EAAAC,cAAA,UAAQC,UAAU,MAAMoC,QAASX,KAAK/B,MAAMyP,SAA5C,qBA5BIpM,aCDC2hB,6MAEnB3jB,MAAQ,CACN6I,WAAY,UACZC,aAAc,cAWhB8a,cAAgB,SAACC,GACfzjB,EAAKO,SAASkjB,EAAQ,WACpB7c,IAAMoS,KAAK,kCAAX7R,OAAAuP,EAAA,EAAAvP,CAAA,GACKnH,EAAKJ,MADV,CACiB8jB,IAAK,CAAE1jB,EAAKzB,MAAMyL,KAAK7K,OACrCua,MAAM,SAAAvB,WAMbwL,mBAAqB,SAAClb,GACpBzI,EAAKwjB,cAAc,CAAE/a,WAAYA,OAGnCmb,oBAAsB,SAAC9jB,GACrBE,EAAKwjB,cAAc,CAAE9a,aAAc5I,EAAIsL,OAAO3K,4FAvB5B,IAAAkG,EAAArG,KAClBsG,IAAMC,IAAN,wBAAA3H,OAAkCoB,KAAK/B,MAAMyL,KAAK7K,GAAlD,gBACG2H,KAAK,SAAAC,GAAU,IAAA8c,EACuB9c,EAAOxB,KAApCkD,EADMob,EACNpb,WAAYC,EADNmb,EACMnb,aACpB/B,EAAKpG,SAAS,CAAEkI,WAAYA,EAAYC,aAAcA,GAAgB,gDAsBnE,IAAA0E,EAAA9M,KACP,OACEgI,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,iBACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,uBACbyJ,EAAA3J,EAAAC,cAAA,kCACA0J,EAAA3J,EAAAC,cAAA,WACE0J,EAAA3J,EAAAC,cAAA,SACEiH,KAAK,QACL4H,KAAK,gBAAgBtO,GAAG,SACxBgO,QAAmC,YAA1B7M,KAAKV,MAAM6I,WACpBjH,SAAU,kBAAM4L,EAAKuW,mBAAmB,cAC1Crb,EAAA3J,EAAAC,cAAA,SAAOuP,QAAQ,UAAf,OACA7F,EAAA3J,EAAAC,cAAA,0EAKF0J,EAAA3J,EAAAC,cAAA,WACE0J,EAAA3J,EAAAC,cAAA,SACEiH,KAAK,QACL4H,KAAK,gBACLtO,GAAG,YACHgO,QAAmC,WAA1B7M,KAAKV,MAAM6I,WACpBjH,SAAU,kBAAM4L,EAAKuW,mBAAmB,aAC1Crb,EAAA3J,EAAAC,cAAA,SAAOuP,QAAQ,aAAf,qBACA7F,EAAA3J,EAAAC,cAAA,yGAKF0J,EAAA3J,EAAAC,cAAA,WACE0J,EAAA3J,EAAAC,cAAA,SACEiH,KAAK,QACL4H,KAAK,gBACLtO,GAAG,eACHgO,QAAmC,cAA1B7M,KAAKV,MAAM6I,WACpBjH,SAAU,kBAAM4L,EAAKuW,mBAAmB,gBAC1Crb,EAAA3J,EAAAC,cAAA,SAAOuP,QAAQ,gBAAf,wBACA7F,EAAA3J,EAAAC,cAAA,gGAMJ0J,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,uBACbyJ,EAAA3J,EAAAC,cAAA,yBADF,cAGE0J,EAAA3J,EAAAC,cAAA,UAAQ6B,MAAOH,KAAKV,MAAM8I,aAAclH,SAAUlB,KAAKsjB,qBACrDtb,EAAA3J,EAAAC,cAAA,UAAQ6B,MAAM,YAAd,QACA6H,EAAA3J,EAAAC,cAAA,UAAQ6B,MAAM,aAAd,mDACA6H,EAAA3J,EAAAC,cAAA,UAAQ6B,MAAM,SAAd,aAGF6H,EAAA3J,EAAAC,cAAA,gUAOA0J,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,UACbyJ,EAAA3J,EAAAC,cAAA,UAAQC,UAAU,MAAMoC,QAASX,KAAK/B,MAAMyP,SAA5C,mBA9F8BpM,sBCApCkiB,6MAYJC,YAAc,SAACjkB,IACWE,EAAKgkB,MAAMC,SAASnkB,EAAIsL,SAC5BpL,EAAKzB,MAAM0B,cAGjCJ,UAAY,SAACC,GACXA,EAAIqL,kBACc,KAAdrL,EAAIC,OAAcC,EAAKzB,MAAM0B,cAGnCikB,aAAc,WACZlkB,EAAKzB,MAAM0B,+FApBXG,SAASC,iBAAiB,YAAaC,KAAKyjB,aAAa,GACzD3jB,SAASC,iBAAiB,UAAWC,KAAKT,WAAW,kDAIrDO,SAASM,oBAAoB,YAAaJ,KAAKyjB,aAAa,GAC5D3jB,SAASM,oBAAoB,UAAWJ,KAAKT,WAAW,uCAiB9C8I,GACVrI,KAAK/B,MAAM4lB,cAAcxb,oCAGlB,IAAAhC,EAAArG,KACP,OACEgI,EAAA3J,EAAAC,cAAA,OACEC,UAAU,sBACV0M,IAAK,SAAAtN,GAAC,OAAI0I,EAAKqd,MAAQ/lB,IAEvBqK,EAAA3J,EAAAC,cAAA,6BACE0J,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,qBAAqBoC,QAASX,KAAK4jB,cAAe,WAEpE5b,EAAA3J,EAAAC,cAAA,UACE0J,EAAA3J,EAAAC,cAAA,MACEC,UAAU,OACVoC,QAAS,kBAAM0F,EAAKyd,YAAY,UAChC9b,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,WACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,QACe,SAA3ByB,KAAK/B,MAAM8lB,aAA0B,WAG1C/b,EAAA3J,EAAAC,cAAA,kBACA0J,EAAA3J,EAAAC,cAAA,4EAGF0J,EAAA3J,EAAAC,cAAA,MACEC,UAAU,QACVoC,QAAS,kBAAM0F,EAAKyd,YAAY,WAChC9b,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,WACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,QACe,UAA3ByB,KAAK/B,MAAM8lB,aAA2B,WAG3C/b,EAAA3J,EAAAC,cAAA,mBACA0J,EAAA3J,EAAAC,cAAA,iHAGF0J,EAAA3J,EAAAC,cAAA,MACEC,UAAU,QACVoC,QAAS,kBAAM0F,EAAKyd,YAAY,WAChC9b,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,WACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,QACe,UAA3ByB,KAAK/B,MAAM8lB,aAA2B,WAG3C/b,EAAA3J,EAAAC,cAAA,mBACA0J,EAAA3J,EAAAC,cAAA,yIAzEqBgD,2BCCZ0iB,8MAEnB1kB,MAAQ,CACN2kB,WAAW,EACXC,QAAS,GACTja,SAAU,KACVka,WAAY,QAGdC,iBAAmB,SAAAC,GACjB3kB,EAAKO,SAAS,CAACgkB,WAAW,IAC1B,IAAMK,EAAU5kB,EAAKzB,MAAMqmB,QAAU5kB,EAAKzB,MAAMqmB,QAAU,GAC1Dhe,IAAMC,IAAN,yBAAA3H,OAAmCylB,IAChC7d,KAAK,SAAAC,GAAM,OAAI/G,EAAKO,SAAS,CAC5BgkB,WAAW,EACXC,QAASzd,EAAOxB,KAAK+H,OAAO,SAAApL,GAAQ,OAAK0iB,EAAQ1X,SAAShL,YAIhEV,SAAW,SAAC+I,GACVvK,EAAKO,SAAS,CAAEgK,SAAUA,OAG5Bsa,cAAgB,SAACpkB,GACfT,EAAKO,SAAS,CAAEkkB,WAAYhkB,OAG9BqkB,MAAQ,WACN9kB,EAAKgL,OAAO+Z,cAAcD,QAC1B9kB,EAAKO,SAAS,CACZgK,SAAU,KACVka,WAAY,UAIhBhZ,UAAY,SAAC3L,GAAQ,IAAAklB,EACuBhlB,EAAKJ,MAAvC2K,EADWya,EACXza,SAAUka,EADCO,EACDP,WAAYD,EADXQ,EACWR,QACZ,KAAd1kB,EAAIC,QACFwK,GAAgC,IAApBA,EAAStG,OACvBjE,EAAKzB,MAAM4R,SAAS5F,EAAS,IACtBka,GAAcD,EAAQtX,SAASuX,IACtCzkB,EAAKzB,MAAM4R,SAASsU,6EAIjB,IAAA9d,EAAArG,KACP,OACEgI,EAAA3J,EAAAC,cAACqmB,GAAA,eAAD,CACE9lB,GAAG,YACHoM,IAAK,SAAA2Z,GAAC,OAAIve,EAAKqE,OAASka,GACxBrmB,UAAU,cACVyY,YAAahX,KAAK/B,MAAM+Y,aAAe,iBACvC/M,SAAUjK,KAAKV,MAAM2K,SACrB/I,SAAUlB,KAAKkB,SACfqjB,cAAevkB,KAAKukB,cACpBpZ,UAAWnL,KAAKmL,UAChB8Y,UAAWjkB,KAAKV,MAAM2kB,UACtBY,SAAU7kB,KAAKokB,iBACfF,QAASlkB,KAAKV,MAAM4kB,iBA1DY5iB,aCCnBwjB,8MAEnBxlB,MAAQ,CACN6G,cAAe,MAUjB4e,kBAAoB,SAACC,GACnB1e,IAAMoS,KAAK,oCAAX7R,OAAAuP,EAAA,EAAAvP,CAAA,GACKme,EADL,CACc5B,IAAK,CAAE1jB,EAAKzB,MAAMyL,KAAK7K,OAClCua,MAAM,SAAAvB,SAKXoN,wBAA0B,SAACzlB,EAAK0lB,IF2D3B,SAAsB1W,GAC3B,IAAMuS,EAASvS,EAAOuS,OAChBoE,EAAOrlB,SAASxB,cAAc,OACpCyiB,EAAOtI,OAAO0M,GAWdtI,iBACE7U,EAAA3J,EAAAC,cAAC8mB,EAAD,CACErB,YAAavV,EAAOuV,YACpBF,cARkB,SAACxb,GACrBmG,EAAOqV,cAAcxb,GACrB8c,EAAKpI,UAOHpd,SAba,WACfwlB,EAAKpI,YAaPoI,GE3EEE,CAAa,CACXtE,QAHqC,WAAxBvhB,EAAIsL,OAAOwa,SAAwB9lB,EAAIsL,OAAStL,EAAIsL,OAAOya,YAGzDA,WACfxB,YAAamB,EAAa9c,aAE1Byb,cAAe,SAAAxb,GACb,IAAM8a,EAAQ,CAAEvhB,SAAUsjB,EAAatjB,SAAUwG,aAAcC,GAC/D3I,EAAKqlB,kBAAkB5B,GACvBzjB,EAAKO,SAAS,SAAAmN,GACZ,MAAO,CACLjH,cAAeiH,EAAKjH,cAAczH,IAAI,SAAAgU,GACpC,OAAQA,EAAE9Q,WAAasjB,EAAatjB,SAAYuhB,EAASzQ,aAQrE8S,mBAAqB,SAAAN,GACnBxlB,EAAKO,SAAS,SAAAmN,GACZ,MAAO,CAAEjH,cAAeiH,EAAKjH,cAAc6G,OAAO,SAAA0F,GAAC,OAAIA,EAAE9Q,WAAasjB,EAAatjB,cAGrF0E,IAAMmf,OAAO,oCAAqC,CAAExgB,KAAM,CACxDme,IAAK,CAAE1jB,EAAKzB,MAAMyL,KAAK7K,IACvB+C,SAAUsjB,EAAatjB,YACrBwX,MAAM,SAAAvB,SAKZ6N,gBAAkB,SAAA9jB,GAChB,IAAMuhB,EAAS,CAAEvhB,SAAUA,EAAUwG,aAAc,QACnD1I,EAAKqlB,kBAAkB5B,GACvBzjB,EAAKO,SAAS,SAAAmN,GACZ,MAAO,CACLjH,cAAcU,OAAA8e,EAAA,EAAA9e,CAAOuG,EAAKjH,eAAbvH,OAAA,CAA4BukB,2FAtD3B,IAAA9c,EAAArG,KAClBsG,IAAMC,IAAN,wBAAA3H,OAAkCoB,KAAK/B,MAAMyL,KAAK7K,GAAlD,mBACC2H,KAAK,SAAAC,GACJJ,EAAKpG,SAAS,CAAEkG,cAAeM,EAAOxB,KAAKkB,mDAwDtC,IAAA2G,EAAA9M,KACDmG,EAAgBnG,KAAKV,MAAM6G,cAAczH,IAAI,SAAAgU,GAAC,OAClD1K,EAAA3J,EAAAC,cAAA,MAAIQ,IAAK4T,EAAE9Q,UACToG,EAAA3J,EAAAC,cAAA,UAAKoU,EAAE9Q,UACPoG,EAAA3J,EAAAC,cAAA,UACE0J,EAAA3J,EAAAC,cAAA,UACEC,UAAU,wBACVoC,QAAS,SAACnB,GAAD,OAASsN,EAAKmY,wBAAwBzlB,EAAKkT,KACpD1K,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,SAASmU,EAAEtK,cAC3BJ,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,QAAQ,YAG5ByJ,EAAA3J,EAAAC,cAAA,MAAIC,UAAU,mCACZyJ,EAAA3J,EAAAC,cAAA,UACEC,UAAU,uBACVoC,QAAS,kBAAMmM,EAAK0Y,mBAAmB9S,KAAK,cAKpD,OACE1K,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,iBACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,uBACbyJ,EAAA3J,EAAAC,cAAA,2BACA0J,EAAA3J,EAAAC,cAAA,SAAOC,UAAU,iBACfyJ,EAAA3J,EAAAC,cAAA,aACG6H,EAAcxC,OAAS,EACpBwC,EAAgB6B,EAAA3J,EAAAC,cAAA,MAAIC,UAAU,oBAAmByJ,EAAA3J,EAAAC,cAAA,oFAM3D0J,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,wCACbyJ,EAAA3J,EAAAC,cAACsnB,GAAD,CACEtB,QAAStkB,KAAKV,MAAM6G,cAAczH,IAAI,SAAAgU,GAAC,OAAIA,EAAE9Q,WAC7CiO,SAAU7P,KAAK0lB,kBAEjB1d,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,UACbyJ,EAAA3J,EAAAC,cAAA,UAAQC,UAAU,MAAMoC,QAASX,KAAK/B,MAAMyP,SAA5C,mBAxG+BpM,aCFtBukB,8MAEnBvmB,MAAQ,CACNwmB,WAAY,MAGdC,gBAAkB,SAAAC,GAChBtmB,EAAKO,SAAS,SAAAmN,GACZ,MAAO,CAAE0Y,WAAY1Y,EAAK0Y,WAAW9Y,OAAO,SAAA4X,GAAC,OAAIA,IAAMoB,UAI3DC,aAAe,SAAAD,GACbtmB,EAAKO,SAAS,SAAAmN,GACZ,MAAO,CAAE0Y,WAAWjf,OAAA8e,EAAA,EAAA9e,CAAOuG,EAAK0Y,YAAblnB,OAAA,CAAyBonB,UAIhDE,WAAa,qFAIJ,IAAA7f,EAAArG,KACD8lB,EAAa9lB,KAAKV,MAAMwmB,WAAWpnB,IAAI,SAAAkmB,GAAC,OAC5C5c,EAAA3J,EAAAC,cAAA,MAAIQ,IAAK8lB,GACP5c,EAAA3J,EAAAC,cAAA,UACGsmB,EACD5c,EAAA3J,EAAAC,cAAA,UACEC,UAAU,sBACVoC,QAAS,kBAAM0F,EAAK0f,gBAAgBnB,KAFtC,cAON,OACE5c,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,qBACbyJ,EAAA3J,EAAAC,cAAA,4BAEA0J,EAAA3J,EAAAC,cAAA,SAAOC,UAAU,cACfyJ,EAAA3J,EAAAC,cAAA,aACIwnB,EAAWniB,OAAS,EAAImiB,EACxB9d,EAAA3J,EAAAC,cAAA,UAAI0J,EAAA3J,EAAAC,cAAA,MAAIC,UAAU,kBAAd,2BAIVyJ,EAAA3J,EAAAC,cAACsnB,GAAD,CACEtB,QAAStkB,KAAKV,MAAMwmB,WAAWpnB,IAAI,SAAAgU,GAAC,OAAIA,EAAE9Q,WAC1CiO,SAAU7P,KAAKimB,eAEjBje,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,UACbyJ,EAAA3J,EAAAC,cAAA,UACEC,UAAU,MACV8jB,SAAgC,IAAtByD,EAAWniB,OACrBhD,QAASX,KAAKkmB,YAHhB,YAKAle,EAAA3J,EAAAC,cAAA,UAAQC,UAAU,MAAMoC,QAASX,KAAK/B,MAAMyP,SAA5C,kBAvDoCpM,aCGzB6kB,8MAEnB7mB,MAAQ,CACNnB,KAAM,mBAWRoB,UAAY,SAACC,GACXA,EAAIqL,kBACc,KAAdrL,EAAIC,OAAcC,EAAKzB,MAAMyP,aAGnC0Y,QAAU,SAACjZ,GACTzN,EAAKO,SAAS,CAAE9B,KAAMgP,OAGxBkZ,QAAU,WACR,MAAwB,kBAApB3mB,EAAKJ,MAAMnB,KACN6J,EAAA3J,EAAAC,cAACgoB,EAAD,CAAc5c,KAAMhK,EAAKzB,MAAMsR,UAAUhJ,IAAI,GAAImH,QAAShO,EAAKzB,MAAMyP,UACjD,kBAApBhO,EAAKJ,MAAMnB,KACX6J,EAAA3J,EAAAC,cAACioB,GAAD,CAAe7c,KAAMhK,EAAKzB,MAAMsR,UAAUhJ,IAAI,GAAImH,QAAShO,EAAKzB,MAAMyP,UAClD,sBAApBhO,EAAKJ,MAAMnB,KACX6J,EAAA3J,EAAAC,cAACkoB,GAAD,CAAkB9c,KAAMhK,EAAKzB,MAAMsR,UAAUhJ,IAAI,GAAImH,QAAShO,EAAKzB,MAAMyP,eAD7E,sFArBL5N,SAASC,iBAAiB,UAAWC,KAAKT,WAAW,kDAIrDO,SAASM,oBAAoB,UAAWJ,KAAKT,WAAW,oCAqBjD,IAAA8G,EAAArG,KACP,OACEgI,EAAA3J,EAAAC,cAACmP,EAAA,EAAD,CACElP,UAAU,oBACVL,MAAM,QACNwP,QAAS1N,KAAK/B,MAAMyP,SACpB1F,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,eACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,oBACbyJ,EAAA3J,EAAAC,cAAA,UACE0J,EAAA3J,EAAAC,cAAA,MACEC,UAA+B,kBAApByB,KAAKV,MAAMnB,KAA2B,SAAW,GAC5DwC,QAAS,kBAAM0F,EAAK+f,QAAQ,mBAF9B,iBAMApe,EAAA3J,EAAAC,cAAA,MACEC,UAA+B,kBAApByB,KAAKV,MAAMnB,KAA2B,SAAW,GAC5DwC,QAAS,kBAAM0F,EAAK+f,QAAQ,mBAF9B,iBAMApe,EAAA3J,EAAAC,cAAA,MAAIC,UAAU,YAAd,uBAMJyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,oBACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,kBACXyB,KAAKqmB,qBA7DmB/kB,aCDlCmlB,8MAEJnnB,MAAQ,CACNonB,YAAa,QAWfC,MAAQ,WAYNhE,EAAO,CACLzkB,MAAO,oBACPukB,QANW,qJAOXld,KAAM,UACNwd,UAfmB,WACnBzc,IAAMoS,KAAN,iBAAA9Z,OAA4Bc,EAAKzB,MAAMgM,SAAvC,gBAAArL,OAA8Dc,EAAKzB,MAAMY,KACtE2H,KAAK,SAAA6S,GAAQ,OAAI3Z,EAAKzB,MAAM2oB,2GAXf,IAAAvgB,EAAArG,KACV6mB,EAAc7mB,KAAK/B,MAAnB4oB,UACJA,GACFvgB,IAAMC,IAAN,iBAAA3H,OAA2BoB,KAAK/B,MAAMY,GAAtC,+BAAAD,OAAsEkoB,mBAAmBD,KACtFrgB,KAAK,SAAA6S,GAAQ,OAAIhT,EAAKpG,SAAS,CAAEymB,YAAarN,EAASpU,KAAK8hB,mDAwB1D,IAAAja,EAAA9M,KACCgnB,EAAmBhnB,KAAK/B,MAAM0D,QAA9BqlB,gBACF7T,EAAanT,KAAK/B,MAAMgM,WAAajK,KAAK/B,MAAMY,GAEtD,OACEmJ,EAAA3J,EAAAC,cAAA,UACE0J,EAAA3J,EAAAC,cAAA,QAAMC,UAAW4U,EAAa,kBAAoB,UAChDnL,EAAA3J,EAAAC,cAAA,KAAGE,KAAI,IAAAI,OAAMoB,KAAK/B,MAAMkU,QACpBnS,KAAK/B,MAAMkU,OAFjB,MAGSnK,EAAA3J,EAAAC,cAAA,KAAGE,KAAI,aAAAI,OAAeoB,KAAK/B,MAAMY,KACpCmB,KAAK/B,MAAMY,KAGfmB,KAAKV,MAAMonB,YAAc,GACzB1e,EAAA3J,EAAAC,cAAA0J,EAAA3J,EAAA2D,SAAA,KACEgG,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,eAAhB,KAAiCyB,KAAKV,MAAMonB,YAA5C,UACEM,GAAmBA,EAAgBpa,SAAS,qBAAuBuG,GACnEnL,EAAA3J,EAAAC,cAAA,UAAQC,UAAU,iBAAiBoC,QAASX,KAAK2mB,OAAjD,sBAIJ3mB,KAAK/B,MAAMgB,UACX+I,EAAA3J,EAAAC,cAAA,UACI0B,KAAK/B,MAAMgB,SAASP,IAAI,SAAAuoB,GAAG,OAC3Bjf,EAAA3J,EAAAC,cAACmoB,EAAD5f,OAAAqgB,OAAA,CACEpoB,IAAKmoB,EAAIpoB,GACT8C,QAASmL,EAAK7O,MAAM0D,QACpBsI,SAAU6C,EAAK7O,MAAMgM,SACrB2c,gBAAiB9Z,EAAK7O,MAAM2oB,iBACxBK,eA/DU3lB,aAyET6lB,8MAEnB7nB,MAAQ,CACN8nB,QAAS,QAoBX7nB,UAAY,SAACC,GACXA,EAAIqL,kBACc,KAAdrL,EAAIC,OAAc+N,EAAKvP,MAAMyP,8FAnBf,IAAA2Z,EAAArnB,KAEZsnB,EAAQtnB,KAAK/B,MAAMsR,UAAUhJ,IAAI,GAAG1H,GAE1CyH,IAAMC,IAAN,iBAAA3H,OAA2B0oB,EAA3B,aACG9gB,KAAK,SAAA6S,GAEJgO,EAAKpnB,SAAS,CAAEmnB,QAAS/N,EAASpU,SAGtCnF,SAASC,iBAAiB,UAAWC,KAAKT,WAAW,kDAIrDO,SAASM,oBAAoB,UAAWJ,KAAKT,WAAW,oCASxD,OACEyI,EAAA3J,EAAAC,cAACmP,EAAA,EAAD,CACElP,UAAU,wBACVL,MAAM,kBACNwP,QAAS1N,KAAK/B,MAAMyP,SACpB1F,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,mBACXyB,KAAKV,MAAM8nB,SACXpf,EAAA3J,EAAAC,cAAA,UACE0J,EAAA3J,EAAAC,cAACipB,GAAD1gB,OAAAqgB,OAAA,CACEvlB,QAAS3B,KAAK/B,MAAM0D,SAChB3B,KAAKV,MAAM8nB,QAAQjC,KAFzB,CAGElb,SAAUjK,KAAK/B,MAAMsR,UAAUhJ,IAAI,GAAG1H,GACtC+nB,gBAAiB5mB,KAAK/B,MAAM2oB,6BAzCFtlB,aCjE3BkmB,GAAA,CACbC,atB8B0B,WAC1B,OAAO,IAAInO,QAAQ,SAAAmD,GACjB,IAAMC,EAAY5c,SAASxB,cAAc,OACzCwB,SAAS6c,KAAKC,YAAYF,GAmB1BG,iBACE7U,EAAA3J,EAAAC,cAACopB,EAAD,CACE/Q,KAnBS,SAAAE,GACX,IAAMyJ,EAAkBxgB,SAASsP,SAASoF,KAAK3K,UAAU,GAEzDvD,IAAMoS,KAAK,cAAe,CACxBxa,MAAO2Y,GAAc,iBACrBkK,OAAQT,IACP9Z,KAAK,WACNkW,EAAUK,SACVN,OAYA9c,SARa,WACf+c,EAAUK,SACVN,OAM0BC,MsBtD9BiL,atB0D0B,SAACC,EAAQ1pB,GACnC,OAAOoI,IAAMqb,IAAN,eAAA/iB,OAAyBgpB,EAAO/oB,IAAM,CAC3C+iB,OAAQ,SACR1jB,MAAOA,KsB5DT2a,cACAgP,ajB4G0B,SAACC,EAAKtmB,GAChC,IAAMkZ,EAAaoN,GApDE,SAAAtmB,GACrB,OAAIA,EAAIoL,SAAS,sBACR,MACApL,EAAIumB,SAAS,QACb,UACAvmB,EAAIoL,SAAS,mBACb,UAEA,OA4CiBob,CAAexmB,GACzC,MAAY,UAARsmB,EkBzHG,IAAIxO,QAAQ,SAAAmD,GACjB,IAAMC,EAAY5c,SAASxB,cAAc,OACzCwB,SAAS6c,KAAKC,YAAYF,GAE1B,IAAMuL,EAAY,SAAAnZ,GAChB4N,EAAUK,SACVN,EAAQ3N,IAGV+N,iBACE7U,EAAA3J,EAAAC,cAAC4pB,EAAD,CACExa,QAASua,EACT/M,cAAe+M,IAAevL,KlB8GTlW,KAAK,SAAAsI,GAC5B,GAAIA,EACF,OAAO+J,EAAY/J,KAEdtN,EACFgb,EAAc,GAAI,CAAEhb,IAAKA,EAAKkZ,WAAYA,IA5E5C,IAAIpB,QAAQ,SAAAmD,GACjB,IAAMC,EAAY5c,SAASxB,cAAc,OACzCwB,SAAS6c,KAAKC,YAAYF,GAE1B,IAAMyL,EAAO,SAAA3mB,GACXkb,EAAUK,SACVN,EAAQjb,IAGVqb,iBACE7U,EAAA3J,EAAAC,cAAC8pB,EAAD,CACEzR,KAAMwR,EACNxoB,SAAU,kBAAMwoB,OAAYzL,KAkEVlW,KAAK,SAAAhF,GACzB,GAAIA,EACF,OAAOgb,EAAc,GAAI,CAAEhb,IAAKA,EAAKkZ,WAAYA,OiBvHvD2N,aXR0B,SAASzS,EAAQ0S,GAC3C,OAAOhiB,IAAMoS,KAAK2H,IAAU,CAAEpb,KAAM2Q,IAAUpP,KAAK,WACjD,OAAOK,OAAAuP,EAAA,EAAAvP,CAAA,GAAKyhB,EAAqB,CAAE1S,OAAQA,OWO7C2S,aXH0B,SAASD,GACnC,OAAOhiB,IAAMmf,OAAOpF,KAAU7Z,KAAK,WACjC,OAAOK,OAAAuP,EAAA,EAAAvP,CAAA,GAAKyhB,EAAqB,CAAE1S,OAAQ,UWE7C4S,gBEY6B,SAAAlZ,GAAQ,IAGnCC,EAMED,EANFC,UACApR,EAKEmR,EALFnR,KACA+gB,EAIE5P,EAJF4P,QACAuJ,EAGEnZ,EAHFmZ,UACAC,EAEEpZ,EAFFoZ,QACA/oB,EACE2P,EADF3P,SA0BFgjB,EAAO,CACLzkB,MAAO,SACPukB,QAzBuB,iBAATtkB,EACd,4EACA,yFAwBAoH,KAAM,UACNwd,UAvBoB,WACpB,IAAMvB,EAAUjS,EAAUoQ,WAAW3S,OAAO,SAAA9B,GAAC,MAAe,WAAXA,EAAE3F,OAC7Cya,EAAYzQ,EAAUoQ,WAAW3S,OAAO,SAAA9B,GAAC,MAAe,aAAXA,EAAE3F,OAEjDic,EAAQ7d,OAASqc,EAAUrc,OAAS,GACtCub,IApCkB,SAACc,EAAW7hB,GAClC,IAAMilB,EAAMpD,EAAUthB,IAAI,SAAAuhB,GAAC,OAAIA,EAAEphB,KAEjC,OAAIukB,EAAIzf,OAAS,EACO,IAAfyf,EAAIzf,OACA,iBAATxF,EACEmI,IAAMmf,OAAN,iBAAA7mB,OAA8BwkB,EAAI,KAAQ9c,IAAMmf,OAAN,wBAAA7mB,OAAqCwkB,EAAI,KAE5E,iBAATjlB,EACEmI,IAAMmf,OAAO,qBAAsB,CAAExgB,KAAMme,IAAS9c,IAAMmf,OAAO,4BAA6B,CAAExgB,KAAMme,IAGnG,IAAI9J,QAAQ,SAACmD,GAAcA,MA0BhCkM,CAAgB3I,EAAW7hB,GACxBqI,KAAK,kBAnDQ,SAAAgb,GACpB,IAAM4B,EAAM5B,EAAQ9iB,IAAI,SAAA6b,GAAC,OAAIA,EAAE1b,KAE/B,OAAIukB,EAAIzf,OAAS,EACO,IAAfyf,EAAIzf,OACT2C,IAAMmf,OAAN,eAAA7mB,OAA4BwkB,EAAI,KAChC9c,IAAMmf,OAAN,mBAAiC,CAAExgB,KAAMme,IAEpC,IAAI9J,QAAQ,SAACmD,GAAcA,MA2ClBmM,CAAcpH,KACzBhb,KAAK,WACJiiB,MACCrP,MAAM,SAACvB,GACR6Q,EAAQ7Q,MAGZlY,GAAYA,KASdA,SAAUA,KFlDZkpB,cGjB2B,SAAAvZ,GAE3B,IAAMoN,EAAY5c,SAASxB,cAAc,OACzCwB,SAAS6c,KAAKC,YAAYF,GAW1BG,iBACE7U,EAAA3J,EAAAC,cAACwqB,EAAD,CACE3qB,KAAMmR,EAAKnR,KACXuX,KAAMpG,EAAKoG,KACXnG,UAAWD,EAAKC,UAChBwK,WAde,WACjB2C,EAAUK,SACVzN,EAAKyK,cAaHpa,SAVa,WACf+c,EAAUK,YASgBL,IHF5BqM,mBEuDgC,SAAAxZ,GAChC,GAAIA,EAAUyZ,mBAAoB,CAChC,IAAM/B,EAAM1X,EAAUhJ,IAAI,GAC1B,OAAOD,IAAMoS,KAAN,uBAAA9Z,OAAkCqoB,EAAIpoB,KAAMua,MAAM,SAAAvB,IVrCxC,SAAA5Z,GACnB,IAAM2kB,EAAa9iB,SAASxB,cAAc,OAC1CskB,EAAWC,aAAa,KAAM,cAC9B/iB,SAAS6c,KAAKlE,OAAOmK,GAOrB/F,iBACE7U,EAAA3J,EAAAC,cAAC2qB,EAAD,CACE/qB,MAAOD,EAAMC,MACbqH,KAAMtH,EAAMsH,KACZkd,QAASxkB,EAAMwkB,QACf/U,QAVY,WACdkV,EAAW7F,SACX9e,EAAMyP,SAAWzP,EAAMyP,aAQCkV,GU2BtBsG,CAAM,CACJhrB,MAAO,QACPqH,KAAM,UACNkd,QAPwC,MAA1B5K,EAAMwB,SAAS/B,OAC7B,sDACA,kCASJ,OAAO,IAAIgC,QAAQ,SAACmD,GAAcA,OFrEpC0M,eInB4B,SAAA5Z,GAE5B,OAAO,IAAI+J,QAAQ,SAAAmD,GACjB,IAAMC,EAAY5c,SAASxB,cAAc,OACzCwB,SAAS6c,KAAKC,YAAYF,GAO1BG,iBACE7U,EAAA3J,EAAAC,cAAC8qB,GAAD,CACE7Z,UAAWA,EACX7B,QARU,SAAAlM,GACZkb,EAAUK,SACVN,OAMsBC,MJM1B2M,eKpB4B,SAAC9Z,EAAW5N,GAExC,OAAO,IAAI2X,QAAQ,SAAAmD,GACjB,IAAMC,EAAY5c,SAASxB,cAAc,OACzCwB,SAAS6c,KAAKC,YAAYF,GAE1B,IAAMd,EAAQ,SAAApa,GACZkb,EAAUK,SACVN,KAGFI,iBACE7U,EAAA3J,EAAAC,cAACgrB,GAAD,CACE/Z,UAAWA,EACX5N,QAASA,EACT+L,QAASkO,EACTgL,gBAAiBhL,IAAWc,MLKlC6M,kBMrB+B,SAAAha,GAE/B,OAAO,IAAI+J,QAAQ,SAAAmD,GACjB,IAAMC,EAAY5c,SAASxB,cAAc,OACzCwB,SAAS6c,KAAKC,YAAYF,GAE1B,IAIMhP,EAAU,WACdgP,EAAUK,UAGZF,iBACE7U,EAAA3J,EAAAC,cAACkrB,EAAD,CACEja,UAAWA,EACX5P,SAAU+N,EACVA,QAASA,EACTqM,WAbe,WACjB0C,OAY8BC,4CCiB9B+M,eAEJ,SAAAA,EAAYxrB,GAAO,IAAAyB,EAAA,OAAAmH,OAAAC,EAAA,EAAAD,CAAA7G,KAAAypB,IACjB/pB,EAAAmH,OAAAE,EAAA,EAAAF,CAAA7G,KAAA6G,OAAAG,EAAA,EAAAH,CAAA4iB,GAAAxiB,KAAAjH,KAAM/B,KACDwlB,YAAc/jB,EAAK+jB,YAAY5iB,KAAjBgG,OAAA6iB,GAAA,EAAA7iB,QAAA6iB,GAAA,EAAA7iB,CAAAnH,KACnBA,EAAKH,UAAYG,EAAKH,UAAUsB,KAAfgG,OAAA6iB,GAAA,EAAA7iB,QAAA6iB,GAAA,EAAA7iB,CAAAnH,KAHAA,mFAOjBI,SAASC,iBAAiB,YAAaC,KAAKyjB,aAAa,GACzD3jB,SAASC,iBAAiB,UAAWC,KAAKT,WAAW,kDAIrDO,SAASM,oBAAoB,YAAaJ,KAAKyjB,aAAa,GAC5D3jB,SAASM,oBAAoB,UAAWJ,KAAKT,WAAW,uCAG9CC,IACcQ,KAAK0jB,MAAMC,SAASnkB,EAAIsL,SAC5B9K,KAAK/B,MAAM0B,6CAGvBH,GACU,KAAdA,EAAIC,OAAcO,KAAK/B,MAAM0B,4CAG1B,IAAA0G,EAAArG,KACP,OACEgI,EAAA3J,EAAAC,cAAA,OACE2M,IAAK,SAAAtN,GAAC,OAAI0I,EAAKqd,MAAQ/lB,GACvBY,UAAS,cAAAK,OAAgBoB,KAAK/B,MAAMM,YACpCyJ,EAAA3J,EAAAC,cAAA,UACI0B,KAAK/B,MAAMgB,kBAjCJqC,aAyCnBmoB,GAAKE,MA/Ea,SAAA1rB,GAEhB,IAAM2rB,EAAa3rB,EAAMM,UACvB,CAAE,QAASN,EAAMM,WAAc,CAAE,SAEnC,OACEyJ,EAAA3J,EAAAC,cAAA,MACEC,UAAWqrB,EAAW5R,KAAK,MAC3BhQ,EAAA3J,EAAAC,cAAA,UACGL,EAAMgB,YAuEfwqB,GAAKI,KAhEY,SAAA5rB,GAEf,OACE+J,EAAA3J,EAAAC,cAAA,MACEQ,IAAKb,EAAMG,MACXG,UAAS,SAAAK,OAAWX,EAAMokB,SAAW,YAAc,IACnD1hB,QAAU1C,EAAMokB,WAAapkB,EAAM4R,SAAY,KAAO5R,EAAM4R,UAE3D5R,EAAM6rB,KACL9hB,EAAA3J,EAAAC,cAAA,KAAGE,KAAMP,EAAM6rB,MACZ7rB,EAAM8rB,MAAQ/hB,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,QAAQN,EAAM8rB,MAD/C,IAC+D9rB,EAAMG,OAGrE4J,EAAA3J,EAAAC,cAAA,YACGL,EAAM8rB,MAAQ/hB,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,QAAQN,EAAM8rB,MAD/C,IAC8D9rB,EAAMG,SAoD7DqrB,UCjFTvqB,GAAgB,CACpBmlB,MAAe,GACf2F,GAAe,MACfzkB,KAAe,MACf4M,MAAe,GACf8X,aAAe,WAGIC,eAEnB,SAAAA,EAAYjsB,GAAO,IAAAyB,EAAA,OAAAmH,OAAAC,EAAA,EAAAD,CAAA7G,KAAAkqB,IACjBxqB,EAAAmH,OAAAE,EAAA,EAAAF,CAAA7G,KAAA6G,OAAAG,EAAA,EAAAH,CAAAqjB,GAAAjjB,KAAAjH,KAAM/B,KA4BRksB,iBAAmB,SAAA3qB,GAAG,OAAIE,EAAKO,SAAS,CAAE+pB,GAAIxqB,EAAIsL,OAAO3K,SA7BtCT,EA+BnB0qB,gBAAkB,SAAA5qB,GAAG,OAAIE,EAAKO,SAAS,CAAEsF,KAAM/F,EAAIsL,OAAO3K,SA/BvCT,EAiCnB2qB,cAAgB,SAAAlY,GAAK,OAAIzS,EAAKO,SAAS,CAAEkS,MAAOA,KAjC7BzS,EAmCnB4qB,cAAgB,SAAA9qB,GAAG,OAAIE,EAAKO,SAAS,CAAEokB,MAAO7kB,EAAIsL,OAAO3K,SAnCtCT,EAqCnB6qB,qBAAuB,SAAA/qB,GAAG,OAAIE,EAAKO,SAAS,CAAEgqB,aAAczqB,EAAIsL,OAAO3K,SArCpDT,EAuCnB8qB,QAAU,SAAAhrB,GACRA,EAAIoL,iBACJlL,EAAKO,SAAL4G,OAAAuP,EAAA,EAAAvP,CAAA,GAAmB3H,MAzCFQ,EA4CnBmlB,SAAW,SAAArlB,GACTA,EAAIoL,iBACJlL,EAAKzB,MAAM4mB,SAASnlB,EAAKJ,QA3CzBI,EAAKJ,MAALuH,OAAAuP,EAAA,EAAAvP,CAAA,GAAkB3H,IAElBQ,EAAK+jB,YAAc/jB,EAAK+jB,YAAY5iB,KAAjBgG,OAAA6iB,GAAA,EAAA7iB,QAAA6iB,GAAA,EAAA7iB,CAAAnH,KACnBA,EAAKH,UAAYG,EAAKH,UAAUsB,KAAfgG,OAAA6iB,GAAA,EAAA7iB,QAAA6iB,GAAA,EAAA7iB,CAAAnH,KANAA,mFAUjBI,SAASC,iBAAiB,YAAaC,KAAKyjB,aAAa,GACzD3jB,SAASC,iBAAiB,UAAWC,KAAKT,WAAW,kDAIrDO,SAASM,oBAAoB,YAAaJ,KAAKyjB,aAAa,GAC5D3jB,SAASM,oBAAoB,UAAWJ,KAAKT,WAAW,uCAG9CC,GACV,IAAMirB,GAAkBzqB,KAAK0jB,MAAMC,SAASnkB,EAAIsL,QAC1C4f,EAAkBlrB,EAAIsL,OAAO6f,UAAUhH,SAAS,YAClD8G,IAAmBC,GAAiB1qB,KAAK/B,MAAMyP,4CAG3ClO,GACU,KAAdA,EAAIC,OAAcO,KAAK/B,MAAMyP,2CAuB1B,IAAArH,EAAArG,KACP,OACEgI,EAAA3J,EAAAC,cAAA,OACE2M,IAAK,SAAAtN,GAAC,OAAI0I,EAAKqd,MAAQ/lB,GACvBY,UAAU,mBACVyJ,EAAA3J,EAAAC,cAAA,UACEC,UAAU,gBACVoC,QAASX,KAAK/B,MAAMyP,SAFtB,UAIA1F,EAAA3J,EAAAC,cAAA,YACE0J,EAAA3J,EAAAC,cAAA,gBACE0J,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,SACbyJ,EAAA3J,EAAAC,cAAA,0BACA0J,EAAA3J,EAAAC,cAAA,UACE6B,MAAOH,KAAKV,MAAMsrB,SAClB1pB,SAAUlB,KAAKmqB,kBACfniB,EAAA3J,EAAAC,cAAA,UAAQ6B,MAAM,OAAd,mBACA6H,EAAA3J,EAAAC,cAAA,UAAQ6B,MAAM,MAAd,gBACA6H,EAAA3J,EAAAC,cAAA,UAAQ6B,MAAM,UAAd,mBAEF6H,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,UAGlByJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,SACbyJ,EAAA3J,EAAAC,cAAA,8BACA0J,EAAA3J,EAAAC,cAAA,UACE6B,MAAOH,KAAKV,MAAMshB,QAClB1f,SAAUlB,KAAKoqB,iBACfpiB,EAAA3J,EAAAC,cAAA,UAAQ6B,MAAM,OAAd,OACA6H,EAAA3J,EAAAC,cAAA,UAAQ6B,MAAM,QAAd,QACA6H,EAAA3J,EAAAC,cAAA,UAAQ6B,MAAM,SAAd,SACA6H,EAAA3J,EAAAC,cAAA,UAAQ6B,MAAM,SAAd,UAEF6H,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,UAGlByJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,SACbyJ,EAAA3J,EAAAC,cAAA,sBACA0J,EAAA3J,EAAAC,cAACsnB,GAAD,CACE/V,SAAU7P,KAAKqqB,gBACjBriB,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,UAGlByJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,SACbyJ,EAAA3J,EAAAC,cAAA,kCACA0J,EAAA3J,EAAAC,cAAA,SACEiH,KAAK,OACLpF,MAAOH,KAAKV,MAAM+kB,MAClBnjB,SAAUlB,KAAKsqB,gBACjBtiB,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,UAGlByJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,SACbyJ,EAAA3J,EAAAC,cAAA,8BACA0J,EAAA3J,EAAAC,cAAA,UACE6B,MAAOH,KAAKV,MAAM2qB,aAClB/oB,SAAUlB,KAAKuqB,sBACfviB,EAAA3J,EAAAC,cAAA,UAAQ6B,MAAM,WAAd,YACA6H,EAAA3J,EAAAC,cAAA,UAAQ6B,MAAM,QAAd,cAEF6H,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,WAIpByJ,EAAA3J,EAAAC,cAAA,YAAUC,UAAU,WAClByJ,EAAA3J,EAAAC,cAAA,UAAQiH,KAAK,SAAShH,UAAU,gBAAgBoC,QAASX,KAAKwqB,SAA9D,SACAxiB,EAAA3J,EAAAC,cAAA,UAAQiH,KAAK,SAAShH,UAAU,MAAMoC,QAASX,KAAK6kB,UAApD,oBArHgCvjB,aCNtCupB,GAAc,CAClBhtB,aAAiB,KACjBC,eAAiB,UAGEgtB,eAEnB,SAAAA,EAAY7sB,GAAO,IAAAyB,EAAA,OAAAmH,OAAAC,EAAA,EAAAD,CAAA7G,KAAA8qB,IACjBprB,EAAAmH,OAAAE,EAAA,EAAAF,CAAA7G,KAAA6G,OAAAG,EAAA,EAAAH,CAAAikB,GAAA7jB,KAAAjH,KAAM/B,KAiBRsB,UAAY,SAAAC,GACQ,KAAdA,EAAIC,OAAgBC,EAAKzB,MAAM8sB,cACjCrrB,EAAKO,SAAS,CAAEokB,MAAO,KACvB3kB,EAAKzB,MAAM+sB,WArBItrB,EAyBnBurB,qBAAuB,WACrBvrB,EAAKO,SAAS,SAAAmN,GAAI,MAAK,CACrB8d,oBAAqB9d,EAAK8d,mBAC1B7G,MAAO,OA5BQ3kB,EAgCnByrB,cAAgB,SAAA7b,GACd,IAAMrK,EAAI4B,OAAAuP,EAAA,EAAAvP,CAAA,GACLyI,EACA5P,EAAKzB,MAAMmtB,aAGhB9kB,IAAMoS,KAAK,cAAezT,GAAMuB,KAAK,SAAAC,GACnC/G,EAAKzB,MAAMotB,WAAW5kB,EAAOxB,SAvCdvF,EA2CnBmlB,SAAW,SAAArlB,GACT,IAAM6kB,EAAQ7kB,EAAIsL,OAAO3K,MAGzB,GAFAT,EAAKO,SAAS,CAAEokB,MAAOA,IAEF,IAAjBA,EAAM1gB,OACRjE,EAAKzB,MAAM+sB,cACN,GAAI3G,EAAM1gB,OAAS,EAAG,CAC3B,IAAM2nB,EAAQ5rB,EAAKzB,MAAM8sB,YACvBrrB,EAAKzB,MAAM8sB,YAAcrrB,EAAKzB,MAAME,KAEtCuB,EAAKyrB,cAAc,CACjBI,EAAGlH,EACH2F,GAAIa,GAAYS,OAvDH5rB,EA4DnB8rB,eAAiB,SAAAC,GACf,IAAMnc,EAAO,CACXic,EAAQE,EAASpH,MAAQoH,EAASpH,MAAQ,KAC1C2F,GAAQyB,EAASzB,GACjBzkB,KAAQkmB,EAASlmB,KACjB4M,MAAQsZ,EAAStZ,MAAQsZ,EAAStZ,MAAQ,MAG5CzS,EAAKO,SAAS,CAAEirB,oBAAoB,GAClC,kBAAMxrB,EAAKyrB,cAAc7b,MAnE3B5P,EAAKJ,MAAQ,CACX+kB,MAAO,GACP6G,oBAAoB,GAEtBxrB,EAAKgsB,QAAU5rB,SAAS6rB,eAAe,OANtBjsB,mFAUjBM,KAAK0rB,QAAQ3rB,iBAAiB,UAAWC,KAAKT,WAAW,kDAKzDS,KAAK0rB,QAAQtrB,oBAAoB,UAAWJ,KAAKT,WAAW,oCA0D5D,IAAMyX,EAAkC,iBAApBhX,KAAK/B,MAAME,KAC7B,sBACoB,mBAApB6B,KAAK/B,MAAME,KAA4B,0BAA4B,GAErE,OACE6J,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,WACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,UACbyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,WACbyJ,EAAA3J,EAAAC,cAAA,SACE0Y,YAAaA,EACb7W,MAAOH,KAAKV,MAAM+kB,MAClBnjB,SAAUlB,KAAK6kB,WACjB7c,EAAA3J,EAAAC,cAAA,UACEC,UAAU,wBACVoC,QAASX,KAAKirB,qBAAqBpqB,KAAKb,OAAQ,WAEpDgI,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,kBAAhB,WAEDyB,KAAKV,MAAM4rB,oBACVljB,EAAA3J,EAAAC,cAACstB,GAAD,CACEjqB,QAAS3B,KAAK/B,MAAM0D,QACpBkjB,SAAU7kB,KAAKwrB,eACf9d,QAAS1N,KAAKirB,+BAjGU3pB,aCH9BuqB,GAAc,SAAA5tB,GAElB,IAAM6tB,EACJ7tB,EAAMsR,UAAUyZ,oBAAqC,iBAAf/qB,EAAME,KAExC4tB,EACJ9tB,EAAMsR,UAAUyc,kBAAmC,iBAAf/tB,EAAME,KAEtC8tB,EACJhuB,EAAMsR,UAAUyZ,qBACf/qB,EAAMsR,UAAUhJ,IAAI,GAAG+C,YAAcrL,EAAMsR,UAAUhJ,IAAI,GAAG6C,aAS/D,OACEpB,EAAA3J,EAAAC,cAAC4tB,GAAD,CACE3tB,UAAU,yBACVoB,SAAU1B,EAAM0B,UAEhBqI,EAAA3J,EAAAC,cAAC4tB,GAAKvC,MAAN,KACE3hB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CACEzrB,MAAM,OACNikB,UAAWpkB,EAAMsR,UAAU4c,oBAC3BrC,KAAM7rB,EAAMsR,UAAU4c,qBAAhB,YAAAvtB,OAAmDX,EAAMsR,UAAUhJ,IAAI,GAAG1H,GAA1E,kBAERmJ,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CACEzrB,MAAM,kBACNikB,UAAWpkB,EAAMsR,UAAUyZ,mBAC3BnZ,SArBa,WACnBV,OAAO6F,KAAP,YAAApW,OAAwBX,EAAMsR,UAAUhJ,IAAI,GAAG1H,GAA/C,gBAAiE,UACjEZ,EAAM0B,eAsBJqI,EAAA3J,EAAAC,cAAC4tB,GAAKvC,MAAN,KACE3hB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CACEE,KAAM,SACN3rB,MAAM,UACNyR,SAAU5R,EAAMmuB,kBAElBpkB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CACEE,KAAM,SACN3rB,MAAM,YACNikB,UAAWyJ,EACXjc,SAAU5R,EAAMouB,uBAElBrkB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CACEE,KAAM,SACN3rB,MAAM,SACNyR,SAAU5R,EAAMquB,qBAGpBtkB,EAAA3J,EAAAC,cAAC4tB,GAAKvC,MAAN,KACE3hB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CACEE,KAAM,SACN3rB,MAAM,QACNikB,UAAW0J,EACXlc,SAAU5R,EAAMsuB,mBAElBvkB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CACEE,KAAM,SACN1H,UAAW4J,EACX7tB,MAAM,kBACNyR,SAAU5R,EAAMuuB,oBAGpBxkB,EAAA3J,EAAAC,cAAC4tB,GAAKvC,MAAN,KACE3hB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CACEE,KAAM,SACN3rB,MAAM,2BACNikB,UAAWpkB,EAAMsR,UAAUkd,eAC3B5c,SAAU5R,EAAMyuB,WAOLC,8MAEnBrtB,MAAQ,CACNstB,oBAAoB,KAGtBC,gBAAkB,WAChBntB,EAAKO,SAAS,CAAE2sB,oBAAoB,OAGtCE,iBAAmB,WACjBptB,EAAKO,SAAS,CAAE2sB,oBAAoB,OAItCG,aAAe,SAAAC,GACb,OAAO,SAAA1d,GACL5P,EAAKO,SAAS,CAAE2sB,oBAAoB,IACpCI,EAAG1d,6EAKL,IAAM2d,GAAgBjtB,KAAK/B,MAAMsR,UAAU2d,UAE3C,OACEllB,EAAA3J,EAAAC,cAAA,OAAKC,UAAWyB,KAAK/B,MAAM2X,OAAS,SAAW,oBAC7C5N,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,WACbyJ,EAAA3J,EAAAC,cAAC6uB,GAAD,CACExrB,QAAS3B,KAAK/B,MAAM0D,QACpBxD,KAAM6B,KAAK/B,MAAME,KACjBqX,aAAcxV,KAAK/B,MAAMuX,aACzBuV,YAAa/qB,KAAK/B,MAAM8sB,YACxBK,YAAaprB,KAAK/B,MAAMmtB,YACxBC,WAAYrrB,KAAK/B,MAAMmvB,iBACvBpC,OAAQhrB,KAAK/B,MAAMovB,eAErBrlB,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,gBACbyJ,EAAA3J,EAAAC,cAACgvB,GAAA,EAAD,CAAYvD,KAAK,SAAWxrB,UAAU,eAAeurB,KAAK,YAI9D9hB,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,eACbyJ,EAAA3J,EAAAC,cAACN,GAAA,EAAD,CACEG,KAAM6B,KAAK/B,MAAME,KACjBM,KAAMuB,KAAK/B,MAAM0X,YACjB5W,SAAUiB,KAAK/B,MAAMc,WAEnBiB,KAAK/B,MAAM2X,QAA8B,iBAApB5V,KAAK/B,MAAME,MAChC6J,EAAA3J,EAAAC,cAAA,UACEC,UAAU,uBACVoC,QAASX,KAAK/B,MAAMsvB,gBACpBvlB,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,QAAhB,UACAyJ,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,SAAhB,0BAKNyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,qBACdyJ,EAAA3J,EAAAC,cAACkvB,GAAA,cAAD,CACGxD,GAAIiD,EACJQ,QAAS,IACT7D,WAAW,qBAEX5hB,EAAA3J,EAAAC,cAAA,OACEC,UAAU,oBACVoC,QAASX,KAAK6sB,iBACd7kB,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,SAAhB,WACAyJ,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,aAAhB,YAIFyB,KAAKV,MAAMstB,oBACX5kB,EAAA3J,EAAAC,cAACovB,GAAD,CACE/rB,QAAS3B,KAAK/B,MAAM0D,QACpBxD,KAAM6B,KAAK/B,MAAME,KACjBoR,UAAWvP,KAAK/B,MAAMsR,UACtB6c,gBAAiBpsB,KAAK+sB,aAAa/sB,KAAK/B,MAAMmuB,iBAC9CC,qBAAsBrsB,KAAK+sB,aAAa/sB,KAAK/B,MAAMouB,sBACnDC,kBAAmBtsB,KAAK+sB,aAAa/sB,KAAK/B,MAAMquB,mBAChDC,iBAAkBvsB,KAAK+sB,aAAa/sB,KAAK/B,MAAMsuB,kBAC/CC,iBAAkBxsB,KAAK+sB,aAAa/sB,KAAK/B,MAAMuuB,kBAC/CE,MAAO1sB,KAAK+sB,aAAa/sB,KAAK/B,MAAMyuB,OACpC/sB,SAAUK,KAAK8sB,mBAEnB9kB,EAAA3J,EAAAC,cAACgvB,GAAA,EAAD,CACE/uB,UAAU,8BACVwrB,KAAkC,UAA5B/pB,KAAK/B,MAAMuX,aAA2B,SAAW,SACvD7U,QAASX,KAAK/B,MAAM0vB,iCAxFErsB,iCCnFfssB,8MAEnBtuB,MAAQ,CACNuuB,aAAa,KAGfC,SAAW,WACTpuB,EAAKO,SAAS,CAAE4tB,aAAa,OAG/BE,UAAY,WACVruB,EAAKO,SAAS,CAAE4tB,aAAa,6EAI7B,OACE7lB,EAAA3J,EAAAC,cAAA,OACEC,UAAU,kBACVoC,QAASX,KAAK8tB,UAEd9lB,EAAA3J,EAAAC,cAACiD,GAAA,EAAD,CACEI,QAAS3B,KAAK/B,MAAM0D,UAEpB3B,KAAKV,MAAMuuB,aACX7lB,EAAA3J,EAAAC,cAAC4tB,GAAD,CACE3tB,UAAU,eACVoB,SAAUK,KAAK+tB,WAEf/lB,EAAA3J,EAAAC,cAAC4tB,GAAKvC,MAAN,KACE3hB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CAAWE,KAAM,SAAU3rB,MAAM,mBAAmB0rB,KAAK,uBAG3D9hB,EAAA3J,EAAAC,cAAC4tB,GAAKvC,MAAN,KACE3hB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CAAWE,KAAM,SAAU3rB,MAAM,OAAO0rB,KAAK,UAC7C9hB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CAAWE,KAAM,SAAU3rB,MAAM,WAAW0rB,KAAK,sBAlC1BxoB,aCDhB0sB,8MAEnB1uB,MAAQ,CACNuuB,aAAa,KAIfI,WAAa,WACXvuB,EAAKO,SAAS,CAAE4tB,aAAa,OAG/BK,YAAc,WACZxuB,EAAKO,SAAS,CAAE4tB,aAAa,OAG/BM,mBAAqB,WACnBzuB,EAAKgL,OAAO0jB,WAGdlT,cAAgB,SAAA1b,GACd,IAAMsP,EAAQxL,MAAMwQ,KAAKtU,EAAIsL,OAAOgE,OACpCpP,EAAKzB,MAAMid,cAAcpM,MAI3BnE,OAAS,SAACqiB,GACR,OAAO,WACLttB,EAAKO,SAAS,CAAE4tB,aAAa,IAC7Bb,QAIJqB,WAAa,SAAAlhB,GACX,OAAOzN,EAAKzB,MAAM0D,QAAQqlB,iBAAmBtnB,EAAKzB,MAAM0D,QAAQqlB,gBAAgBpa,SAASO,4EAGlF,IAAA9G,EAAArG,KACP,OACEgI,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,sBACbyJ,EAAA3J,EAAAC,cAAA,UACEC,UAAU,iBACVoC,QAASX,KAAKiuB,YACdjmB,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,QAAhB,UACAyJ,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,SAAhB,QAGFyJ,EAAA3J,EAAAC,cAAA,SACE2M,IAAK,SAAAyH,GAAC,OAAIrM,EAAKqE,OAASgI,GACxBnN,KAAK,OACL4H,KAAK,OACLmhB,UAAQ,EACRptB,SAAUlB,KAAKkb,cACf/R,MAAO,CAAE6S,QAAS,UAEnBhc,KAAKV,MAAMuuB,aACV7lB,EAAA3J,EAAAC,cAAC4tB,GAAD,CACE3tB,UAAU,aACVoB,SAAUK,KAAKkuB,aAEflmB,EAAA3J,EAAAC,cAAC4tB,GAAKvC,MAAN,KACE3hB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CACEE,KAAM,SACN3rB,MAAM,SACNyR,SAAU7P,KAAK2K,OAAO3K,KAAK/B,MAAMswB,kBAEnCvmB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CACEE,KAAM,SACN3rB,MAAM,cACNyR,SAAU7P,KAAK2K,OAAO3K,KAAKmuB,uBAG/BnmB,EAAA3J,EAAAC,cAAC4tB,GAAKvC,MAAN,KACE3hB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CACEE,KAAM,SACN3rB,MAAM,qBACNyR,SAAU7P,KAAK2K,OAAO,kBAAMtE,EAAKpI,MAAMuwB,eAAe,YAExDxmB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CACEE,KAAM,SACN3rB,MAAM,mBACNyR,SAAU7P,KAAK2K,OAAO,kBAAMtE,EAAKpI,MAAMuwB,eAAe,WAEtDxuB,KAAKquB,WAAW,SAChBrmB,EAAA3J,EAAAC,cAAC4tB,GAAKrC,KAAN,CACEE,KAAM,SACN3rB,MAAM,YACNyR,SAAU7P,KAAK2K,OAAO,kBAAMtE,EAAKpI,MAAMuwB,eAAe,uBAtFhCltB,aCDlCmtB,GAAe,SAAAxwB,GAEnB,OACE+J,EAAA3J,EAAAC,cAAA,MACEC,UAAWN,EAAMywB,QAAU,UAAY,KACvC/tB,QAAS1C,EAAM0C,SACfqH,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,QAAQN,EAAM8rB,MAHhC,IAII9rB,EAAMgB,WA+BC0vB,GAxBD,SAAA1wB,GAEZ,OACE+J,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,iBACbyJ,EAAA3J,EAAAC,cAAA,UACE0J,EAAA3J,EAAAC,cAACswB,GAAD,CACE7E,KAAK,SACL2E,QAAwB,iBAAfzwB,EAAME,KACfwC,QAAS,kBAAM1C,EAAM4wB,aAAa,kBAHpC,gBAOA7mB,EAAA3J,EAAAC,cAACswB,GAAD,CACE7E,KAAK,SACL2E,QAAwB,mBAAfzwB,EAAME,KACfwC,QAAS,kBAAM1C,EAAM4wB,aAAa,oBAHpC,yCCMOC,GA9BC,SAAA7wB,GAEd,IAAMyD,EAAgBzD,EAAM0D,SAAW1D,EAAM0D,QAAQotB,QAC/CC,EAAQttB,EAAgBzD,EAAM0D,QAAQotB,QAAQE,SAAW,EACzDC,EAAOxtB,EAAgBzD,EAAM0D,QAAQotB,QAAQI,QAAU,EAE7D,OACEnnB,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,mBACbyJ,EAAA3J,EAAAC,cAAA,QAAMC,UAAU,QAAhB,UADF,WAEEyJ,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,kBACbyJ,EAAA3J,EAAAC,cAAC2Z,EAAD,CACE9X,MAAQ6uB,EAAQ,EAAK5d,KAAKC,IAAI,EAAG6d,EAAOF,GAAS,IAEnDhnB,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,SACbyJ,EAAA3J,EAAAC,cAACiK,GAAAlK,EAAD,CACEqG,YAAY,OACZvE,MAAO+uB,EACPtqB,mBAAmB,IACpB,QACDoD,EAAA3J,EAAAC,cAACiK,GAAAlK,EAAD,CACEqG,YAAY,OACZvE,MAAO6uB,EACPpqB,mBAAmB,IATvB,mCCOOwqB,GApBI,SAAAnxB,GAEjB,OACE+J,EAAA3J,EAAAC,cAAC0J,EAAA3J,EAAM2D,SAAP,KACEgG,EAAA3J,EAAAC,cAAC6E,GAAA,EAAD,CACE5E,UAAU,UACVuG,MAAO,IACPC,OAAQ,GACRxB,KAAK,UACLa,MAAOnG,EAAM0D,SAAW1D,EAAM0D,QAAQyC,QAExC4D,EAAA3J,EAAAC,cAAC4H,GAAA,EAAD,CACE3H,UAAU,wBACVL,MAAM,uBACN0D,SAAU3D,EAAM0D,SAAW1D,EAAM0D,QAAQC,aCgBlCytB,GA3BC,SAAApxB,GAEd,OACE+J,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,WACbyJ,EAAA3J,EAAAC,cAACgxB,GAAD,CACE3tB,QAAS1D,EAAM0D,UAEjBqG,EAAA3J,EAAAC,cAACixB,GAAD,CACE5tB,QAAS1D,EAAM0D,QACf4sB,eAAgBtwB,EAAMswB,eACtBrT,cAAejd,EAAMid,cACrBsT,eAAgBvwB,EAAMuwB,iBAExBxmB,EAAA3J,EAAAC,cAACkxB,GAAD,CACErxB,KAAMF,EAAME,KACZ0wB,aAAc5wB,EAAM4wB,eAEtB7mB,EAAA3J,EAAAC,cAACmxB,GAAD,CACE9tB,QAAS1D,EAAM0D,UAEjBqG,EAAA3J,EAAAC,cAACoxB,GAAD,CACE/tB,QAAS1D,EAAM0D,gCCoDRguB,GAxEG,SAAA1xB,GAEhB,OACE+J,EAAA3J,EAAAC,cAAC0J,EAAA3J,EAAM2D,SAAP,KACEgG,EAAA3J,EAAAC,cAACsxB,GAAD,CACEjuB,QAAS1D,EAAM0D,QACfxD,KAAMF,EAAME,KACZ0wB,aAAc5wB,EAAM4wB,aACpBN,eAAgBtwB,EAAMswB,eACtBrT,cAAejd,EAAMid,cACrBsT,eAAgBvwB,EAAMuwB,iBAExBxmB,EAAA3J,EAAAC,cAAA,OAAKC,UAAU,gBACbyJ,EAAA3J,EAAAC,cAACuxB,GAAD,CACEluB,QAAS1D,EAAM0D,QACfxD,KAAMF,EAAME,KACZqX,aAAcvX,EAAMuX,aACpBuV,YAAa9sB,EAAM8sB,YACnBK,YAAantB,EAAMmtB,YACnBxV,OAAQ3X,EAAMyX,KAAKE,OACnBD,YAAa1X,EAAMyX,KAAKC,YACxB5W,SAAUd,EAAMyX,KAAKG,YACrBtG,UAAWtR,EAAMsR,UACjBoe,qBAAsB1vB,EAAM0vB,qBAC5BJ,eAAgBtvB,EAAMsvB,eACtBnB,gBAAiBnuB,EAAMmuB,gBACvBC,qBAAsBpuB,EAAMouB,qBAC5BC,kBAAmBruB,EAAMquB,kBACzBC,iBAAkBtuB,EAAMsuB,iBACxBC,iBAAkBvuB,EAAMuuB,iBACxBE,MAAOzuB,EAAMyuB,MACbU,iBAAkBnvB,EAAMmvB,iBACxBC,aAAcpvB,EAAMovB,eAEpBpvB,EAAMyX,KAAKE,QACX5N,EAAA3J,EAAAC,cAACe,GAAA,EAAD,CACEkB,QAAStC,EAAMyX,KAAKE,OACpBtV,SAAUrC,EAAM6xB,eAChBzvB,SAAUpC,EAAM8xB,iBAGK,UAAvB9xB,EAAMuX,cACNxN,EAAA3J,EAAAC,cAACyP,GAAA,EAAD,CACEhC,MAAO9N,EAAMyX,KAAK3J,MAClByC,OAAQvQ,EAAMmtB,YACd7b,UAAWtR,EAAMsR,UACjBa,KAAMnS,EAAMmS,KACZE,eAA+B,iBAAfrS,EAAME,KACtB0R,SAAU5R,EAAM4R,SAChBxE,OAAQpN,EAAM+xB,YACd3hB,qBAAsBpQ,EAAMoQ,qBAC5BqB,eAAgBzR,EAAMyR,eACtBR,YAAajR,EAAMid,cACnB7L,gBAAiB,SAAA7N,GAAG,OAAIvD,EAAMuwB,eAAe,KAAMhtB,MAG9B,SAAvBvD,EAAMuX,cACNxN,EAAA3J,EAAAC,cAAC0S,GAAA,EAAD,CACEjF,MAAO9N,EAAMyX,KAAK3J,MAClBwD,UAAWtR,EAAMsR,UACjBa,KAAMnS,EAAMmS,KACZE,eAA+B,iBAAfrS,EAAME,KACtB0R,SAAU5R,EAAM4R,SAChBX,YAAajR,EAAMid,cACnB7L,gBAAiB,SAAA7N,GAAG,OAAIvD,EAAMuwB,eAAe,KAAMhtB,2DC7D1CyuB,eAEnB,SAAAA,EAAYhyB,GAAO,IAAAyB,EAAA,OAAAmH,OAAAC,EAAA,EAAAD,CAAA7G,KAAAiwB,IACjBvwB,EAAAmH,OAAAE,EAAA,EAAAF,CAAA7G,KAAA6G,OAAAG,EAAA,EAAAH,CAAAopB,GAAAhpB,KAAAjH,KAAM/B,KA2BRsB,UAAY,SAAAC,GACQ,KAAdA,EAAIC,MAENC,EAAKO,SAAS,CAAEsP,UAAW,IAAIsD,MACR,KAAdrT,EAAIC,OAAiBC,EAAKJ,MAAMiQ,UAAU2d,WAEnDxtB,EAAK8oB,mBAlCU9oB,EAuCnB+jB,YAAc,SAAAjkB,KAEVM,SAASowB,cAAc,mBAAmBvM,SAASnkB,EAAIsL,SACvDhL,SAASowB,cAAc,sBAAsBvM,SAASnkB,EAAIsL,UAGxCpL,EAAKO,SAAS,CAAEsP,UAAW,IAAIsD,OA7ClCnT,EAqDnBywB,YAAc,WACZzwB,EAAKO,SAAS,CAAEmQ,MAAM,IAEtB,IAAMgR,EAAWthB,SAASsP,SAASoF,KAAK3K,UAAU,GAE5CpL,EAA4B,iBAApBiB,EAAKJ,MAAMnB,KACrBijB,EAAD,MAAAxiB,OAAmBwiB,GAAa,KAC/BA,EAAD,aAAAxiB,OAA0BwiB,GAAa,YAEpC5S,EAAqC,SAA5B9O,EAAKJ,MAAMkW,aAA0B,KAClD,CACEnO,QAASG,IAAQ4oB,wBAAwB1wB,EAAKJ,MAAMwW,aAAazO,SACjEgpB,KAAM3wB,EAAKJ,MAAMwW,aAAarH,SAGlC,OAAOnI,IAAMoS,KAAN,kBAAA9Z,OAA6BH,GAAQ+P,GAAQhI,KAAK,SAAAC,GACvD/G,EAAKO,SAAS,SAAAmN,GAAQ,IAAAmW,EACgC9c,EAAOxB,KAAnD0Q,EADY4N,EACZ5N,YAAaC,EADD2N,EACC3N,OAAQC,EADT0N,EACS1N,YAAa9J,EADtBwX,EACsBxX,MAC1C,MAAO,CACL2J,KAAI7O,OAAAuP,EAAA,EAAAvP,CAAA,GACCuG,EAAKsI,KACL,CACDC,cACAC,SACAC,cACA9J,UAGJqE,MAAM,QAjFK1Q,EAuFnB4wB,aAAe,WACb5wB,EAAKO,SAAS,CAAEsP,UAAW,IAAIsD,KAAe,WAC5CnT,EAAKywB,iBAzFUzwB,EA6FnB6wB,WAAa,SAAApyB,GACXkY,EAAa,OAAQlY,GACrBuB,EAAKO,SAAS,CACZ9B,KAAMA,EACNsX,aAAc,MACb/V,EAAKywB,cAlGSzwB,EAqGnB8wB,mBAAqB,WACnB9wB,EAAKO,SAAS,SAAAmN,GACZ,IAAMoI,EAAsC,UAAtBpI,EAAKoI,aAA4B,OAAS,QAEhE,OADAa,EAAa,eAAgBb,GACtB,CAAEA,aAAcA,MAzGR9V,EA6GnBiL,OAAS,SAAA4E,GACP7P,EAAKO,SAAS,CAAEsP,UAAWA,KA9GV7P,EAiHnB+wB,UAAY,SAAChiB,GACX/O,EAAKO,SAAS,SAAAmN,GACZ,IAAMoB,EAAM3H,OAAAuP,EAAA,EAAAvP,CAAA,GAAQuG,EAAK0I,aAAiB,CAAErH,QAASA,IAErD,OADA4H,EAAa,eAAgB7H,GACtB,CAAEsH,aAActH,IACtB,WACD9O,EAAKywB,iBAvHUzwB,EA2HnBgxB,kBAAoB,SAAArpB,GAClB3H,EAAKO,SAAS,SAAAmN,GACZ,IAAMoB,EAAM3H,OAAAuP,EAAA,EAAAvP,CAAA,GAAOuG,EAAK0I,aAAiB,CAAEzO,QAASA,IAEpD,OADAgP,EAAa,eAAgB7H,GACtB,CAAEsH,aAActH,MA/HR9O,EAmInBixB,aAAe,WACbjxB,EAAKO,SAAS,SAAAmN,GACZ,MAAO,CAAEsI,KAAK7O,OAAAuP,EAAA,EAAAvP,CAAA,GAAKuG,EAAKsI,KAAS,CAAEE,QAAQ,QArI5BlW,EAyInB2oB,aAAe,SAACzS,GACd4R,GAAWa,aAAazS,EAAQlW,EAAKJ,MAAMoW,MAAMlP,KAAK,SAAAkP,GACpDhW,EAAKO,SAAS,CAAEyV,KAAMA,OA3IPhW,EA+InB6oB,aAAe,WACbf,GAAWe,aAAa7oB,EAAKJ,MAAMoW,MAAMlP,KAAK,SAAAkP,GAC5ChW,EAAKO,SAAS,CAAEyV,KAAMA,OAjJPhW,EAqJnBmpB,cAAgB,WACdrB,GAAWqB,cAAc,CACvB1qB,KAAMuB,EAAKJ,MAAMnB,KACjBuX,KAAMhW,EAAKJ,MAAMoW,KACjBnG,UAAW7P,EAAKJ,MAAMiQ,UACtBwK,WAAYra,EAAKywB,eA1JFzwB,EA8JnBqpB,mBAAqB,WACnBrpB,EAAKO,SAAS,CAAEmQ,MAAM,IACtBoX,GAAWuB,mBAAmBrpB,EAAKJ,MAAMiQ,WACtC/I,KAAK9G,EAAKywB,cAjKIzwB,EAoKnB8oB,gBAAkB,WAChBhB,GAAWgB,gBAAgB,CACzBjZ,UAAW7P,EAAKJ,MAAMiQ,UACtBpR,KAAMuB,EAAKJ,MAAMnB,KACjB+gB,QAAS,kBAAMxf,EAAKO,SAAS,CAAEmQ,MAAM,KACrCqY,UAAW/oB,EAAKywB,YAChBzH,QAAWhpB,EAAKywB,eA1KDzwB,EA8KnB0tB,iBAAmB,SAAA/T,GACjB3Z,EAAKO,SAAS,SAAAmN,GACZ,MAAO,CACLjP,KAAM,SACNsX,aAAcrI,EAAKqI,aAAerI,EAAKqI,aAAerI,EAAKjP,KAC3DuX,KAAM,CACJC,YAAa,KACbC,OAAQ,KACRC,YAAawD,EAAS/R,MACtByE,MAAOsN,EAAStN,WAvLLrM,EA6LnB2tB,aAAe,WACb3tB,EAAK6wB,WAAW7wB,EAAKJ,MAAMmW,eA3L3B/V,EAAKJ,MAAQyW,IAEbrW,EAAKgsB,QAAU5rB,SAAS6rB,eAAe,OACvCxc,OAAOyhB,aAAelxB,EAAK4wB,aANV5wB,mFAUC,IAAA2G,EAAArG,KAClBA,KAAK0rB,QAAQ3rB,iBAAiB,UAAWC,KAAKT,WAAW,GACzDS,KAAK0rB,QAAQ3rB,iBAAiB,YAAaC,KAAKyjB,aAAa,GAG7Dnd,IAAMC,IAAI,mBAAmBC,KAAK,SAAAC,GAChCJ,EAAKpG,SAAS,CAAE0B,QAAS8E,EAAOxB,SAC/BuB,KAAK,WACNH,EAAK8pB,+DAMPnwB,KAAK0rB,QAAQtrB,oBAAoB,UAAWJ,KAAKT,WAAW,GAC5DS,KAAK0rB,QAAQtrB,oBAAoB,YAAaJ,KAAKyjB,aAAa,oCAwKzD,IAAA3W,EAAA9M,KACP,OACEgI,EAAA3J,EAAAC,cAACuyB,GAAD,CACElvB,QAAS3B,KAAKV,MAAMqC,QACpBxD,KAAM6B,KAAKV,MAAMnB,KACjBqX,aAAcxV,KAAKV,MAAMkW,aACzBuV,YAAa/qB,KAAKV,MAAMmW,aACxBC,KAAM1V,KAAKV,MAAMoW,KACjB0V,YAAaprB,KAAKV,MAAMwW,aACxBvG,UAAWvP,KAAKV,MAAMiQ,UACtBa,KAAMpQ,KAAKV,MAAM8Q,KACjBye,aAAc7uB,KAAKuwB,WACnB5C,qBAAsB3tB,KAAKwwB,mBAC3B3gB,SAAU7P,KAAK2K,OACfqlB,YAAahwB,KAAKywB,UAClBpiB,qBAAsBrO,KAAK0wB,kBAC3BnD,eAAgBvtB,KAAK2wB,aACrBb,eAAgB9vB,KAAKqoB,aACrB0H,eAAgB/vB,KAAKuoB,aACrBgG,eAAgB,kBAAM/G,GAAWC,eAAejhB,KAAKsG,EAAKqjB,cAC1DzgB,eAAgB,SAACkY,EAAQ1pB,GAAT,OAAmBspB,GAAWG,aAAaC,EAAQ1pB,GAAOsI,KAAKsG,EAAKqjB,cACpF/D,gBAAiBpsB,KAAK6oB,cACtBwD,qBAAsBrsB,KAAK+oB,mBAC3BuD,kBAAmBtsB,KAAKwoB,gBACxB+D,iBAAkB,kBAAM/E,GAAW2B,eAAerc,EAAKxN,MAAMiQ,YAC7Did,iBAAkB,kBAAMhF,GAAW6B,eAAevc,EAAKxN,MAAMiQ,UAAWzC,EAAKxN,MAAMqC,UACnF+qB,MAAO,kBAAMlF,GAAW+B,kBAAkBzc,EAAKxN,MAAMiQ,WAAW/I,KAAKsG,EAAKqjB,cAC1E/C,iBAAkBptB,KAAKotB,iBACvBC,aAAcrtB,KAAKqtB,aACnBnS,cAAe,SAAApM,GAAK,OAAI0Y,GAAW3O,YAAY/J,GAAOtI,KAAKsG,EAAKqjB,cAChE3B,eAAgB,SAAC9T,EAAYlZ,GAAb,OAAqBgmB,GAAWK,aAAanN,EAAYlZ,GAAKgF,KAAKsG,EAAKqjB,uBAjO/D7uB,aAuOjCub,iBAAO7U,EAAA3J,EAAAC,cAACwyB,GAAD,MAAShxB,SAAS6rB,eAAe,oFCjPlCoF,EAAQ,CACZC,WAAe,gBACfC,YAAe,eACfC,aAAe,iBACfC,WAAe,gBACfC,SAAe,gBAGIC,sCAEZ9qB,IAAM,SAAAqa,GAAO,OAAImQ,EAAMnQ,qCCXhC,IAAApjB,EAAAC,EAAA,GAAAC,EAAAD,EAAAE,EAAAH,GAsBe8vB,IApBI,SAAArvB,GAEjB,OACEP,EAAAW,EAAAC,cAAA,OACEC,UAAS,eAAAK,OAAiBX,EAAMM,WAChCoC,QAAS1C,EAAM0C,SACb1C,EAAM6rB,KACNpsB,EAAAW,EAAAC,cAAA,KAAGE,KAAMP,EAAM6rB,KAAMvrB,UAAU,cAC5BN,EAAM8rB,MAGTrsB,EAAAW,EAAAC,cAAA,QAAMC,UAAU,cACbN,EAAM8rB","file":"static/js/workspace.d3f22b6a.chunk.js","sourcesContent":["import React from 'react';\n\nconst VIEW_LABELS = {\n  MY_DOCUMENTS: 'My Documents',\n  SHARED_WITH_ME: 'Shared with me',\n  SEARCH: 'Search results'\n}\n\nconst Breadcrumbs = props => {\n  const title = props.view ? VIEW_LABELS[props.view] : props.label;\n\n  return (\n    <div className=\"breadcrumbs\">\n      <h2>\n        <a className=\"root\" href=\"#\">{title}</a>\n        {props.path && props.path.map(b => \n          <a className=\"folder\" href={`#${b.id}`} key={b.id}>{b.title}</a>\n        )}\n      </h2>\n      \n      { props.docCount !== null && props.docCount !== undefined &&\n        <span className=\"count\">{`(${props.docCount})`}</span> }\n\n      { props.children }\n    </div>\n  );\n\n}\n\nexport default Breadcrumbs;","import React, { Component } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport ContentEditable from 'react-sane-contenteditable';\n\nconst INITIAL_STATE = {\n  editing: false,\n  modifiedContent: null\n}\n\nexport default class Readme extends Component {\n\n  state = {};\n\n  onKeydown = (evt) => {\n    if (evt.which === 27) // Esc\n      this.onCancel(); \n    else if (evt.ctrlKey && evt.which === 13) // Ctrl+Enter \n      this.onSave();\n  }\n\n  onEdit() {\n    document.addEventListener('keydown', this.onKeydown, false);\n    this.setState({ editing: true });\n  }\n\n  onChange(_, value) {\n    this.setState({ modifiedContent: value });\n  }\n\n  onDelete() {\n    document.removeEventListener('keydown', this.onKeydown, false);\n    this.props.onDelete && this.props.onDelete();\n  }\n\n  onSave() {\n    document.removeEventListener('keydown', this.onKeydown, false);\n    this.props.onUpdate && this.props.onUpdate(this.state.modifiedContent);\n    this.setState(INITIAL_STATE);\n  }\n\n  onCancel() {\n    document.removeEventListener('keydown', this.onKeydown, false);\n    if (typeof this.props.content === 'boolean')\n      this.onDelete();\n    else\n      this.setState(INITIAL_STATE);\n  }\n\n  renderView(content) {\n    return (\n      <div className=\"readme\">\n        <div className=\"wrapper\">\n          <div className=\"textbox\">\n            <ReactMarkdown source={content} />       \n          </div>\n\n          {this.props.onUpdate && this.props.onDelete &&\n            <span className=\"buttons modify\">\n              <button\n                className=\"icon nostyle\"\n                title=\"Edit\"\n                onClick={this.onEdit.bind(this)}>&#xf040;</button>\n            </span>\n          }\n        </div>\n      </div>\n    )\n  }\n\n  renderEdit(content) {\n    return (\n      <div className=\"readme editing\">\n        <div className=\"wrapper\">\n          <ContentEditable \n            tagName=\"div\"\n            className=\"textbox\"\n            content={content} \n            editable={true} \n            multiLine={true}\n            onChange={this.onChange.bind(this)}/>            \n\n          <div className=\"editbar\">\n            <span className=\"hint\">Supports styling with <a href=\"# \">Markdown</a></span>\n            <span className=\"buttons\">\n              <button\n                className=\"label nostyle\"\n                onClick={this.onDelete.bind(this)}>Delete description</button>\n\n              <button \n                className=\"icon nostyle\"\n                onClick={this.onSave.bind(this)}>&#xf00c;</button>\n\n              <button \n                className=\"icon nostyle\"\n                onClick={this.onCancel.bind(this)}>&#xf00d;</button>\n            </span>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  render() {\n    const editOnOpen = typeof this.props.content === 'boolean';\n\n    if (editOnOpen)\n      document.addEventListener('keydown', this.onKeydown, false);\n\n    const content = editOnOpen ? '' : \n      (this.state.modifiedContent ? this.state.modifiedContent : this.props.content);\n\n    return (this.state.editing || editOnOpen) ? this.renderEdit(content) : this.renderView(content);\n  }\n\n}\n","import React, { Component } from 'react';\n\nimport Avatar from './Avatar.jsx';\n\nexport default class IdentityInfo extends Component {\n\n  formatURL(url) {\n    return url.replace(/^https?:\\/\\//i, '');\n  }\n\n  render() {\n    const dataAvailable = \n      this.props.account && \n      this.props.account.username &&\n      this.props.account.member_since;\n      \n    return (\n      <div className=\"identity\">\n        <div className=\"user\">\n          <Avatar username={dataAvailable && this.props.account.username} />\n\n          <h1>\n            { dataAvailable ?\n                ((this.props.account.real_name) ? \n                  this.props.account.real_name : this.props.account.username) :\n\n                (<span className=\"placeholder\" />) }\n          </h1>\n\n          <p className=\"member-since\">\n            { dataAvailable ?\n              <React.Fragment>\n                Joined on { new Intl.DateTimeFormat('en-GB', {\n                  year : 'numeric',\n                  month: 'short',\n                  day  : '2-digit'\n                }).format(new Date(this.props.account.member_since)) }\n              </React.Fragment> : <span className=\"placeholder\" />\n            }\n          </p>\n        </div>\n\n        <div className=\"user-extended\">\n          { dataAvailable && this.props.account.bio &&\n            <p className=\"bio\">{this.props.account.bio}</p> }\n\n          { dataAvailable && this.props.account.website && \n            <p className=\"homepage\">\n              <a href={this.props.account.website}>{this.formatURL(this.props.account.website)}</a>\n            </p>\n          }\n        </div>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport { Bar, BarChart, CartesianGrid, XAxis } from 'recharts';\nimport NumberFormat from 'react-number-format';\n\nconst LINE_STYLE = {\n  stroke: '#c2c2c2', \n  strokeWidth:1\n}\n\nconst AXIS_STYLE = {\n  fontSize:\"12px\",\n  color:\"#3f3f3f\"\n}\n\nconst WEEK = 3600000 * 24 * 7; // A week in milliseconds\n\nconst tickFormatter = (tick) => new Intl.DateTimeFormat('en-GB', {\n  month: 'short'\n}).format(new Date(tick));\n\nexport default class ActivityHistory extends Component {\n\n  /** Helper that generates an empty time series of N buckets with value 0 */\n  createEmptySeries(n, toTimestamp) {\n    const empty = new Array(n);\n    empty.fill(0); // Needs to contain *something* for .reduce to work\n\n    const timestamps = empty.reduce((arr, _) => {\n      const last = arr[arr.length - 1];\n      arr.push(last - WEEK);\n      return arr;\n    }, [ toTimestamp - WEEK ]).reverse();\n\n    return timestamps.map(timestamp => {\n      return { timestamp: timestamp, value: 0 };\n    });\n  }\n\n  padTimeseries(t) {\n    const toTime = t.length > 0 ? t[0].timestamp : new Date().getTime();\n    const padding = this.createEmptySeries(19 - t.length, toTime);\n    return padding.concat(t);\n  }\n\n  computeChart() {\n    // Data comes as ISO strings - convert\n    const timeseries = this.props.stats.over_time.map(t => {\n      return { timestamp: Date.parse(t.date), value: t.value };\n    });\n\n    if (timeseries.length < 20) {\n      return this.padTimeseries(timeseries);\n    } else {\n      return timeseries;\n    }\n  }\n\n  render() {\n    return (\n      <div className={this.props.className ? \n        `activity-widget ${this.props.className}` : \"activity-widget\"}>\n\n        <h2>Activity \n          {this.props.stats && \n            <span className=\"count\">\n              <NumberFormat \n                displayType=\"text\"\n                value={this.props.stats.total_contributions}\n                thousandSeparator={true} /> edits\n            </span>\n          }\n        </h2>\n\n        {this.props.stats &&\n          <BarChart \n            width={this.props.width} \n            height={this.props.height} \n            barCategoryGap={1.5}\n            data={this.computeChart()} >\n\n            <CartesianGrid \n              strokeDasharray=\"3\" \n              horizontal={false}/>\n\n            <XAxis \n              type=\"number\"\n              dataKey=\"timestamp\"\n\n              axisLine={LINE_STYLE} \n\n              tick={AXIS_STYLE}\n              tickSize={4}\n              tickCount={6}\n              tickLine={LINE_STYLE}\n              tickFormatter={tickFormatter}\n\n              height={20}\n              domain={['dataMin', 'dataMax']}\n              padding={{ left: 5, right: 5 }} />\n\n            <Bar \n              dataKey=\"value\" \n              fill={this.props.fill} />\n\n          </BarChart>\n        }\n      </div>\n    )\n  }\n\n}","import React, { Component } from 'react';\nimport axios from 'axios';\n\nimport Avatar from './Avatar.jsx';\n\nexport default class TopCollaborators extends Component {\n\n  state = {\n    collaborators: null\n  }\n\n  componentWillReceiveProps() {\n    this.fetchCollaborators();\n  }\n\n  fetchCollaborators() {\n    if (this.props.username && !this.state.collaborators)\n      axios\n        .get(`/api/account/${this.props.username}/collaborators`)\n        .then(result => this.setState({ collaborators: result.data }));\n  }\n\n  render() {\n    const { collaborators } = this.state;\n    return (\n      <React.Fragment>\n        {collaborators && collaborators.length > 0 &&\n          <div className={this.props.className ? `collaborator-list ${this.props.className}` : 'collaborator-list'}>\n            <h2>{this.props.title}</h2>\n            <ul>\n              {this.state.collaborators.map(user => \n                <li key={user.username}>\n                  <a href={`/${user.username}`} title={user.username}>\n                    <Avatar username={user.username} />\n                  </a>\n                </li>\n              )}\n            </ul>\n          </div>\n        }\n      </React.Fragment>\n    )\n  }\n\n}","import { Component } from 'react';\nimport { Columns } from '../Columns';\n\nexport default class BaseRowComponent extends Component {\n\n  constructor(props) {\n    super(props);\n    this.updateTotalRowSpan(props);\n  }\n\n  componentWillReceiveProps(next) {\n    this.updateTotalRowSpan(next);\n  }\n\n  /** Updates total unit width requirement for current row layout **/\n  updateTotalRowSpan(props) {\n    this._totalSpan = props.columns.reduce((total, field) => total + Columns.getSpan(field), 0);\n  }\n\n  getWidth(field) {\n    const span = Columns.getSpan(field);\n    return span / this._totalSpan;\n  }\n  \n}","import React from 'react';\nimport NumberFormat from 'react-number-format';\nimport TimeAgo from 'react-timeago';\nimport Icons from './TypeIcons';\nimport BaseRowComponent from './BaseRowComponent';\n\n/** Formatting rules for possible field types **/\nconst FORMATTERS = {\n  language: language => \n    language.toUpperCase(),\n\n  uploaded_at: datetime => \n    new Intl.DateTimeFormat('en-GB', {\n      year : 'numeric',\n      month: 'short',\n      day  : '2-digit'\n    }).format(new Date(datetime)),\n  \n  last_edit_at: datetime => \n    <TimeAgo date={datetime} />,\n\n  public_visibility: (visibility) => {\n    if (visibility === 'PUBLIC') \n      return ( <span className=\"icon\" title=\"Open to anyone\">&#xf09c;</span> );\n    else if (visibility === 'WITH_LINK')\n      return ( <span className=\"icon\" title=\"Open to anyone with the link\">&#xf0c1;</span> );\n    else \n      return ( <span className=\"icon\" title=\"Private\">&#xf023;</span> );\n  },\n\n  access_level: level => {\n    if (level === 'ADMIN')\n      return ( <span className=\"icon\" title=\"ADMIN\">&#xf0ad;</span> );\n    else if (level === 'WRITE')\n      return ( <span className=\"icon\" title=\"WRITE\">&#xf040;</span> );\n    else\n      return ( <span className=\"icon\" title=\"READ\">&#xf06e;</span> );\n  },\n\n  annotations: annotations =>\n    <NumberFormat \n      displayType=\"text\"\n      value={annotations}\n      thousandSeparator={true} />,\n\n  status_ratio: ratio => {\n    const total = ratio.verified + ratio.unverified + ratio.not_identifiable;\n    const pctGreen = ratio.verified / total * 100;\n    const pctYellow = ratio.not_identifiable / total * 100;\n\n    const labels = {\n      'verified': 'verified',\n      'unverified': 'unverified',\n      'not_identifiable': 'flagged'\n    }\n\n    const tooltip = ['verified', 'unverified', 'not_identifiable'].reduce((tooltip, next) => {\n      const count = ratio[next];\n      if (count === 0)\n        return tooltip;\n      else\n        return `${tooltip} ${count} ${labels[next]},`;\n    }, '').slice(0, -1);\n\n    return (\n      <span className=\"bar\" title={tooltip}>\n        <span className=\"verified\" style={{ width: `${pctGreen}%` }} />\n        <span className=\"not_identifiable\" style={{ width: `${pctYellow}%` }} />\n      </span>\n    )\n  },\n\n  cloned_from: clonedFrom =>\n    <span className=\"cloned-from\">\n      <span>{clonedFrom.username}</span> / <span>{clonedFrom.id}</span>\n    </span>,\n\n  has_clones: hasClones =>\n    <span className=\"has-clones\">{hasClones}</span>\n\n};\n\n/** Rules for aggregate fields **/\nconst AGGREGATE_FIELDS = {\n  agg_document: (item) => (item.author) ?\n                            `${item.author}, ${item.title}` : item.title\n};\n\nexport default class DocumentRow extends BaseRowComponent {\n\n  createAggregateField(url, field) {\n    return (\n      <a \n        key={field}\n        href={url} \n        className={field.substring(4)}\n        style={{ width: `${100 * super.getWidth(field)}%` }}>\n\n        {AGGREGATE_FIELDS[field](this.props.item)}\n      </a>\n    )\n  }\n\n  createField(url, field) {\n    const formatter = FORMATTERS[field];\n\n    const value = this.props.item[field] !== undefined ? \n      (formatter ? formatter(this.props.item[field]) : this.props.item[field]) :\n      ''; // empty value\n\n    return (\n      <a \n        key={field}\n        href={url}\n        className={field}\n        style={{ width: `${100 * super.getWidth(field)}%` }}>{value}</a>\n    )\n  }\n\n  render() {\n    const type = this.props.item.filetypes[0];\n    const url = `document/${this.props.item.id}/part/1/edit`;\n\n    return (\n      <div\n        className={`row${(this.props.selected) ? ' selected' : ''}`}\n        style={this.props.style}\n        onClick={this.props.onClick} >\n        \n        { this.props.columns.map(field => field.startsWith('agg_') ? \n          this.createAggregateField(url, field) : this.createField(url, field)) }\n\n        <span className={`type icon ${type}`}>\n          <img src={`/assets/images/${Icons.get(type)}`} alt={`icon type ${type}`} />\n        </span>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\n\nexport default class FolderRow extends Component {\n\n  state = { \n    title: this.props.item.title,\n    editable: false\n  }\n\n  componentWillReceiveProps(next) {\n    this.setState({ \n      title: next.item.title,\n      editable: false\n    });\n  }\n\n  makeEditable = (evt) => {\n    this.setState({ editable: true },\n      () => this._input.select());\n\n    evt.preventDefault();\n    evt.stopPropagation();\n  }\n\n  onChange = (evt) => {\n    this.setState({ title: evt.target.value });\n  }\n\n  onKeyPress = (evt) => {\n    if (evt.which === 13) {\n      this.setState({ editable: false}, \n        () => this.props.onRename(this.props.item, this.state.title));\n    }\n  }\n\n  render() {\n    return (\n      <a\n        href={`#${this.props.item.id}`} \n        style={this.props.style}\n        className={`row folder${(this.props.selected) ? ' selected' : ''}`}\n        onClick={this.props.onClick}>\n\n        <span className=\"folder-title\">\n          { this.state.editable ? \n            <input \n              ref={i => this._input = i}\n              value={this.state.title}\n              onClick={this.makeEditable}\n              onChange={this.onChange}\n              onKeyDown={this.onKeyPress} />\n          : <span\n              className=\"editable\" \n              onClick={this.makeEditable} >{this.state.title}</span> }\n        </span>\n\n        <span className=\"type icon\">&#xf07b;</span>\n      </a>\n    )\n  }\n\n}\n","import React from 'react';\nimport BaseRowComponent from './BaseRowComponent';\nimport { HEADER_NAMES } from '../Columns';\n\nexport default class HeaderRow extends BaseRowComponent {\n\n  render() {\n    return (\n      <div className=\"column-labels\">\n        {this.props.columns.map(field =>\n          <span\n            key={field}\n            style={{ width: `${100 * super.getWidth(field)}%` }}\n            className={`label ${field}`}\n            onClick={this.props.onSort.bind(this, field)}>\n            <span className=\"inner-wrapper\">\n              <span className=\"inner\">\n                {HEADER_NAMES[field] || field}\n              </span>\n              {this.props.sortColumn === field &&\n                <span className=\"sort icon\">\n                  <span className=\"inner\">\n                    {(this.props.sortAsc) ? '\\ue688' : '\\ue682' }\n                  </span>\n                </span>\n              }\n            </span>\n          </span>\n        )}\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport { SortableContainer, SortableElement } from 'react-sortable-hoc';\nimport { HEADER_NAMES } from '../Columns.js';\n\nconst SortableItem = SortableElement(({ label }) =>\n  <div className=\"card\">{label}</div>\n);\n\nconst SortableList = SortableContainer(({ items }) =>\n  <div className=\"column-order\">\n    {items.map((item, idx) => (\n      <SortableItem key={`card-${idx}`} index={idx} label={HEADER_NAMES[item]} />\n    ))}\n  </div>\n);\n\nexport default class ColumnOrder extends Component {\n\n  render() {\n    return (\n      <SortableList\n        items={this.props.items}\n        onSortEnd={e => this.props.onSortEnd(e.oldIndex, e.newIndex)} />\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport { arrayMove } from 'react-sortable-hoc';\nimport Modal from '../../../Modal';\nimport ColumnOrder from './ColumnOrder';\nimport { COLUMNS, HEADER_NAMES } from '../Columns';\n\nexport default class PreferencesModal extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      columns: props.columns.slice(0)\n    }\n  }\n\n  componentWillReceiveProps(next) {\n    if (next.columns !== this.props.columns)\n      this.setState({ columns: next.columns.slice(0) });\n  }\n\n  /** Computes a map (fieldname -> checked) from the current columns state **/\n  getCheckboxStates(props) {\n    const states = {};\n\n    COLUMNS.forEach(field => {\n      const isChecked = this.state.columns.includes(field);\n      states[field] = isChecked;\n    });\n\n    return states;\n  }\n\n  /** Sets visibility for all rows to the given boolean value **/\n  setAllRows(checked) {\n    const checkAll = () => {\n      const toAppend = \n        COLUMNS.filter(field => !this.state.columns.includes(field));\n\n      this.setState({ columns: this.state.columns.concat(toAppend) });\n    };\n\n    const uncheckAll = () => {\n      this.setState({ columns: [] });\n    };\n\n    if (checked) \n      checkAll();\n    else\n      uncheckAll();\n  }\n\n  /**\n   * Clicking 'ALL' either checks all boxes or - if all are currently\n   * checked, unchecks them.\n   */\n  onClickAll() {\n    const allRowsChecked = COLUMNS.length === this.state.columns.length;\n    if (allRowsChecked)\n      this.setAllRows(false);\n    else\n      this.setAllRows(true);\n  }\n\n  /** Toggles the checkbox with the given name **/\n  toggleOne(name) {\n    this.setState(prev => {\n      const idx = prev.columns.indexOf(name);\n      if (idx < 0)\n        prev.columns.push(name);\n      else\n        prev.columns.splice(idx, 1);        \n    \n      return prev;\n    });\n  }\n\n  onSort(oldIndex, newIndex) {\n    this.setState({\n      columns: arrayMove(this.state.columns, oldIndex, newIndex)\n    });\n  }\n\n  render() {\n    // Helper to create a single checkbox + label row\n    const createRow = field =>\n      <li key={field}>\n        <input\n          type=\"checkbox\"\n          id={field}\n          name={field}\n          checked={this.state.columns.includes(field)}\n          onChange={this.toggleOne.bind(this, field)} />\n        <label htmlFor={field}>{HEADER_NAMES[field]}</label>\n      </li>\n\n    return (\n      <Modal\n        className=\"preferences\"\n        title=\"Configure Columns\"\n        onClose={this.props.onCancel}>\n\n        <div className=\"scroll-pane\">\n          <div className=\"selected-columns\">\n            <button\n              className=\"all nostyle\"\n              onClick={this.onClickAll.bind(this)}>All</button>\n            <ul>\n              { COLUMNS.map(createRow) }\n            </ul>\n          </div>\n\n          <ColumnOrder\n            items={this.state.columns} \n            onSortEnd={this.onSort.bind(this)} />\n        </div>\n\n        <div className=\"buttons\">\n          <button\n            className=\"btn\"\n            onClick={this.props.onSave.bind(this, this.state.columns)}>Save</button>\n\n          <button \n            className=\"btn outline\"\n            onClick={this.props.onCancel}>Cancel</button>\n        </div>\n      </Modal>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport { AutoSizer, List } from 'react-virtualized';\nimport Dropzone from 'react-dropzone'\nimport DocumentRow from './rows/DocumentRow';\nimport FiledropHint from '../FiledropHint';\nimport FolderRow from './rows/FolderRow';\nimport HeaderRow from './rows/HeaderRow';\nimport PreferencesModal from  './preferences/PreferencesModal';\n\nexport default class TablePane extends Component {\n\n  state = {\n    drag: false,\n    tablePreferencesOpen: false,\n  }\n\n  rowRenderer() {\n    return ((args) => {\n      const item = this.props.items[args.index];\n      const selected = this.props.selection && \n        this.props.selection.includes(item);\n\n      return (item.type === 'FOLDER') ?\n        <FolderRow \n          key={args.key} \n          style={args.style} \n          item={item} \n          selected={selected}\n          onClick={e => this.onRowClick(e, item, args.index)} \n          onRename={this.props.onRenameFolder} /> :\n\n        <DocumentRow\n          key={args.key}\n          style={args.style}\n          columns={this.props.config.columns}\n          item={item}\n          selected={selected}\n          onClick={e => this.onRowClick(e, item, args.index)} />\n    });\n  }\n\n  onRowClick(evt, item, idx) {\n    const selection = this.props.selection && \n      this.props.selection.handleClick(evt, item, idx, this.props.items);    \n      \n    if (selection)\n      this.props.onSelect(selection);\n  }\n\n  showPreferences = visible => {\n    this.setState({ tablePreferencesOpen: visible });\n  }\n\n  onSavePreferences = columns => {\n    this.setState({ tablePreferencesOpen: false });\n    this.props.onChangeColumnConfig(columns);\n  }\n\n  sortBy = field => {\n    const asc = this.props.config.sorting.by === field ? \n      ! this.props.config.sorting.asc : true;\n    this.props.onSort({ by: field, asc: asc });\n  }\n\n  onDrag = active => {\n    this.setState({ drag: active });\n  }\n\n  onDrop = (files, _, evt) => {\n    const url = evt.dataTransfer.getData('URL');\n\n    const hostname = url ? (() => {\n      const a = document.createElement('a');\n      a.href = url;\n      return a.hostname;\n    })() : null;\n\n    this.setState({ drag: false });\n\n    if (files.length > 0)\n      this.props.onDropFiles(files);\n    else if (url && hostname !== window.location.hostname) // Require external link\n      this.props.onDropSourceURL(url);\n  }\n\n  render() {\n    const tablePane =\n      <div className=\"documents-pane table-pane\">\n        <AutoSizer>\n          {({ height, width }) => (\n            <List\n              className=\"virtualized-list\"\n              width={width}\n              height={height}\n              rowCount={this.props.items.length}\n              rowHeight={47}\n              rowRenderer={this.rowRenderer()} />\n          )}\n        </AutoSizer>\n\n        { this.state.drag && \n          <FiledropHint /> }\n        \n        { this.props.busy &&\n           <div className=\"busy-mask\" /> }\n      </div>\n\n    return (\n      <React.Fragment>\n        <div className=\"documents-table-header\">\n          <HeaderRow \n            columns={this.props.config.columns} \n            sortColumn={this.props.config.sorting.by} \n            sortAsc={this.props.config.sorting.asc} \n            onSort={this.sortBy} />\n\n          <button\n            className=\"column-options-btn nostyle icon\"\n            onClick={() => this.showPreferences(true)} >&#xf141;</button>\n        </div>\n\n        { this.props.enableFiledrop ?\n          <Dropzone\n            className=\"dropzone\"\n            disableClick={true}\n            onDragEnter={() => this.onDrag(true)}\n            onDragLeave={() => this.onDrag(false)}\n            onDrop={this.onDrop}>\n            { tablePane }\n          </Dropzone> : tablePane\n        }\n\n        { this.state.tablePreferencesOpen &&\n          <PreferencesModal\n            columns={this.props.config.columns}\n            onCancel={() => this.showPreferences(false)} \n            onSave={this.onSavePreferences} />\n        }\n      </React.Fragment>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\n\nexport default class Document extends Component {\n\n  render() {\n    const type = this.props.filetypes[0]; // TODO make more clever in the future\n    const isStacked = this.props.fileCount > 1;\n\n    return (\n      <a href={`document/${this.props.id}/part/1/edit`}\n        className={`cell${(this.props.selected) ? ' selected' : ''}`}\n        onClick={this.props.onClick} >\n        \n        <div className=\"inner\">\n          <div className={`item-wrapper${isStacked ? ' stacked' : ''}`}>\n            { isStacked && <div className=\"stack\" /> }\n            <div className={`document ${type}`}>\n              <div className=\"label\">\n                {this.props.title}\n              </div>\n            </div>\n          </div>\n        </div>\n      </a>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\n\nexport default class Folder extends Component {\n\n  render() {\n    return (\n      <a href={`#${this.props.id}`} \n        className={`cell${(this.props.selected) ? ' selected' : ''}`}\n        onClick={this.props.onClick}>\n\n        <div className=\"inner\">\n          <div className=\"item-wrapper\">\n            <div className=\"folder\">\n              <div className=\"label\">\n                {this.props.title}\n              </div>\n            </div>\n          </div>\n        </div>\n      </a>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport Dropzone from 'react-dropzone'\nimport { AutoSizer, List } from 'react-virtualized';\nimport Document from './Document';\nimport Folder from './Folder';\nimport FiledropHint from '../FiledropHint';\n\nconst TILE_SIZE = 192;\n\n/**\n * Using the following example:\n *\n * https://stackoverflow.com/questions/46368305/how-to-make-a-list-grid-with-a-responsive-number-of-columns-using-react-virtuali\n * http://plnkr.co/edit/zjCwNeRZ7XtmFp1PDBsc?p=preview\n */\nexport default class GridPane extends Component {\n\n  state = {\n    drag: false\n  }\n\n  onTileClick(evt, item, idx) {\n    const selection = \n      this.props.selection && this.props.selection.handleClick(evt, item, idx, this.props.items);    \n\n    if (selection)\n      this.props.onSelect(selection);\n  }\n\n  rowRenderer(itemsPerRow) {\n    return (args => {\n      const fromIndex = args.index * itemsPerRow;\n      const toIndex = Math.min(fromIndex + itemsPerRow, this.props.items.length);\n      const itemsInRow = toIndex - fromIndex;\n\n      const renderedItems = new Array(itemsInRow).fill(undefined).map((_, rowIdx) => {\n        const idx = rowIdx + fromIndex;\n        const item = this.props.items[idx];\n        const selected = this.props.selection && this.props.selection.includes(item);\n\n        return (item.type === 'FOLDER') ?\n            <Folder\n              key={idx} \n              id={item.id}\n              title={item.title} \n              selected={selected}\n              onClick={e => this.onTileClick(e, item, idx)} /> :\n            \n            <Document\n              key={idx}\n              id={item.id}\n              title={item.title}\n              filetypes={item.filetypes}\n              fileCount={item.file_count}\n              selected={selected}\n              onClick={e => this.onTileClick(e, item, idx)} />\n      });\n\n      if (itemsInRow < itemsPerRow) { // Add dummies to preserve grid layout\n        renderedItems.push(new Array(itemsPerRow - itemsInRow).fill(undefined).map((_, idx) =>\n          <div className=\"cell dummy\" key={`dummy-${idx}`} />\n        ))\n      }\n\n      return (\n        <div\n          key={args.key}\n          style={args.style}\n          className=\"row\">\n          {renderedItems}\n        </div>\n      )\n    });\n  }\n\n  onDrag = (active) => {\n    this.setState({ drag: active });\n  }\n\n  onDrop = (files, _, evt) => {\n    const url = evt.dataTransfer.getData('URL');\n\n    this.setState({ drag: false });\n\n    if (files.length > 0) this.props.onDropFiles(files);\n    else if (url) this.props.onDropSourceURL(url);\n  }\n\n  render() {\n    const gridPane =\n      <AutoSizer>\n        {({ height, width }) => {\n          const itemsPerRow = Math.floor(width / TILE_SIZE);\n          const rowCount = Math.ceil(this.props.items.length / itemsPerRow);\n\n          return (\n            <List\n              className=\"virtualized-grid\"\n              width={width}\n              height={height}\n              rowCount={rowCount}\n              rowHeight={TILE_SIZE}\n              rowRenderer={this.rowRenderer(itemsPerRow)} />\n          )\n        }}\n      </AutoSizer>\n\n    return (\n      <React.Fragment>\n        <div className=\"documents-pane grid-pane\">\n          {this.props.disableFiledrop ? gridPane :\n            <Dropzone\n              className=\"dropzone\"\n              disableClick={true}\n              onDragEnter={() => this.onDrag(true)}\n              onDragLeave={() => this.onDrag(false)}\n              onDrop={this.onDrop}>\n\n              {gridPane}\n\n            </Dropzone>\n          }\n\n          { this.state.drag && <FiledropHint /> }\n        </div>\n      </React.Fragment>\n    )\n  }\n\n}\n","// Columns available in all views\nconst COLUMNS_GENERAL = [\n  // Aggregate fields\n  // 'agg_document',\n\n  // Common fields\n  'author',\n  'title',\n  'language',\n  'date_freeform',\n  'uploaded_at',\n  'last_edit_at',\n  'last_edit_by',\n  'annotations',\n  'public_visibility',\n  'status_ratio',\n  'cloned_from',\n  'has_clones'\n];\n\n// Columns specific to SHARED_WITH_ME view\nconst COLUMNS_SHARED_WITH_ME = [\n  'owner',\n  'shared_by',\n  'access_level',\n  'filename',\n  'start_date',\n  'end_date',\n  'latitude',\n  'longitude'\n];\n\nexport const COLUMNS = COLUMNS_GENERAL.concat(COLUMNS_SHARED_WITH_ME);\n\n// Labels to use for fields\nexport const HEADER_NAMES = {\n  // agg_document    : 'Document',\n\n  author            : 'Author',\n  title             : 'Title',\n  language          : 'Language',\n  date_freeform     : 'Date',\n  uploaded_at       : 'Uploaded at',\n  last_edit_at      : 'Last edit',\n  last_edit_by      : 'Last edit by',\n  annotations       : 'Annotations',\n  public_visibility : 'Visibility',\n  status_ratio      : 'Verification ratio',\n  cloned_from       : 'Cloned from',\n  has_clones        : 'Has clones',\n\n  owner             : 'Document owner',\n  shared_by         : 'Shared by',\n  access_level      : 'Access',\n  filename      : 'Filename',\n  start_date      : 'Start date',\n  end_date      : 'End date',\n  latitude      : 'Latitude',\n  longitude      : 'Longitude'\n};\n\n// Relative width requirements per column (XL, L, M, S)\nexport const COLUMN_WIDTH = {\n  agg_document    : 'XL',\n\n  author            : 'M',\n  title             : 'L',\n  language          : 'M',\n  date_freeform     : 'M',\n  uploaded_at       : 'M',\n  last_edit_at      : 'M',\n  last_edit_by      : 'M',\n  annotations       : 'M',\n  public_visibility : 'M',\n  status_ratio      : 'M',\n  cloned_from       : 'M',\n  has_clones        : 'S',\n\n  owner             : 'M',\n  shared_by         : 'M',\n  access_level      : 'M',\n  filename      : 'M',\n  start_date      : 'M',\n  end_date      : 'M',\n  latitude      : 'M',\n  longitude      : 'M'\n};\n\nexport const AGGREGATE_COLUMNS = {\n  agg_document: [ 'author', 'document' ]\n};\n\n// Static helper methods \nexport class Columns {\n\n  static getSpan(field) {\n    const w = COLUMN_WIDTH[field];\n    if (w === 'XL') \n      return 6;\n    else if (w === 'L')\n      return 4;\n    else if (w === 'M')\n      return 2;\n    else if (w === 'S')\n      return 1;\n  }\n\n  /** Expands agg_ columns to those that are required to build them **/\n  static expandAggregatedColumns(columns) {\n    return columns.reduce((result, field) => {\n      if (field.startsWith('agg_'))\n        result = result.concat(AGGREGATE_COLUMNS[field]);\n      else\n        // Just append\n        result.push(field);\n\n      return result;\n    }, []);\n  }\n\n  /** Removes the columns that are not applicable in the given view **/\n  static filterByView(columns, view) { \n    if (view === 'MY_DOCUMENTS')\n      // Remove columns specific to 'Shared With Me'\n      return columns.filter(c => !COLUMNS_SHARED_WITH_ME.includes(c));\n    else\n      // All\n      return columns; \n  }\n\n}","import React, { Component } from 'react';\nimport Draggable from 'react-draggable';\n\nexport default class Modal extends Component {\n\n  render() {\n    return (\n      <div className={`clicktrap ${this.props.className}`}>\n        <div className=\"modal-wrapper\">\n          <Draggable handle=\".modal-header\">\n            <div className=\"modal\">\n              <div className=\"modal-header\">\n                <h1 className=\"title\">{this.props.title}</h1>\n                <button\n                  className=\"close nostyle\"\n                  onClick={this.props.onClose}>&#xe897;</button>\n              </div>\n\n              <div className=\"modal-body\">\n                {this.props.children}\n              </div>\n            </div>\n          </Draggable>\n        </div>\n      </div>\n    )\n  }\n\n}\n","export default class Selection {\n    \n  constructor(selectedItems) {\n    if (selectedItems)\n      this._selection = selectedItems;\n    else \n      this._selection = [];\n  }\n\n  isEmpty() {\n    return this._selection.length === 0;\n  }\n\n  includes(item) {\n    return this._selection.includes(item);\n  }\n\n  isSingleSelection() {\n    return this._selection.length === 1;\n  }\n\n  isSingleFolder() {\n    return this._selection.length === 1 && this._selection[0].type === 'FOLDER';\n  }\n\n  isSingleDocument() {\n    return this._selection.length === 1 && this._selection[0].type === 'DOCUMENT';\n  }\n\n  includesText() {\n    const withText = this._selection.filter(item => {\n      return item.filetypes && item.filetypes.find(ft => ft.startsWith(\"TEXT\"));\n    });\n    return withText.length > 0;\n  }\n\n  get(idx) {\n    return this._selection[idx];\n  }\n\n  getItems() {\n    return this._selection;\n  }\n\n  getFolders() {\n    return this._selection.filter(i => i.type === 'FOLDER');\n  }\n\n  getDocuments() {\n    return this._selection.filter(i => i.type === 'DOCUMENT');\n  }\n\n  /** Immutable - returns a new selection object **/\n  selectItem = (item, isCtrlPressed) => {\n    if (isCtrlPressed) {\n      const thisIdx = this._selection.indexOf(item);\n      const isSelected = thisIdx > -1;\n    \n      let cloned = this._selection.slice(0);\n\n      // Toggle this item, leave the rest of the selection unchanged\n      if (isSelected) {\n        cloned.splice(thisIdx, 1);\n      } else {\n        cloned.push(item);\n      }      \n\n      return new Selection(cloned);\n    } else {\n      // Select just this item\n      return new Selection([ item ]);\n    }\n  }\n\n  /**\n   * Range selection: SHIFT + click. \n   * \n   * Behavior follows Mac conventions, cf. \n   * https://stackoverflow.com/questions/2959887/algorithm-for-shift-clicking-items-in-a-collection-to-select-them\n   * \n   * Immutable - returns a new selection object\n   */\n  selectRange = (allItems, toIdx) => {\n    const selectedIndices = this._selection.map(item => {\n      return allItems.indexOf(item);\n    });   \n    \n    const minIdx = Math.min.apply(null, selectedIndices);\n    const maxIdx = Math.max.apply(null, selectedIndices);\n\n    const isOutside = (toIdx > maxIdx) || (toIdx < minIdx);\n\n    const slice = (from, to) => allItems.slice(from, to + 1);\n\n    if (isOutside && toIdx > maxIdx)\n      // Expand selection downwards\n      return new Selection(slice(minIdx, toIdx));\n    else if (isOutside)\n      // Expand selection upwards\n      return new Selection(slice(toIdx, maxIdx));\n    else\n      // Fill from topmost\n      return new Selection(slice(minIdx, toIdx));\n  }\n\n  /** \n   * Helper function that handles click/SHIFT+click/CTRL+click selection \n   * on an item and returns a new selection, if valid.\n   */\n  handleClick(evt, item, idx, allItems) {\n    const isShift = evt.getModifierState(\"Shift\");\n    const isCtrl = evt.getModifierState(\"Control\");\n    \n    // Is this a selection or deselection?\n    const isSelectAction = \n      (isShift || isCtrl || ! this.includes(item));\n\n    if (isSelectAction) {\n      const newSelection = isShift ?\n        this.selectRange(allItems, idx) :\n        this.selectItem(item, isCtrl);\n\n      evt.preventDefault();\n      return newSelection;\n    }\n  }\n  \n}","import React, { Component } from 'react';\n\nexport default class Avatar extends Component {\n\n  // https://medium.com/@pppped/compute-an-arbitrary-color-for-user-avatar-starting-from-his-username-with-javascript-cd0675943b66\n  stringToHslColor(str) {\n    let hash = 0;\n    for (let i=0; i<str.length; i++) {\n      hash = str.charCodeAt(i) + ((hash << 5) - hash);\n    }\n    return hash % 360;\n  }\n\n  render() {\n    const color = this.props.username ? `hsl(${this.stringToHslColor(this.props.username)}, 35%, 65%)` : '#e2e2e2';\n\n    return (\n      <div className=\"avatar\" style={{ backgroundColor: color }}>\n        <div className=\"inner\">\n          { this.props.username && this.props.username.charAt(0).toUpperCase() }\n        </div>\n      </div>\n    )\n  }\n\n}","import React, { Component } from 'react';\nimport posed from 'react-pose';\n\nconst AnimatedDiv = posed.div({\n  open:   { \n    bottom: '30px',\n    transition: {\n      ease: 'easeOut',\n      duration:200\n    }\n  },\n  closed: { bottom: '-140px' }\n});\n\nexport default class FiledropHint extends Component {\n\n  state = { \n    visible: false \n  };\n\n  componentDidMount() {\n    this.setState({ visible: true });\n  }\n\n  render() {\n    return (\n      <div className=\"filedrop-hint\">\n        <AnimatedDiv className=\"inner\" pose={this.state.visible ? 'open' : 'closed'}>\n          <span className=\"icon\">&#xf0ee;</span>\n          <p className=\"instructions\">\n            Drop files or IIIF manifest URLs to add them to your workspace.\n          </p>\n          <p className=\"supported\">\n            Supported formats: plain text (UTF-8), TEI/XML, image files, CSV (UTF-8)\n          </p>\n        </AnimatedDiv>\n      </div>\n    )\n  }\n\n}\n","import Selection from '../common/documents/Selection';\n\nconst DEFAULT_STATE = {\n  account: null,         // Null if not loaded\n  \n  view: 'MY_DOCUMENTS',  // MY_DOCUMENTS, SHARED_WITH_ME, SEARCH\n  presentation: 'TABLE', // 'TABLE' or 'GRID'\n\n  search_scope: null,    // If view is SEARCH\n  \n  page: {\n    breadcrumbs: null,\n    readme: null,\n    total_count: 0,\n    items: []             // Folders and documents\n  },\n\n  selection: new Selection(),        \n  \n  table_config: {\n    columns: [\n      \"author\",\n      \"filename\",\n      \"language\",\n      \"title\",\n      \"uploaded_at\",\n      \"last_edit_at\"\n    ],\n    sorting: { by: null, asc: true } \n  },\n\n  busy: true             // If loading is in progress\n};\n\nexport const initialState = () => {\n\n  const stored = {};\n\n  // Helper\n  const addIfDefined = (key) => {\n    const value = localStorage.getItem(`recogito.workspace.${key}`);\n    if (value) stored[key] = JSON.parse(value);\n  }\n\n  ['view', 'presentation', 'table_config'].map(addIfDefined)\n\n  return { ...DEFAULT_STATE, ...stored };\n}\n\nexport const persistState = (key, value) => {\n  const prefixed = `recogito.workspace.${key}`\n  localStorage.setItem(prefixed, JSON.stringify(value));\n}\n\n","import React, { Component } from 'react';\n\nexport default class ModalForm extends Component {\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.handleKeydown, false);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeydown, false);\n  }\n\n  handleKeydown = (evt) => {\n    if (evt.which === 27) this.props.onCancel(); // Escape\n  }\n\n  render() {\n    return (\n      <div className={`clicktrap ${this.props.className}`}>\n        <div className={`modal-wrapper modal-form-wrapper ${this.props.className}`}>\n          <div className=\"modal\">\n            <div className=\"modal-inner\">\n              <div>\n                {this.props.children}\n              </div>\n\n              <div className=\"footer\">\n                <button \n                  className=\"btn outline tiny\"\n                  onClick={this.props.onCancel}>Cancel</button>\n\n                <button\n                  className=\"btn tiny\"\n                  onClick={this.props.onOk}>Ok</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n}","import React, { Component } from 'react';\nimport { render } from 'react-dom';\nimport axios from 'axios';\n\nimport ModalForm from '../ModalForm';\n\nclass CreateFolderForm extends Component {\n\n  state = {\n    folderName : ''\n  }\n\n  onChange = evt => {\n    this.setState({ folderName: evt.target.value });\n  }\n\n  onKeyPress = evt => {\n    if (evt.which === 13) // Enter\n      this.onOk();\n  }\n\n  onOk = () => {\n    this.props.onOk(this.state.folderName);\n  }\n\n  render() {\n    return (\n      <ModalForm\n        onOk={this.onOk}\n        onCancel={this.props.onCancel}>\n  \n        <input \n          type=\"text\" \n          autoFocus={true}\n          placeholder=\"Folder name\" \n          value={this.state.folderName}\n          onChange={this.onChange} \n          onKeyPress={this.onKeyPress}/>\n      </ModalForm>\n    )\n  }\n\n} \n\nexport const createFolder = () => {\n  return new Promise(resolve => {\n    const container = document.createElement('div');\n    document.body.appendChild(container);\n\n    const onOk = folderName => { \n      const currentFolderId = document.location.hash.substring(1);\n\n      axios.post('/api/folder', {\n        title: folderName || 'Unnamed Folder',\n        parent: currentFolderId\n      }).then(() => {\n        container.remove();\n        resolve();\n      });\n    }\n\n    const onCancel = () => {\n      container.remove();\n      resolve();\n    }\n\n    render(\n      <CreateFolderForm \n        onOk={onOk}\n        onCancel={onCancel} />, container);\n  });\n};\n\nexport const renameFolder = (folder, title) => {\n  return axios.put(`/api/folder/${folder.id}`, {\n    action: 'RENAME',\n    title: title\n  });\n}","import React, { Component } from 'react';\n\nexport default class Meter extends Component {\n\n  render() {\n    return (\n      <div\n        className=\"meter\"\n        style={{ position: 'relative' }}>\n\n        <div\n          className=\"bar\"\n          style={{\n            width: `${100 * this.props.value}%`,\n            height: '100%'\n          }} />\n      </div>\n    )\n  }\n\n}\n","import React from 'react';\nimport Meter from '../../../common/Meter.jsx';\n\nconst FileProgress = props => {\n\n  return (\n    <li>\n      {props.upload.file.name}\n      <span className={`icon spinner ${props.upload.status}`}></span>\n    </li>\n  );\n\n}\n\nconst ImportProgressModal = props => {\n  const totalLoaded = props.uploads.reduce((total, u) => total + u.progress, 0);\n    \n  const errors = props.uploads.reduce((errors, u) => { \n    if (u.error) errors.push(u.error);\n    return errors;\n  }, []);\n\n  return (\n    <div className=\"upload-progress\">\n      <div className=\"phase\">\n        { props.phase }\n\n        <button \n          className=\"close nostyle\"\n          onClick={props.onClose}>&#xe897;</button>\n      </div>\n\n      <ul className={`files${(errors.length > 0) ? ' has-errors' : ''}`}>\n        { props.uploads.map(u => <FileProgress key={u.file.name} upload={u} />) }\n\n        { props.uploads.length === 0 &&\n          <li>\n            Fetching content from remote source...\n            <span className=\"icon spinner RUNNING\"></span>\n          </li>\n        }\n      </ul>\n\n      { errors.length > 0 && \n        <ul className=\"errors\">\n          <li>{errors.join()}</li>\n        </ul> \n      }\n\n      <div className=\"progress\">\n        <Meter value={totalLoaded / props.totalSize} />\n      </div>\n    </div>\n  )\n\n}\n\nexport default ImportProgressModal;","import React, { Component } from 'react';\nimport axios from 'axios';\nimport ImportProgressModal from './ImportProgressModal';\n\n/** \n * A stateful container component to manage the\n * upload process.\n */\nexport default class Uploader extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = this.initialState(props);\n    this.start();\n  }\n\n  initialState(props) {\n    return {\n      phase: 'Uploading',\n      totalSize: props.files.reduce((total, f) => f.size + total, 0),\n      uploadId: null,\n      uploads: props.files.map(f => {\n        return {\n          file: f,\n          filepartId: null,\n          status: 'UPLOADING', \n          progress: 0,\n          error: null\n        };\n      }),\n      error: null\n    };\n  }\n\n  componentWillReceiveProps(props) {\n    this.setState(this.initialState(props));\n  }\n\n  /** Helper to update a specific upload in the state array **/\n  updateUploadState = (upload, diff) => {\n    this.setState(prev => { \n      return { \n        uploads: prev.uploads.map(u => u.file === upload.file ? { ...u, ...diff } : u) \n      }\n    });\n  }\n\n  /**\n   * Initializes a new document, using the filename as title,\n   * or a 'New document' placeholder in case there are multiple files.\n   */\n  initNewDocument = () => {\n    const title = (this.state.uploads.length === 1) ? this.state.uploads[0].file.name : 'New document';\n    const formdata = new FormData();\n    formdata.append('title', title);\n\n    return axios.post('/my/upload', formdata, {\n      headers: { 'X-Requested-With': 'XMLHttpRequest' }\n    });\n  }\n\n  /** Uploads files in parallel **/\n  uploadFiles = () => {\n    // Helper: handles upload for one file\n    const uploadOne = upload => {\n      const formdata = new FormData();\n      formdata.append('file', upload.file);\n\n      const onUploadProgress = (evt) => {\n        this.updateUploadState(upload, { progress: evt.loaded });\n      }\n\n      return axios.post(`/my/upload/${this.state.uploadId}/file`, formdata, {\n        headers: { 'X-Requested-With': 'XMLHttpRequest' },\n        onUploadProgress: onUploadProgress\n      }).then(result => {\n        this.updateUploadState(upload, { \n          filepartId: result.data.uuid\n        });\n        return result;\n      }).catch(error => {\n        this.updateUploadState(upload, {\n          status: 'FAILED',\n          error: error.response.data\n        });\n        throw error;\n      });\n    }\n\n    // The list of request promises...\n    const requests = this.state.uploads.map(uploadOne);\n\n    // ... rolled into a promise of the list of request results\n    return Promise.all(requests);\n  }\n\n  importRemoteSource() {\n    this.setState({ phase: 'Importing' });\n\n    const formdata = new FormData();\n    formdata.append('url', this.props.remoteSource.url);\n    formdata.append('type', this.props.remoteSource.sourceType);\n\n    return axios.post(`/my/upload/${this.state.uploadId}/file`, formdata, {\n      headers: { 'X-Requested-With': 'XMLHttpRequest' }\n    });\n  }\n\n  finalizeDocument = withError => {\n    const currentFolder = document.location.hash.substring(1);\n\n    const url = currentFolder ?\n      `/my/upload/${this.state.uploadId}/finalize?folder=${currentFolder}` :\n      `/my/upload/${this.state.uploadId}/finalize`;\n\n    return axios.post(url, {\n      headers: { 'X-Requested-With': 'XMLHttpRequest' }\n    }).then(result => {\n      const tasks = result.data.running_tasks;\n\n      if (tasks && tasks.length > 0) {\n        this.setState({ phase: 'Importing...' });\n        this.pollTaskProgress(result.data.document_id, tasks);\n      } else {\n        this.setState({ phase: 'Completed' });\n        this.state.uploads.forEach(u => {\n          if (u.status !== 'FAILED') this.updateUploadState(u, { status: 'COMPLETED' });\n        });\n        if (!withError)\n          this.props.onComplete();\n      }\n    });\n  }\n\n  pollTaskProgress = (documentId, taskTypes) => {    \n    axios.get(`/api/job?id=${documentId}`)\n      .then(result => {\n        this.state.uploads.forEach(u => {\n          const progress = result.data.subtasks.find(t => t.filepart_id === u.filepartId);\n          if (progress)\n            this.updateUploadState(u, { status: progress.status });\n          else // No progress status - complete\n            this.updateUploadState(u, { status: 'COMPLETED' });\n        });\n\n        const isComplete = this.state.uploads.reduce((isComplete, u) => {\n          return isComplete && u.status === 'COMPLETED';\n        }, true);\n\n        if (isComplete) {\n          this.setState({ phase: 'Completed' });\n          this.props.onComplete();\n        } else {\n          setTimeout(() => this.pollTaskProgress(documentId, taskTypes), 1000);\n        }\n      }).catch(error => {\n        if (error.response.status === 404)\n          // Tasks might still be initializing\n          setTimeout(() => this.pollTaskProgress(documentId, taskTypes), 1000);\n      });\n  }\n\n  /** \n   * Starts a new upload.\n   * \n   * Since one document generally consists of multiple files, the \n   * upload process is three-stage: \n   * \n   * 1. the new document is initialized, and assigned an ID on the server\n   * 2. all files are uploaded to this document\n   * 3. a finalization requests closes the document, and waits for any\n   *   processing (image tiling, TEI conversion) to finish\n   */\n  start() {\n    this.initNewDocument().then((result) => {\n      this.setState({ uploadId: result.data.id });\n      // Branch based on files vs. remote URL\n      return this.props.remoteSource ?\n        this.importRemoteSource() : this.uploadFiles();\n    })\n    .then(() => this.finalizeDocument(false))\n    .catch(error => {\n      this.setState({ error: error });\n      this.finalizeDocument(true);\n      throw error;\n    });\n  }\n\n  render() {\n    return (\n      <ImportProgressModal\n        phase={this.state.phase}\n        totalSize={this.state.totalSize}\n        uploads={this.state.uploads}\n        error={this.state.error}\n        onClose={this.props.onClose} />\n    )\n  }\n\n}","import React, { Component } from 'react';\nimport ShineBrowser from \"react-shine-api\";\n\nclass SHINEModal extends Component {\n\n  SHINEFileUpload = files => {\n    let convertedFiles = [];\n\n    // convert strings to file\n    files.forEach(file => {\n      var newFile = new File([file.content], `${file.name || 'rise_file'}.txt`, {\n        type: \"text/plain\",\n      });\n      convertedFiles.push(newFile);\n    });\n\n    this.props.onUploadFiles(convertedFiles);\n  }\n\n  handleSHINEModalClick = (e) => {\n    if(e.target.id !== 'shinemodal') return;\n    this.props.onClose();\n  }\n\n  render() {\n    return(\n      <div \n        style={styles.shineModal} \n        id=\"shinemodal\" \n        onClick={this.handleSHINEModalClick}>\n\n        <div style={styles.shineBrowserContainer}>\n          <ShineBrowser\n            styles={{\n              primary: \"#4483C4\",\n              borderRadius: 2,\n              fontFamily: 'Assistant',\n              text: '#3f3f3f'\n            }}\n            close={this.props.onClose}\n            handleFileUpload={this.SHINEFileUpload}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n\nconst styles = {\n  shineModal: {\n    position: 'fixed',\n    backgroundColor: 'rgba(0,0,0,.5)',\n    zIndex: 100,\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  shineBrowserContainer: {\n    maxHeight: 800,\n    maxWidth: 1200,\n    margin: 20,\n    width: '100%',\n    height: '100%',\n    boxShadow: '0 .5rem 1rem rgba(0,0,0,.35)'\n  }\n}\n\nexport default SHINEModal;","import React, { Component } from 'react';\nimport { render } from 'react-dom';\nimport Importer from './Importer';\nimport ModalForm from '../ModalForm';\nimport { importFromShine } from './shine';\n\n/**\n * Basically a simple popup box with a text input field,\n * but with the added functionality that it's possible to\n * drag-and-drop a URL into the input field.\n */\nclass URLInputForm extends Component {\n\n  state = {\n    url : ''\n  }\n\n  onChange = evt => {\n    this.setState({ url: evt.target.value });\n  }\n\n  onDrop = evt => {\n    const url = evt.dataTransfer.getData('text');\n    this.setState({ url: url });\n  }\n\n  onKeyPress = evt => {\n    if (evt.which === 13) // Enter\n      this.onOk();\n  }\n\n  onOk = () => {\n    this.props.onOk(this.state.url);\n  }\n\n  render() {\n    return (\n      <ModalForm\n        onOk={this.onOk}\n        onCancel={this.props.onCancel}>\n  \n        <input \n          type=\"text\" \n          autoFocus={true}\n          placeholder=\"Paste or drag URL\" \n          value={this.state.url}\n          onChange={this.onChange} \n          onDrop={this.onDrop}\n          onKeyPress={this.onKeyPress}/>\n      </ModalForm>\n    )\n  }\n\n} \n\nconst promptForUrl = () => {\n\n  return new Promise(resolve => {\n    const container = document.createElement('div');\n    document.body.appendChild(container);\n\n    const done = url => { \n      container.remove();\n      resolve(url);\n    }\n\n    render(\n      <URLInputForm \n        onOk={done}\n        onCancel={() => done()} />, container);\n  });\n\n}\n\nconst identifySource = url => {\n  if (url.includes('request=GetPassage'))\n    return 'CTS';\n  else if (url.endsWith('.xml'))\n    return 'TEI_XML';\n  else if (url.includes('textgridlab.org'))\n    return 'TEI_XML'; // Textgrid doesn't end links with .xml...\n  else // to be extended later\n    return 'IIIF';\n}\n\nconst importContent = (files, remoteSource) => {\n  return new Promise(resolve => {\n    const container = document.createElement('div');\n    document.body.appendChild(container);\n\n    const onComplete = () => {\n      container.remove();\n      resolve();\n    }\n\n    const onClose = result => {\n      container.remove();\n    }\n\n    render(<Importer \n      files={files}\n      remoteSource={remoteSource}\n      onComplete={onComplete}\n      onClose={onClose} />, container);\n  });\n}\n\n/** Import a list of files **/\nexport const uploadFiles = files => {\n  return importContent(files);\n}\n\n/** \n * Import content from a remote source\n * \n * Note that one argument (either type or URL) may be undefined. \n * \n * -) When a URL is imported via drag-and-drop, only the URL will be\n * provided (and we can use the 'identifySource' function to attempt\n * type identification)\n * \n * -) When a source is imported via the sidebar menu option, only\n * the type will be provided & this class will provide (or delegate) the\n * import UI components.\n */\nexport const importSource = (typ, url) => {\n  const sourceType = typ || identifySource(url);\n  if (typ === 'SHINE') {\n    return importFromShine().then(files => { \n      if (files)\n        return uploadFiles(files);\n    });\n  } else if (url) {\n    return importContent([], { url: url, sourceType: sourceType });\n  } else {\n    return promptForUrl().then(url => {\n      if (url)\n        return importContent([], { url: url, sourceType: sourceType });\n    });\n  }\n}","import React, { Component } from 'react';\nimport axios from 'axios';\nimport Meter from '../../../../common/Meter.jsx';\n\nexport default class NERProgressModal extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      status: 'PENDING',\n      progress: 0, // 0 - 100\n      tasks: 0,\n      tasksCompleted: 0\n    };\n\n    this.pollProgress();\n  }\n\n  pollProgress() { \n    axios.get(`/api/job/${this.props.jobId}`)\n      .then(result => {\n        this.setState({\n          status: result.data.status,\n          progress: result.data.progress,\n          tasks: result.data.subtasks.length,\n          tasksCompleted: result.data.subtasks.filter(t => t.status === 'COMPLETED').length,\n          tasksFailed: result.data.subtasks.filter(t => t.status === 'FAILED').length\n        });\n\n        const isDone = result.data.status === 'COMPLETED' || result.data.status === 'FAILED';\n        if (isDone)\n          this.props.onComplete && this.props.onComplete();\n        else\n          setTimeout(() => this.pollProgress(), 1000);\n      })\n      .catch(error => {\n        if (error.response.status === 404)\n          // Tasks might still be initializing\n          setTimeout(() => this.pollProgress(), 1000);\n      });\n  }\n\n  render() {\n    const isDone = \n      this.state.status === 'COMPLETED' || \n      this.state.status === 'FAILED';\n\n    return (\n      <div className=\"job-progress\">\n        <div className=\"header\">\n          Named Entity Recognition { isDone && <button \n            className=\"close nostyle\"\n            onClick={this.props.onClose}>&#xe897;</button>\n          }\n        </div>\n\n        <div className=\"body\">\n          <div className=\"message\">\n            Parsed {this.state.tasksCompleted} of {this.state.tasks} files\n            <span className={`icon spinner ${this.state.status}`}></span>\n          </div>\n\n          <div className=\"progress\">\n            <Meter value={this.state.progress / 100} />\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n}","import React, { Component } from 'react';\n\nexport default class AuthoritySelection extends Component {\n\n  onChange(identifier) {   \n    const selection = this.props.selected; \n    const currentIdx = selection.indexOf(identifier);\n\n    if (currentIdx < 0)\n      selection.push(identifier);\n    else\n      selection.splice(currentIdx, 1); \n\n    this.props.onChange(selection);\n  }\n\n  render() {    \n    return (\n      <div className=\"authorities\">\n        <h2>Authority Files</h2>\n\n        <input\n          type=\"checkbox\" \n          id=\"use-all-authorities\"\n          checked={this.props.useAll} \n          onChange={this.props.onToggleAll} />\n        <label htmlFor=\"use-all-authorities\">identify entities against all available authority files</label>\n\n        <div className={`authority-list${this.props.useAll ? ' disabled' : ''}`}>\n          <table>\n            <tbody>\n              {this.props.authorities.map(authority => \n                <tr key={authority.identifier}>\n                  <td>\n                    <input \n                      type=\"checkbox\" \n                      id={authority.identifier} \n                      checked={this.props.selected.includes(authority.identifier)} \n                      onChange={this.onChange.bind(this, authority.identifier)} />\n                    <label htmlFor={authority.identifier} />\n                  </td>\n\n                  <td className=\"shortname\">\n                    <span style={{ backgroundColor: authority.color}}>\n                      {authority.homepage ? \n                        <a href={authority.homepage} \n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\">{authority.shortname}</a>\n                        : \n                        authority.shortname\n                      }\n                    </span>\n                  </td>\n\n                  <td className=\"fullname\">\n                    {authority.fullname}\n                  </td>\n                </tr>\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\n\nexport default class EngineSelection extends Component {\n\n  render() {\n    return (\n      <div className=\"engines\">\n        <h2>Recognition Engines</h2>\n        <table cellSpacing=\"0\">\n          <tbody>\n            {this.props.engines.map((engine, idx) =>\n              <React.Fragment key={idx}>\n                <tr>\n                  <td className=\"name\">\n                    <input \n                      id={engine.identifier}\n                      type=\"radio\" \n                      group=\"engines\" \n                      checked={this.props.selected === engine.identifier}\n                      onChange={this.props.onChange.bind(this, engine.identifier)} />\n                    \n                    <label htmlFor={engine.identifier}>\n                      <span className=\"name\">{engine.name}</span>\n                    </label>\n                  </td>\n\n                  <td className=\"languages\">\n                    { engine.languages.map(lang => <span key={lang}>{lang}</span>) }\n                  </td>\n\n                  <td className=\"description\">\n                    {engine.description}\n                  </td>\n                </tr>\n                \n                <tr className=\"spacer\"></tr>\n              </React.Fragment>\n            )}\n          </tbody>\n        </table>\n        <p className=\"note\">\n          Note: different engines can provide different results and are generally \n          optimized for a specific language.\n        </p>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport axios from 'axios';\nimport Modal from '../../../../common/Modal';\nimport AuthoritySelection from './authorities/AuthoritySelection';\nimport EngineSelection from './engines/EngineSelection';\n\nexport default class NERModal extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      available_engines: [],\n      available_authorities: [],\n\n      selected_engine: null,\n      selected_all_authorities: true,\n      selected_authorities: []\n    };\n\n    this.initAvailableAuthorities();\n    this.initAvailableEngines();\n  }\n\n  isInitComplete() {\n    return this.state.available_engines.length > 0 &&\n      this.state.available_authorities.length > 0;\n  }\n\n  initAvailableEngines() {\n    if (this.state.available_engines.length === 0)\n      axios.get('/api/plugins/ner')\n        .then(result => {\n          const diff = { available_engines: result.data };\n\n          if (!this.state.selected_engine) // Select first as default\n            diff.selected_engine = result.data[0] && result.data[0].identifier;\n\n          this.setState(diff);\n        });\n  }\n\n  initAvailableAuthorities() {\n    axios.get('/api/authorities/gazetteers')\n      .then(result => {\n        const diff = { available_authorities: result.data };\n\n        if (this.state.selected_all_authorities || \n             (!this.state.selected_all_authorities && this.state.selected_authorities.length === 0))\n          diff.selected_authorities = result.data.map(a => a.identifier);\n\n        this.setState(diff);\n      });\n  }\n\n  changeEngine(identifier) {\n    this.setState({ selected_engine: identifier });\n  }\n\n  toggleAllAuthorities() {\n    this.setState(prev => {\n      return { selected_all_authorities: !prev.selected_all_authorities }\n    });\n  }\n\n  changeAuthorities(authorities) {\n    this.setState({ selected_authorities: authorities });\n  }\n\n  onStart() {\n    const response = { engine: this.state.selected_engine };\n\n    if (this.state.selected_all_authorities)\n      response.all_authorities = true;\n    else \n      response.authorities = this.state.selected_authorities;\n\n    this.props.onStart(response);\n  }\n\n  render() {\n    return (\n      <Modal\n        className=\"ner\" \n        title=\"Named Entity Recognition (NER)\"\n        onClose={this.props.onCancel}>\n\n        <p>\n          NER identifies places and persons in your text automatically. \n          Depending on the length of your text, this may take a while. \n        </p>\n\n        <EngineSelection \n          engines={this.state.available_engines} \n          selected={this.state.selected_engine}\n          onChange={this.changeEngine.bind(this)} />\n\n        <AuthoritySelection \n          authorities={this.state.available_authorities} \n          useAll={this.state.selected_all_authorities}\n          selected={this.state.selected_authorities}\n          onToggleAll={this.toggleAllAuthorities.bind(this)} \n          onChange={this.changeAuthorities.bind(this)} />\n\n        <div className=\"buttons\">\n          <button\n            className=\"btn start\"\n            onClick={this.onStart.bind(this)}>Start NER</button>\n\n          <button \n            className=\"btn outline cancel\"\n            onClick={this.props.onCancel}>Cancel</button>\n        </div>\n      </Modal>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport axios from 'axios';\nimport NERProgressModal from './progress/NERProgressModal';\nimport NERConfigurationModal from './configuration/NERConfigurationModal';\n\n/** \n * A stateful container component to manage the\n * entity recognition process.\n */\nexport default class EntityRecognition extends Component {\n\n  state = {\n    running: false,\n    jobId: null\n  }\n\n  start = config => {\n    const textDocuments = this.props.selection.getItems().filter(item => {\n      const isDocument = item.type === 'DOCUMENT';\n      const hasTextParts = item.filetypes.filter(t => t.startsWith('TEXT')).length > 0;\n      return isDocument && hasTextParts;\n    });\n\n    const taskDefinition = { \n      ...{ task_type: 'NER', documents: textDocuments.map(d => d.id) }, \n      ...config \n    }\n\n    axios.post('/api/job', taskDefinition).then(response => {\n      this.setState({\n        running: true,\n        jobId: response.data.job_id\n      });\n    });\n  }\n\n  render() {\n    return this.state.running ? (\n      <NERProgressModal\n        jobId={this.state.jobId} \n        onComplete={this.props.onComplete} \n        onClose={this.props.onClose} />\n    ) : (\n      <NERConfigurationModal \n        onStart={this.start} \n        onCancel={this.props.onCancel} />\n    )\n  }\n\n}","import axios from 'axios';\n\n/** API URL for POST or DELETE **/\nconst getUrl = () => {\n  const currentFolderId = document.location.hash.substring(1);\n  return currentFolderId ?\n    `/api/folder/${currentFolderId}/readme` : '/api/directory/my/readme';\n}\n\n\nexport const updateReadme = function(readme, currentPageState) {\n  return axios.post(getUrl(), { data: readme }).then(() => { \n    return { ...currentPageState, ...{ readme: readme } };\n  });\n}\n\nexport const deleteReadme = function(currentPageState) {\n  return axios.delete(getUrl()).then(() => {\n    return { ...currentPageState, ...{ readme: null } };\n  }); \n}","import React, { Component } from 'react';\nimport axios from 'axios';\nimport Draggable from 'react-draggable';\nimport ReactCSSTransitionReplace from 'react-css-transition-replace';\nimport Icons from '../../../common/documents/table/rows/TypeIcons';\n\nconst TITLES = {\n  MY_DOCUMENTS: 'My Documents',\n  SHARED_WITH_ME: 'Shared with me'\n}\n\nconst FolderItem = props => (\n  <li\n    className={props.selected ? 'folder selected' : 'folder'}\n    onClick={() => props.onSelect(props.item.id)}>{props.item.title}\n    { props.item.has_subfolders && \n      <button \n        className=\"nostyle icon\" \n        onClick={evt => props.onNavigateInto(props.item.id, evt)}>&#xe684;</button> }\n  </li>\n)\n\n\nconst DisabledDocumentItem = props =>  {\n\n  const docType = props.item.filetypes[0];\n\n  return (\n    <li className=\"document\">\n      <img src={`/assets/images/${Icons.get(docType)}`} alt={`icon type ${docType}`} />\n      {props.item.title}\n    </li>\n  )\n}\n\nexport default class FolderBrowser extends Component {\n  \n  constructor(props) {\n    super(props);\n    this.state = this.pageToState(props.page);\n  }\n  \n  /** \n   * Reads a page object and converst the info to the state's\n   * expected { location, subfolders } format.\n   */\n  pageToState = page => {\n    const b = page.breadcrumbs;\n    \n    // Build location from breadcrumbs\n    const location = b.length > 1 ? \n      { ...b[b.length - 1], parent: b[b.length - 2].id } : // has parent folder\n      b.length > 0 ? b[b.length - 1] : 'ROOT';\n\n    return { \n      location, // 'VIEWS', 'ROOT' or folder object\n      items: page.items,\n      selected: null,\n      transition: null\n    };\n  }\n\n  select = id => this.setState({ selected: id });\n\n  goToFolder = id => {\n    const url = \n      this.props.view === 'MY_DOCUMENTS' ? \n        ( id ? `/api/directory/my/${id}` : '/api/directory/my' ) :\n        ( id ? `/api/directory/my/shared/${id}` : '/api/directory/my/shared');\n\n    axios.get(url).then(result => {\n      this.setState(this.pageToState(result.data));\n    });\n  }\n\n  goToViewsOverview = () => {\n    this.setState({\n      location: 'VIEWS',\n      items: [\n        { title: 'My Documents', has_subfolders: true }\n      ],\n      selected: null,\n      transition: null\n    });\n  }\n\n  navigateUp = () => {\n    const goUp = () => {\n      const { location } = this.state;\n      if (location === 'ROOT') // root level of current view\n        this.goToViewsOverview();        \n      else\n        this.goToFolder(location.parent);      \n    }\n\n    this.setState({ transition: 'UP'}, goUp);\n  }\n\n  navigateInto = (folderId, evt) => {\n    evt.stopPropagation(); // Avoid select\n    const goInto = () => this.goToFolder(folderId);\n    this.setState({ transition: 'INTO'}, goInto);\n  }\n\n  move = () => {\n    const { selection } = this.props;\n    const destination = this.state.selected;\n\n    const documents = selection.getDocuments();\n    const folders = selection.getFolders();\n\n    const fDocs = documents.length > 0 ?\n      axios.put('/api/document/bulk', {\n        action: 'MOVE_TO', \n        destination,\n        documents: this.props.selection.getDocuments().map(d => d.id)\n      }) : Promise.resolve();\n\n    const fFolders = folders.length > 0 ? \n      axios.put('/api/folder/bulk', {\n        action: 'MOVE_TO', \n        destination,\n        folders: this.props.selection.getFolders().map(d => d.id)\n      }) : Promise.resolve();\n\n    Promise.all([ fDocs, fFolders ]).then(() => this.props.onComplete());\n  }\n\n  render() {\n    const title = \n      this.state.location === 'VIEWS' ? 'Workspace' :\n        this.state.location === 'ROOT' ? TITLES[this.props.view] : this.state.location.title;\n\n    const key = \n      this.state.location.id ? this.state.location.id : this.state.location;\n\n    const items = this.state.items.map(f => f.type === 'DOCUMENT' ?\n      <DisabledDocumentItem\n        key={f.id ? f.id : f.title}\n        item={f} /> :\n\n      <FolderItem \n        key={f.id ? f.id : f.title}\n        item={f}\n        selected={this.state.selected === f.id}\n        onSelect={this.select}\n        onNavigateInto={this.navigateInto} />\n    );\n\n    return (\n      <div className=\"clicktrap\">\n        <div className=\"modal-wrapper\">\n          <Draggable handle=\".header\">\n            <div className=\"modal folder-browser\">\n              <div className=\"header\">\n                { this.state.location !== 'VIEWS' && \n                  <button\n                    className=\"nostyle icon up\"\n                    onClick={this.navigateUp}>&#xe686;</button>\n                }\n\n                <span className=\"title\">{title}</span>\n\n                <button\n                  className=\"nostyle icon cancel\"\n                  onClick={this.props.onCancel}>&#xe680;</button>\n              </div>\n\n              <div className=\"body\">\n                <ReactCSSTransitionReplace\n                  transitionName=\"wipe\"\n                  transitionEnterTimeout={200}\n                  transitionLeaveTimeout={200}>\n\n                  <ul className={this.state.transition === 'UP' ? 'up' : 'into'}\n                      key={key}>{items}</ul>\n\n                </ReactCSSTransitionReplace>\n              </div>\n\n              <div className=\"footer\">\n                <button \n                  className=\"btn\"\n                  disabled={this.state.selected === null}\n                  onClick={this.move}>Move here</button>\n              </div>\n            </div>\n          </Draggable>\n        </div>\n      </div>\n    )\n  }\n\n}\n\n","import React, { Component } from 'react';\nimport { render } from 'react-dom';\nimport Draggable from 'react-draggable';\n\nclass Prompt extends Component {\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.onKeydown, false);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.onKeydown, false);\n  }\n\n  onKeydown = (evt) => {\n    if (evt.which === 27) this.props.onNo();\n  }\n\n  render() {\n    const className = (this.props.type) ? `prompt ${this.props.type.toLowerCase()}` : 'prompt';\n\n    return (\n      <div className=\"clicktrap\">\n        <Draggable handle=\".prompt-header\">\n          <div className={className}>\n            <div className=\"prompt-header\">\n              <h1 className=\"title\">{this.props.title}</h1>\n            </div>\n\n            <div className=\"prompt-body\">\n              <p className=\"message\">{this.props.message}</p>\n              <p className=\"buttons\">\n                 <button className=\"btn yes\" onClick={this.props.onYes}>YES</button>\n                 <button className=\"btn outline no\" onClick={this.props.onNo}>NO</button>\n              </p>\n            </div>\n          </div>\n        </Draggable>\n      </div>\n    )\n  }\n\n}\n\nexport const prompt = props => {\n  const promptRoot = document.createElement('div');\n  promptRoot.setAttribute('id', 'confirm-prompt-root');\n  document.body.append(promptRoot);\n\n  const onYes = () => {\n    promptRoot.remove();\n    props.onConfirm();\n  }\n\n  const onNo = () => {\n    promptRoot.remove();\n    props.onCancel && props.onCancel();\n  }\n\n  render(\n    <Prompt \n      title={props.title}\n      type={props.type}\n      message={props.message}\n      onYes={onYes}\n      onNo={onNo} />, promptRoot);\n}","import React, { Component } from 'react';\nimport { render } from 'react-dom';\nimport Draggable from 'react-draggable';\n\nclass Alert extends Component {\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.onKeydown, false);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.onKeydown, false);\n  }\n\n  onKeydown = (evt) => {\n    if (evt.which === 27) this.props.onClose();\n  }\n\n  render() {\n    const className = (this.props.type) ? `prompt ${this.props.type.toLowerCase()}` : 'prompt';\n\n    return (\n      <div className=\"clicktrap\">\n        <Draggable handle=\".prompt-header\">\n          <div className={className}>\n            <div className=\"prompt-header\">\n              <h1 className=\"title\">{this.props.title}</h1>\n            </div>\n\n            <div className=\"prompt-body\">\n              <p className=\"message\">{this.props.message}</p>\n              <p className=\"buttons\">\n                <button className=\"btn\" onClick={this.props.onClose}>Close</button>\n              </p>\n            </div>\n          </div>\n        </Draggable>\n      </div>\n    )\n  }\n\n}\n\nexport const alert = props => {\n  const promptRoot = document.createElement('div');\n  promptRoot.setAttribute('id', 'alert-root');\n  document.body.append(promptRoot);\n\n  const onClose = () => {\n    promptRoot.remove();\n    props.onClose && props.onClose();\n  }\n\n  render(\n    <Alert \n      title={props.title}\n      type={props.type}\n      message={props.message}\n      onClose={onClose} />, promptRoot);\n}","import React, { Component } from 'react';\nimport axios from 'axios';\n\nexport default class PublicAccess extends Component {\n\n  state = {\n    visibility: 'PRIVATE',\n    access_level: 'READ_ALL'\n  }\n\n  componentDidMount() {\n    axios.get(`/api/sharing/folders/${this.props.item.id}/visibility`)\n      .then(result => {\n        const { visibility, access_level } = result.data;\n        this.setState({ visibility: visibility, access_level: access_level || 'READ_ALL' });\n      });\n  }\n\n  updateSetting = (update) => {\n    this.setState(update, () => {\n      axios.post('/api/sharing/folders/visibility', {\n        ...this.state, ids: [ this.props.item.id ]\n      }).catch(error => {\n        // TODO \n      });\n    });\n  }\n\n  onChangeVisibility = (visibility) => {\n    this.updateSetting({ visibility: visibility });\n  }\n\n  onChangeAccessLevel = (evt) => {\n    this.updateSetting({ access_level: evt.target.value });\n  }\n\n  render() {\n    return (\n      <div className=\"public-access\">\n        <div className=\"multi-share-section\">\n          <h3>Enable Public Access</h3>\n          <div>\n            <input \n              type=\"radio\" \n              name=\"public-access\" id=\"pa-off\"\n              checked={this.state.visibility === 'PRIVATE'} \n              onChange={() => this.onChangeVisibility('PRIVATE')} />\n            <label htmlFor=\"pa-off\">Off</label>\n            <p>\n              Only people you explicitly add as collaborators have access.\n            </p>\n          </div>\n\n          <div>\n            <input \n              type=\"radio\" \n              name=\"public-access\" \n              id=\"pa-public\" \n              checked={this.state.visibility === 'PUBLIC'} \n              onChange={() => this.onChangeVisibility('PUBLIC')} />\n            <label htmlFor=\"pa-public\">Anyone on the Web</label>\n            <p>\n              Public documents are listed on your profile page, and anyone on the Internet can find them.\n            </p>\n          </div>\n\n          <div>\n            <input \n              type=\"radio\"\n              name=\"public-access\" \n              id=\"pa-with-link\" \n              checked={this.state.visibility === 'WITH_LINK'} \n              onChange={() => this.onChangeVisibility('WITH_LINK')} />\n            <label htmlFor=\"pa-with-link\">Anyone with the Link</label>\n            <p>\n              Accessible to anyone who has the link, but it is not listed on your profile page.\n            </p>\n          </div>\n        </div>\n\n        <div className=\"multi-share-section\">\n          <strong>Access:</strong> anyone can\n\n          <select value={this.state.access_level} onChange={this.onChangeAccessLevel}>\n            <option value=\"READ_ALL\">view</option>\n            <option value=\"READ_DATA\">view map and downloads but not document content</option>\n            <option value=\"WRITE\">annotate</option>\n          </select>\n\n          <p>\n            Annotating requires a Recogito account. Visitors who are not logged in can view\n            documents (if enabled), and download annotations from the download page. But \n            they cannot add annotations, even when public annotation is enabled. Blocking \n            access to document content will also limit some of the download options.\n          </p>\n\n          <div className=\"footer\">\n            <button className=\"btn\" onClick={this.props.onClose}>Close</button>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport { render} from 'react-dom';\n\nclass PermissionSelector extends Component {\n\n  componentDidMount() {\n    document.addEventListener('mousedown', this.onMousedown, false);\n    document.addEventListener('keydown', this.onKeydown, false);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mousedown', this.onMousedown, false);\n    document.removeEventListener('keydown', this.onKeydown, false);\n  }\n\n  onMousedown = (evt) => {\n    const isClickOutside = !this._node.contains(evt.target);\n    if (isClickOutside) this.props.onCancel();\n  }\n\n  onKeydown = (evt) => {\n    evt.stopPropagation();\n    if (evt.which === 27) this.props.onCancel();\n  }\n\n  handleCancel= () => {\n    this.props.onCancel();\n  }\n\n  changeLevel(level) {\n    this.props.onChangeLevel(level);\n  }\n\n  render() {\n    return (\n      <div \n        className=\"permission-selector\"\n        ref={n => this._node = n}>\n\n        <h3>Permission Level\n          <span className=\"close outline-icon\" onClick={this.handleCancel}>{'\\ue897'}</span>\n        </h3>\n        <ul>\n          <li\n            className=\"READ\"\n            onClick={() => this.changeLevel('READ')}>\n            <div className=\"checked\">\n              <div className=\"icon\">\n                {this.props.accessLevel === 'READ' && '\\uf00c' }\n              </div>\n            </div>\n            <h4>Read</h4>\n            <p>Collaborators can read document and annotations, but not edit.</p>\n          </li>\n\n          <li \n            className=\"WRITE\"\n            onClick={() => this.changeLevel('WRITE')}>\n            <div className=\"checked\">\n              <div className=\"icon\">\n                {this.props.accessLevel === 'WRITE' && '\\uf00c' }\n              </div>\n            </div>\n            <h4>Write</h4>\n            <p>Collaborators can read document and annotations, create new annotations, add and reply to comments.</p>\n          </li>\n\n          <li\n            className=\"ADMIN\"\n            onClick={() => this.changeLevel('ADMIN')}>\n            <div className=\"checked\">\n              <div className=\"icon\">\n                {this.props.accessLevel === 'ADMIN' && '\\uf00c' }\n              </div>\n            </div>\n            <h4>Admin</h4>\n            <p>Admins can edit document metadata, invite other collaborators, backup and restore, and roll back the edit history.</p>\n          </li>\n        </ul>\n      </div>\n    )\n  }\n\n}\n\nexport function openSelector(config) {\n  const parent = config.parent;\n  const root = document.createElement('div');\n  parent.append(root);\n\n  const onCancel = () => {\n    root.remove(); \n  }\n\n  const onChangeLevel = (level) => {\n    config.onChangeLevel(level);\n    root.remove();\n  }\n\n  render(\n    <PermissionSelector \n      accessLevel={config.accessLevel}\n      onChangeLevel={onChangeLevel}\n      onCancel={onCancel} />, \n  root);\n}","import React, { Component } from 'react';\nimport { AsyncTypeahead } from 'react-bootstrap-typeahead'; \nimport axios from 'axios';\n\nexport default class UserSearch extends Component {\n\n  state = {\n    isLoading: false,\n    options: [],\n    selected: null,\n    inputValue: null\n  }\n\n  fetchSuggestions = query => {\n    this.setState({isLoading: true});\n    const exclude = this.props.exclude ? this.props.exclude : [];\n    axios.get(`/api/sharing/search?q=${query}`)\n      .then(result => this.setState({\n        isLoading: false,\n        options: result.data.filter(username => !exclude.includes(username))\n      }));\n  }\n\n  onChange = (selected) => {\n    this.setState({ selected: selected });\n  }\n\n  onInputChange = (value) => {\n    this.setState({ inputValue: value });\n  }\n\n  clear = () => {\n    this._input.getInstance().clear();\n    this.setState({ \n      selected: null,\n      inputValue: null\n    });\n  }\n\n  onKeyDown = (evt) => {\n    const { selected, inputValue, options } = this.state;\n    if (evt.which === 13) { // Enter\n      if (selected && selected.length === 1)\n        this.props.onSelect(selected[0]);\n      else if (inputValue && options.includes(inputValue))\n        this.props.onSelect(inputValue);\n    }\n  }\n\n  render() {\n    return (\n      <AsyncTypeahead\n        id=\"typeahead\"\n        ref={r => this._input = r}\n        className=\"user-search\"\n        placeholder={this.props.placeholder || 'Enter username'}\n        selected={this.state.selected}\n        onChange={this.onChange}\n        onInputChange={this.onInputChange}\n        onKeyDown={this.onKeyDown}\n        isLoading={this.state.isLoading}\n        onSearch={this.fetchSuggestions} \n        options={this.state.options} />\n    )\n  }\n\n}","import React, { Component } from 'react';\nimport axios from 'axios';\nimport { openSelector } from './PermissionSelector';\nimport UserSearch from '../../../../common/UserSearch';\n\nexport default class Collaborators extends Component {\n\n  state = {\n    collaborators: []\n  }\n\n  componentDidMount() {\n    axios.get(`/api/sharing/folders/${this.props.item.id}/collaborators`)\n    .then(result => {\n      this.setState({ collaborators: result.data.collaborators });\n    });\n  }\n\n  storeCollaborator = (setting) => {\n    axios.post('/api/sharing/folders/collaborator', {\n      ...setting, ids: [ this.props.item.id ]\n    }).catch(error => {\n      // TODO \n    });\n  }\n  \n  openPermissionsSelector = (evt, collaborator) => {\n    const button = evt.target.nodeName === 'BUTTON' ? evt.target : evt.target.parentNode;\n\n    openSelector({\n      parent: button.parentNode, \n      accessLevel: collaborator.access_level,\n\n      onChangeLevel: level => { \n        const update= { username: collaborator.username, access_level: level } \n        this.storeCollaborator(update);\n        this.setState(prev => {\n          return {\n            collaborators: prev.collaborators.map(c => {\n              return (c.username === collaborator.username) ? update : c;\n            })\n          }\n        }) \n      }\n    });\n  }\n\n  removeCollaborator = collaborator => {\n    this.setState(prev => {\n      return { collaborators: prev.collaborators.filter(c => c.username !== collaborator.username) }\n    });\n\n    axios.delete('/api/sharing/folders/collaborator', { data: {\n      ids: [ this.props.item.id ],\n      username: collaborator.username\n    }}).catch(error => {\n      // TODO\n    });\n  }\n\n  addCollaborator = username => {\n    const update = { username: username, access_level: 'READ' }\n    this.storeCollaborator(update);\n    this.setState(prev => {\n      return { \n        collaborators:  [ ...prev.collaborators, update ]\n      }\n    });\n  }\n\n  render() {\n    const collaborators = this.state.collaborators.map(c => \n      <tr key={c.username}>\n        <td>{c.username}</td>\n        <td>\n          <button\n            className=\"btn small permissions\"\n            onClick={(evt) => this.openPermissionsSelector(evt, c)}>\n            <span className=\"label\">{c.access_level}</span>\n            <span className=\"icon\">{'\\uf0dd'}</span>\n          </button>\n        </td>\n        <td className=\"col-actions remove-collaborator\">\n          <button \n            className=\"nostyle outline-icon\"\n            onClick={() => this.removeCollaborator(c)}>{'\\ue897'}</button>\n        </td>\n      </tr>\n    );\n\n    return (\n      <div className=\"collaborators\">\n        <div className=\"multi-share-section\">\n          <h3>Collaborators</h3>\n          <table className=\"collaborators\">\n            <tbody>\n              {collaborators.length > 0 ? \n                  collaborators : <tr className=\"no-collaborators\"><td>There are no collaborators yet. Enter a username below to add one.</td></tr>\n              }\n            </tbody>\n          </table>\n        </div>\n\n        <div className=\"multi-share-section add-collaborator\">\n          <UserSearch \n            exclude={this.state.collaborators.map(c => c.username)} \n            onSelect={this.addCollaborator} />\n\n          <div className=\"footer\">\n            <button className=\"btn\" onClick={this.props.onClose}>Close</button>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport UserSearch from '../../../../common/UserSearch';\n\nexport default class DistributeCopies extends Component {\n\n  state = {\n    recipients: []\n  }\n\n  removeRecipient = recipient => {\n    this.setState(prev => {\n      return { recipients: prev.recipients.filter(r => r !== recipient) }\n    });\n  }\n\n  addRecipient = recipient => {\n    this.setState(prev => {\n      return { recipients:  [ ...prev.recipients, recipient ] }\n    });\n  }\n  \n  sendCopies = () => {\n    // TODO \n  }\n\n  render() {\n    const recipients = this.state.recipients.map(r => \n      <tr key={r}>\n        <td>\n          {r} \n          <button \n            className=\"nostyle icon remove\"\n            onClick={() => this.removeRecipient(r)}>&#xf00d;</button>\n        </td>\n      </tr>\n    );\n\n    return (\n      <div className=\"distribute-copies\">\n        <h3>Send copies to</h3>\n        \n        <table className=\"recipients\">\n          <tbody>\n            { recipients.length > 0 ? recipients :\n              <tr><td className=\"add-recipients\">Add recipients below</td></tr> }\n          </tbody>\n        </table>\n\n        <UserSearch \n          exclude={this.state.recipients.map(c => c.username)} \n          onSelect={this.addRecipient} />\n\n        <div className=\"footer\">\n          <button\n            className=\"btn\" \n            disabled={recipients.length === 0}\n            onClick={this.sendCopies}>Send now</button>\n\n          <button className=\"btn\" onClick={this.props.onClose}>Close</button>\n        </div>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport Modal from '../../../common/Modal';\nimport PublicAccess from './public/PublicAccess';\nimport Collaborators from './collaborators/Collaborators';\nimport DistributeCopies from './copies/DistributeCopies';\n\nexport default class ShareModal extends Component {\n\n  state = {\n    view: 'PUBLIC_ACCESS'\n  };\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.onKeydown, false);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.onKeydown, false);\n  }\n\n  onKeydown = (evt) => {\n    evt.stopPropagation();\n    if (evt.which === 27) this.props.onClose();\n  }\n\n  setView = (name) => {\n    this.setState({ view: name });\n  }\n\n  getView = () => {\n    if (this.state.view === 'PUBLIC_ACCESS')\n      return <PublicAccess item={this.props.selection.get(0)} onClose={this.props.onClose}/>\n    else if (this.state.view === 'COLLABORATORS')\n      return <Collaborators item={this.props.selection.get(0)} onClose={this.props.onClose} />\n    else if (this.state.view === 'DISTRIBUTE_COPIES')\n      return <DistributeCopies item={this.props.selection.get(0)} onClose={this.props.onClose} />\n  }\n\n  render() {\n    return (\n      <Modal\n        className=\"multi-share-modal\" \n        title=\"Share\"\n        onClose={this.props.onClose}>\n        <div className=\"multi-share\">\n          <div className=\"multi-share-tabs\">\n            <ul>\n              <li \n                className={this.state.view === 'PUBLIC_ACCESS' ? 'active' : ''}\n                onClick={() => this.setView('PUBLIC_ACCESS')} >\n                Public Access\n              </li>\n\n              <li \n                className={this.state.view === 'COLLABORATORS' ? 'active' : ''}\n                onClick={() => this.setView('COLLABORATORS')} >\n                Collaborators\n              </li>\n\n              <li className=\"disabled\">\n                Distribute Copies\n              </li>\n            </ul>\n          </div>\n\n          <div className=\"multi-share-body\">\n            <div className=\"view-container\">\n              { this.getView() }     \n            </div>\n          </div>\n        </div>\n      </Modal>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport axios from 'axios';\nimport Modal from '../../../common/Modal';\nimport { prompt } from '../prompt';\n\nclass NetworkTreeNode extends Component  {\n\n  state = {\n    edits_since: null\n  }\n\n  componentDidMount() {\n    const { cloned_at } = this.props; // null for root\n    if (cloned_at) {\n      axios.get(`/api/document/${this.props.id}/contributions/count?since=${encodeURIComponent(cloned_at)}`)\n        .then(response => this.setState({ edits_since: response.data.contributions }));\n    }\n  }\n\n  merge = () => {\n    const executeMerge = () => {\n      axios.post(`/api/document/${this.props.selected}/merge?from=${this.props.id}`)\n        .then(response => this.props.onMergeComplete());\n\n      // TODO handle errors\n    }\n\n    const message = \n      `This operation will merge annotations from both documents, potentially overwriting \n       edits you have made. Are you sure you want to do this?`;\n\n    prompt({\n      title: 'Merge Annotations',\n      message: message,\n      type: 'WARNING',\n      onConfirm: executeMerge\n    });\n  }\n\n  render() {\n    const { feature_toggles} = this.props.account;\n    const isSelected = this.props.selected === this.props.id;\n\n    return (\n      <li>\n        <span className={isSelected ? 'selected doc-id' : 'doc-id'}>\n          <a href={`/${this.props.owner}`}>\n            { this.props.owner }\n          </a> / <a href={`/document/${this.props.id}`}>\n            { this.props.id }\n          </a>\n        </span>\n        { this.state.edits_since > 0 && \n          <>\n            <span className=\"edits-since\">+ {this.state.edits_since} edits</span>\n            { feature_toggles && feature_toggles.includes('merge-documents') && !isSelected &&\n              <button className=\"merge btn tiny\" onClick={this.merge}>Merge Annotations</button> \n            }\n          </>\n        }\n        { this.props.children && \n          <ul>\n            { this.props.children.map(doc => \n              <NetworkTreeNode \n                key={doc.id} \n                account={this.props.account}\n                selected={this.props.selected} \n                onMergeComplete={this.props.onMergeComplete}\n                {...doc} /> \n            )}\n          </ul>\n        }\n      </li>\n    )\n  }\n\n}\n\nexport default class NetworkModal extends Component {\n\n  state = {\n    network: null\n  }\n\n  componentDidMount() {\n    // Assuming a single-document selection, enforced through the menu component\n    const docId = this.props.selection.get(0).id;\n\n    axios.get(`/api/document/${docId}/network`)\n      .then(response => {\n\n        this.setState({ network: response.data })\n      });\n\n    document.addEventListener('keydown', this.onKeydown, false);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.onKeydown, false);\n  }\n\n  onKeydown = (evt) => {\n    evt.stopPropagation();\n    if (evt.which === 27) this.props.onClose();\n  }\n\n  render() {\n    return (\n      <Modal\n        className=\"explore-network-modal\" \n        title=\"Explore Network\"\n        onClose={this.props.onClose}>\n        <div className=\"explore-network\">\n          { this.state.network && \n            <ul>\n              <NetworkTreeNode \n                account={this.props.account}\n                {...this.state.network.root} \n                selected={this.props.selection.get(0).id} \n                onMergeComplete={this.props.onMergeComplete} />\n            </ul>\n          }\n        </div>\n      </Modal>\n    )\n  }\n\n}\n","import { createFolder, renameFolder } from './folder';\nimport { uploadFiles, importSource } from './importing';\nimport { entityRecognition } from './ner';\nimport { updateReadme, deleteReadme } from './readme';\nimport { moveSelection } from './move';\nimport { deleteSelection, duplicateSelection } from './selection';\nimport { shareSelection } from './sharing';\nimport { exploreNetwork } from './network';\n\n/** \n * Wraps all operations into one object so that \n * we can import them in one go.\n */\nexport default {\n  createFolder,\n  renameFolder,\n  uploadFiles,\n  importSource,\n  updateReadme,\n  deleteReadme,\n  deleteSelection,\n  moveSelection,\n  duplicateSelection,\n  shareSelection,\n  exploreNetwork,\n  entityRecognition\n};","import React from 'react';\nimport { render } from 'react-dom';\nimport SHINEModal from './SHINEModal';\n\nexport const importFromShine = () => {\n\n  return new Promise(resolve => {\n    const container = document.createElement('div');\n    document.body.appendChild(container);\n\n    const onResolve = files => {\n      container.remove();\n      resolve(files);\n    }\n    \n    render(\n      <SHINEModal \n        onClose={onResolve}\n        onUploadFiles={onResolve} />, container);\n  });\n\n}","import axios from 'axios';\nimport { prompt } from '../prompt';\nimport { alert } from '../alert';\n\nconst deleteFolders = folders => {\n  const ids = folders.map(f => f.id);\n\n  if (ids.length > 0) {\n    return ids.length === 1 ?\n      axios.delete(`/api/folder/${ids[0]}`) : \n      axios.delete(`/api/folder/bulk`, { data: ids });\n  } else {\n    return new Promise((resolve) => { resolve(); });\n  }\n}\n\nconst deleteDocuments = (documents, view) => {\n  const ids = documents.map(d => d.id);\n\n  if (ids.length > 0) {\n    return ids.length === 1 ? (\n      view === 'MY_DOCUMENTS' ? // Delete or unshare \n        axios.delete(`/api/document/${ids[0]}`) : axios.delete(`/api/shared/document/${ids[0]}`) \n    ) : (\n      view === 'MY_DOCUMENTS' ?\n        axios.delete('/api/document/bulk', { data: ids }) : axios.delete('/api/shared/document/bulk', { data: ids })\n    )\n  } else {\n    return new Promise((resolve) => { resolve(); });\n  }\n}\n\nexport const deleteSelection = args => {\n\n  const { \n    selection,\n    view, \n    onStart, \n    onSuccess, \n    onError, \n    onCancel \n  } = args;\n\n  const message = view === 'MY_DOCUMENTS' ?\n    'You are about to permanently delete the selected documents. Are you sure?' :\n    'This will remove the selected documents from your shared documents list. Are you sure?';\n\n  const executeDelete = () => {\n    const folders = selection.getItems().filter(i => i.type === 'FOLDER');\n    const documents = selection.getItems().filter(i => i.type === 'DOCUMENT');\n\n    if (folders.length + documents.length > 0) {\n      onStart();\n\n      deleteDocuments(documents, view)\n        .then(() => deleteFolders(folders))\n        .then(() => {\n          onSuccess();\n        }).catch((error) => {\n          onError(error);\n        });\n    } else {\n      onCancel && onCancel();\n    }\n  }\n\n  prompt({\n    title: 'Delete',\n    message: message,\n    type: 'WARNING',\n    onConfirm: executeDelete,\n    onCancel: onCancel\n  });\n\n}\n\n/** Only supports single documents at them moment **/\nexport const duplicateSelection = selection => {\n  if (selection.isSingleDocument()) {\n    const doc = selection.get(0);\n    return axios.post(`/api/clone/document/${doc.id}`).catch(error => {\n      const message = error.response.status === 409 ? \n        'Oops. Could not duplicate - storage quota exceeded.' :\n        'Oops. Something went wrong.';\n\n      alert({\n        title: 'Error',\n        type: 'WARNING',\n        message: message\n      });\n    });\n  } else {\n    return new Promise((resolve) => { resolve(); });\n  }\n}","import React from 'react';\nimport { render } from 'react-dom';\nimport FolderBrowser from './FolderBrowser';\n\nexport const moveSelection = args => {\n\n  const container = document.createElement('div');\n  document.body.appendChild(container);\n\n  const onComplete = () => {\n    container.remove();\n    args.onComplete();\n  }\n\n  const onCancel = () => {\n    container.remove();\n  }\n\n  render(\n    <FolderBrowser\n      view={args.view}\n      page={args.page}\n      selection={args.selection} \n      onComplete={onComplete}\n      onCancel={onCancel} />, container);\n\n}","import React from 'react';\nimport { render } from 'react-dom';\nimport ShareModal from './ShareModal';\n\nexport const shareSelection = selection => {\n\n  return new Promise(resolve => {\n    const container = document.createElement('div');\n    document.body.appendChild(container);\n\n    const close = url => { \n      container.remove();\n      resolve();\n    }\n\n    render(\n      <ShareModal\n        selection={selection}\n        onClose={close} />, container);\n  });\n\n}","import React from 'react';\nimport { render } from 'react-dom';\nimport NetworkModal from './NetworkModal';\n\nexport const exploreNetwork = (selection, account) => {\n  \n  return new Promise(resolve => {\n    const container = document.createElement('div');\n    document.body.appendChild(container);\n\n    const close = url => { \n      container.remove();\n      resolve();\n    }\n\n    render(\n      <NetworkModal\n        selection={selection}\n        account={account}\n        onClose={close} \n        onMergeComplete={close} />, container);\n  });\n\n}","import React from 'react';\nimport { render } from 'react-dom';\nimport EntityRecognition from './EntityRecognition';\n\nexport const entityRecognition = selection => {\n\n  return new Promise(resolve => {\n    const container = document.createElement('div');\n    document.body.appendChild(container);\n\n    const onComplete = () => {\n      resolve();\n    }\n\n    const onClose = () => {\n      container.remove();\n    }\n\n    render(\n      <EntityRecognition \n        selection={selection}\n        onCancel={onClose} \n        onClose={onClose}\n        onComplete={onComplete} />, container);\n  });\n\n}","import React, { Component } from 'react';\n\nconst MenuGroup = props => {\n\n  const classNames = props.className ? \n    [ 'group', props.className ] : [ 'group']\n\n  return (\n    <li\n      className={classNames.join(' ')}>\n      <ul>\n        {props.children}\n      </ul>\n    </li>\n  );\n\n}\n\nconst MenuItem = props => {\n\n  return (\n    <li\n      key={props.label}\n      className={`option${props.disabled ? ' disabled' : '' }`}\n      onClick={(props.disabled || !props.onSelect) ? null : props.onSelect}>\n\n      {props.link ? \n        <a href={props.link}>\n          {props.icon && <span className=\"icon\">{props.icon}</span> } {props.label}\n        </a>\n        : \n        <span>\n          {props.icon && <span className=\"icon\">{props.icon}</span>} {props.label}\n        </span>\n      }\n    </li>\n  );\n\n}\n\nclass Menu extends Component {\n\n  constructor(props) {\n    super(props);\n    this.onMousedown = this.onMousedown.bind(this);\n    this.onKeydown = this.onKeydown.bind(this);\n  }\n\n  componentDidMount() {\n    document.addEventListener('mousedown', this.onMousedown, false);\n    document.addEventListener('keydown', this.onKeydown, false);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mousedown', this.onMousedown, false);\n    document.removeEventListener('keydown', this.onKeydown, false);\n  }\n\n  onMousedown(evt) {\n    const isClickOutside = !this._node.contains(evt.target);\n    if (isClickOutside) this.props.onCancel();\n  }\n\n  onKeydown(evt) {\n    if (evt.which === 27) this.props.onCancel();\n  }\n\n  render() {\n    return (\n      <div\n        ref={n => this._node = n}\n        className={`modal-menu ${this.props.className}`}>\n        <ul>\n          { this.props.children }\n        </ul>\n      </div>\n    )\n  }\n\n}\n\nMenu.Group = MenuGroup;\nMenu.Item = MenuItem;\n\nexport default Menu;\n","import React, { Component } from 'react';\nimport UserSearch from '../../../common/UserSearch';\n\nconst INITIAL_STATE = {\n  query        : '',\n  in           : 'ALL',     // 'MY', 'SHARED'\n  type         : 'ANY',     // 'TEXT', 'IMAGE', 'TABLE'\n  owner        : '',\n  lastModified : 'ANYTIME', // 'WEEK' \n};\n\nexport default class AdvancedSearch extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = { ...INITIAL_STATE }\n\n    this.onMousedown = this.onMousedown.bind(this);\n    this.onKeydown = this.onKeydown.bind(this);\n  }\n\n  componentDidMount() {\n    document.addEventListener('mousedown', this.onMousedown, false);\n    document.addEventListener('keydown', this.onKeydown, false);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mousedown', this.onMousedown, false);\n    document.removeEventListener('keydown', this.onKeydown, false);\n  }\n\n  onMousedown(evt) {\n    const isClickOutside = !this._node.contains(evt.target);\n    const isClickOnToggle = evt.target.classList.contains('advanced');\n    if (isClickOutside && !isClickOnToggle) this.props.onClose();\n  }\n\n  onKeydown(evt) {\n    if (evt.which === 27) this.props.onClose();\n  }\n\n  onChangeSearchIn = evt => this.setState({ in: evt.target.value });\n\n  onChangeDocType = evt => this.setState({ type: evt.target.value });\n\n  onChangeOwner = owner => this.setState({ owner: owner });\n\n  onChangeQuery = evt => this.setState({ query: evt.target.value });\n\n  onChangeLastModified = evt => this.setState({ lastModified: evt.target.value });\n\n  onClear = evt => { \n    evt.preventDefault();\n    this.setState({ ...INITIAL_STATE });\n  }\n\n  onSearch = evt => {\n    evt.preventDefault();\n    this.props.onSearch(this.state);\n  }\n\n  render() {\n    return (\n      <div\n        ref={n => this._node = n}\n        className=\"advanced-search\">\n        <button\n          className=\"close nostyle\"\n          onClick={this.props.onClose}>&#xe897;</button>\n\n        <form>\n          <fieldset>\n            <div className=\"field\">\n              <label>Search in</label>\n              <select\n                value={this.state.searchIn}\n                onChange={this.onChangeSearchIn}>\n                <option value=\"ALL\">All of Recogito</option>\n                <option value=\"MY\">My documents</option>\n                <option value=\"SHARED\">Shared with me</option>\n              </select>\n              <span className=\"hint\" />\n            </div>\n\n            <div className=\"field\">\n              <label>Document type</label>\n              <select\n                value={this.state.docType}\n                onChange={this.onChangeDocType}>\n                <option value=\"ANY\">Any</option>\n                <option value=\"TEXT\">Text</option>\n                <option value=\"IMAGE\">Image</option>\n                <option value=\"TABLE\">Table</option>\n              </select>\n              <span className=\"hint\" />\n            </div>\n\n            <div className=\"field\">\n              <label>Owner</label>\n              <UserSearch\n                onSelect={this.onChangeOwner} />\n              <span className=\"hint\" />\n            </div>\n\n            <div className=\"field\">\n              <label>Metadata contains</label>\n              <input \n                type=\"text\" \n                value={this.state.query} \n                onChange={this.onChangeQuery} />\n              <span className=\"hint\" />\n            </div>\n\n            <div className=\"field\">\n              <label>Last modified</label>\n              <select \n                value={this.state.lastModified}\n                onChange={this.onChangeLastModified}>\n                <option value=\"ANYTIME\">Any time</option>\n                <option value=\"WEEK\">this week</option>\n              </select>\n              <span className=\"hint\" />\n            </div>\n          </fieldset>\n\n          <fieldset className=\"buttons\">\n            <button type=\"button\" className=\"nostyle clear\" onClick={this.onClear}>Clear</button>\n            <button type=\"button\" className=\"btn\" onClick={this.onSearch}>Search</button>\n          </fieldset>\n        </form>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport axios from 'axios';\n\nimport AdvancedSearch from './AdvancedSearch.jsx';\n\nconst SCOPE_NAMES = {\n  MY_DOCUMENTS   : 'my',\n  SHARED_WITH_ME : 'shared'\n} \n\nexport default class Search extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = { \n      query: '',\n      advancedSearchOpen: false \n    };\n    this._rootEl = document.getElementById('app');\n  }\n\n  componentDidMount() {\n    this._rootEl.addEventListener('keydown', this.onKeydown, false);\n  }\n\n  /** Remove deselect listeners **/\n  componentWillUnmount() {\n    this._rootEl.removeEventListener('keydown', this.onKeydown, false);\n  }\n\n  onKeydown = evt => {\n    if (evt.which === 27 && this.props.searchScope) {\n      this.setState({ query: '' });\n      this.props.onQuit();\n    }\n  }\n\n  toggleAdvancedSearch = () => {\n    this.setState(prev => ({ \n      advancedSearchOpen: !prev.advancedSearchOpen,\n      query: ''\n    }));\n  }\n\n  executeSearch = args => {\n    const data = {\n      ...args,\n      ...this.props.tableConfig\n    };\n\n    axios.post('/api/search', data).then(result => {\n      this.props.onResponse(result.data);\n    });\n  }\n\n  onSearch = evt => {\n    const query = evt.target.value;\n    this.setState({ query: query });\n\n    if (query.length === 0) {\n      this.props.onQuit();\n    } else if (query.length > 1) {\n      const scope = this.props.searchScope ? \n        this.props.searchScope : this.props.view;\n\n      this.executeSearch({\n        q: query,\n        in: SCOPE_NAMES[scope]\n      });\n    }\n  }\n\n  advancedSearch = settings => {\n    const args = {\n      q     : settings.query ? settings.query : null, // Discard empty strings\n      in    : settings.in,\n      type  : settings.type,\n      owner : settings.owner ? settings.owner : null, // same\n    }\n\n    this.setState({ advancedSearchOpen: false}, \n      () => this.executeSearch(args));\n  }\n\n  render() {\n    const placeholder = this.props.view === 'MY_DOCUMENTS' ?\n      'Search my workspace' : \n      this.props.view === 'SHARED_WITH_ME' ? 'Search shared documents' : '';\n\n    return (\n      <div className=\"wrapper\">\n        <div className=\"search\">\n          <div className=\"wrapper\">\n            <input\n              placeholder={placeholder}\n              value={this.state.query}\n              onChange={this.onSearch} />\n            <button\n              className=\"icon nostyle advanced\"\n              onClick={this.toggleAdvancedSearch.bind(this)}>{'\\ue688'}</button>\n          </div>\n          <span className=\"icon hand-lens\">&#xf002;</span>\n        </div>\n        {this.state.advancedSearchOpen &&\n          <AdvancedSearch \n            account={this.props.account}\n            onSearch={this.advancedSearch}\n            onClose={this.toggleAdvancedSearch}/>\n        }\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport { CSSTransition } from 'react-transition-group';\nimport Breadcrumbs from '../../common/header/Breadcrumbs';\nimport HeaderIcon from '../../common/header/HeaderIcon';\nimport Menu from  '../../common/Menu';\nimport Search from './search/Search';\n\nconst OptionsMenu = props => {\n\n  const canDuplicate = // Single document in my workspace\n    props.selection.isSingleDocument() && props.view === 'MY_DOCUMENTS';\n\n  const canShare = // Single folder in my workspace\n    props.selection.isSingleFolder() && props.view === 'MY_DOCUMENTS';\n\n  const hasNetwork = // Single document with 'has_clones' or 'cloned_from'\n    props.selection.isSingleDocument() &&\n    (props.selection.get(0).has_clones || props.selection.get(0).cloned_from);\n\n  const openInNewTab = () => {\n    window.open(`document/${props.selection.get(0).id}/part/1/edit`, '_blank');\n    props.onCancel();\n  }\n\n  // TODO probably worth splitting this up into a separate source file, or\n  // perhaps two (one OptionsMenu container & one presentational component)\n  return (\n    <Menu \n      className=\"selection-options-menu\"\n      onCancel={props.onCancel}>\n\n      <Menu.Group>\n        <Menu.Item \n          label=\"Open\" \n          disabled={!props.selection.isSingleSelection()} \n          link={props.selection.isSingleSelection() && `document/${props.selection.get(0).id}/part/1/edit`} />\n\n        <Menu.Item \n          label=\"Open in new tab\" \n          disabled={!props.selection.isSingleDocument()} \n          onSelect={openInNewTab} />\n      </Menu.Group>\n      \n      <Menu.Group>\n        <Menu.Item\n          icon={'\\uf114'}\n          label=\"Move to\"\n          onSelect={props.onMoveSelection} />\n\n        <Menu.Item\n          icon={'\\uf0c5'}\n          label=\"Duplicate\"\n          disabled={!canDuplicate}\n          onSelect={props.onDuplicateSelection} />\n\n        <Menu.Item \n          icon={'\\uf014'} \n          label=\"Delete\"\n          onSelect={props.onDeleteSelection} /> \n      </Menu.Group>\n\n      <Menu.Group>\n        <Menu.Item \n          icon={'\\uf234'}\n          label=\"Share\" \n          disabled={!canShare} \n          onSelect={props.onShareSelection} />\n\n        <Menu.Item\n          icon={'\\uf126'} \n          disabled={!hasNetwork}\n          label=\"Explore network\" \n          onSelect={props.onExploreNetwork} />\n      </Menu.Group>\n\n      <Menu.Group>\n        <Menu.Item \n          icon={'\\uf085'} \n          label=\"Named Entity Recognition\" \n          disabled={!props.selection.includesText()} \n          onSelect={props.onNER} />\n      </Menu.Group>\n    </Menu>\n  );\n\n}\n\nexport default class Header extends Component {\n\n  state = {\n    optionsMenuVisible: false\n  }\n\n  showOptionsMenu = () => {\n    this.setState({ optionsMenuVisible: true });\n  }\n\n  closeOptionsMenu = () => {\n    this.setState({ optionsMenuVisible: false });\n  }\n\n  /** Helper that closes the menu and executes a select action **/\n  closeAndThen = fn => {\n    return args => {\n      this.setState({ optionsMenuVisible: false });\n      fn(args);\n    }\n  }\n\n  render() {\n    const hasSelection = !this.props.selection.isEmpty();\n\n    return (\n      <div className={this.props.readme ? \"header\" : \"header no-readme\"}>\n        <div className=\"top-row\">\n          <Search\n            account={this.props.account}\n            view={this.props.view}\n            presentation={this.props.presentation}\n            searchScope={this.props.searchScope}\n            tableConfig={this.props.tableConfig} \n            onResponse={this.props.onSearchResponse} \n            onQuit={this.props.onQuitSearch} />\n\n          <div className=\"header-icons\">\n            <HeaderIcon icon=\"&#xe64a;\" className=\"help stroke7\" link=\"/help\" />\n          </div>\n        </div>\n\n        <div className=\"main-header\">\n          <Breadcrumbs \n            view={this.props.view}\n            path={this.props.breadcrumbs}\n            docCount={this.props.docCount}>\n\n            {!this.props.readme && this.props.view === 'MY_DOCUMENTS' &&\n              <button \n                className=\"add-abstract nostyle\"\n                onClick={this.props.onCreateReadme} >\n                <span className=\"icon\">&#xf055;</span>\n                <span className=\"label\">Add a description...</span>\n              </button>\n            }\n          </Breadcrumbs>\n\n          <div className=\"main-header-icons\">\n           <CSSTransition\n              in={hasSelection} \n              timeout={200} \n              classNames=\"selection-options\">\n\n              <div \n                className=\"selection-options\"\n                onClick={this.showOptionsMenu}>              \n                <span className=\"label\">Options</span>\n                <span className=\"more icon\">&#xf078;</span>\n              </div>\n            </CSSTransition>\n\n            { this.state.optionsMenuVisible &&\n              <OptionsMenu\n                account={this.props.account} \n                view={this.props.view} \n                selection={this.props.selection} \n                onMoveSelection={this.closeAndThen(this.props.onMoveSelection)}\n                onDuplicateSelection={this.closeAndThen(this.props.onDuplicateSelection)}\n                onDeleteSelection={this.closeAndThen(this.props.onDeleteSelection)} \n                onShareSelection={this.closeAndThen(this.props.onShareSelection)}\n                onExploreNetwork={this.closeAndThen(this.props.onExploreNetwork)}\n                onNER={this.closeAndThen(this.props.onNER)}\n                onCancel={this.closeOptionsMenu} /> }\n\n            <HeaderIcon\n              className=\"presentation-toggle stroke7\"\n              icon={this.props.presentation === 'TABLE' ? '\\ue645' : '\\ue636'} \n              onClick={this.props.onTogglePresentation} />\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n}","import React, { Component } from 'react';\nimport Menu from '../../../common/Menu';\nimport IdentityInfo from '../../../common/account/IdentityInfo';\n\nexport default class Account extends Component {\n\n  state = {\n    menuVisible: false \n  };\n\n  openMenu = () => {\n    this.setState({ menuVisible: true });\n  }\n\n  closeMenu = () => {\n    this.setState({ menuVisible: false });\n  }\n\n  render() {\n    return (\n      <div\n        className=\"section account\"\n        onClick={this.openMenu} >\n\n        <IdentityInfo \n          account={this.props.account} />\n\n        { this.state.menuVisible &&\n          <Menu \n            className=\"account-menu\"\n            onCancel={this.closeMenu}>\n\n            <Menu.Group >\n              <Menu.Item icon={'\\uf0ad'} label=\"Account settings\" link=\"/settings/account\" />\n            </Menu.Group>\n            \n            <Menu.Group>\n              <Menu.Item icon={'\\uf128'} label=\"Help\" link=\"/help\" />\n              <Menu.Item icon={'\\uf011'} label=\"Sign out\" link=\"/logout\" />\n            </Menu.Group>\n          </Menu>\n        }\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport Menu from '../../../common/Menu';\n\nexport default class NewContent extends Component {\n\n  state = { \n    menuVisible: false,\n\n  };\n\n  onOpenMenu = () => {\n    this.setState({ menuVisible: true });\n  }\n\n  onCloseMenu = () => {\n    this.setState({ menuVisible: false });\n  }\n\n  onOpenFileExplorer = () => {\n    this._input.click(); // Trigger the hidden file input field\n  }\n\n  onUploadFiles = evt => {\n    const files = Array.from(evt.target.files);\n    this.props.onUploadFiles(files);\n  }\n\n  /** Helper to execute a function after closing the menu **/\n  select = (fn) => {\n    return () => {\n      this.setState({ menuVisible: false });\n      fn();\n    }\n  }\n  \n  hasFeature = name => {\n    return this.props.account.feature_toggles && this.props.account.feature_toggles.includes(name);\n  }\n\n  render() {\n    return (\n      <div className=\"section create-new\">\n        <button\n          className=\"btn create-new\"\n          onClick={this.onOpenMenu}>\n          <span className=\"icon\">&#xf067;</span>\n          <span className=\"label\">New</span>\n        </button>\n        \n        <input\n          ref={c => this._input = c}\n          type=\"file\"\n          name=\"file\"\n          multiple\n          onChange={this.onUploadFiles}\n          style={{ display: 'none' }} />\n\n        {this.state.menuVisible &&\n          <Menu \n            className=\"create-new\"\n            onCancel={this.onCloseMenu}>\n            \n            <Menu.Group>\n              <Menu.Item \n                icon={'\\uf07b'} \n                label=\"Folder\" \n                onSelect={this.select(this.props.onCreateFolder)} />\n\n              <Menu.Item \n                icon={'\\uf15b'} \n                label=\"File upload\" \n                onSelect={this.select(this.onOpenFileExplorer)} />\n            </Menu.Group>\n\n            <Menu.Group>\n              <Menu.Item \n                icon={'\\uf0c1'} \n                label=\"From IIIF manifest\" \n                onSelect={this.select(() => this.props.onImportSource('IIIF'))} />\n\n              <Menu.Item \n                icon={'\\uf121'} \n                label=\"From CTS service\" \n                onSelect={this.select(() => this.props.onImportSource('CTS'))} />\n\n              { this.hasFeature(\"rise\") &&\n                <Menu.Item \n                  icon={'\\uf0f6'} \n                  label=\"From RISE\" \n                  onSelect={this.select(() => this.props.onImportSource('SHINE'))} />\n              }\n            </Menu.Group>\n          </Menu>\n        }\n      </div>\n    )\n  }\n\n}\n","import React from 'react';\n\nconst ViewListItem = props => {\n\n  return (\n    <li\n      className={props.current ? 'current' : null}\n      onClick={props.onClick}>\n      <span className=\"icon\">{props.icon}</span> {\n        props.children\n      }\n    </li>\n  );\n\n}\n\nconst Views = props => {\n  \n  return (\n    <div className=\"section views\">\n      <ul>\n        <ViewListItem\n          icon=\"&#xf2be;\"\n          current={props.view === 'MY_DOCUMENTS'}\n          onClick={() => props.onChangeView('MY_DOCUMENTS')}>\n          My Documents\n        </ViewListItem>\n\n        <ViewListItem\n          icon=\"&#xf064;\"\n          current={props.view === 'SHARED_WITH_ME'}\n          onClick={() => props.onChangeView('SHARED_WITH_ME')}>\n          Shared with me\n        </ViewListItem>\n      </ul>\n    </div>\n  );\n\n}\n\nexport default Views;","import React from 'react';\nimport NumberFormat from 'react-number-format';\nimport Meter from '../../../common/Meter.jsx';\n\nconst Storage = props => {\n\n  const dataAvailable = props.account && props.account.storage;\n  const quota = dataAvailable ? props.account.storage.quota_mb : 0;\n  const used = dataAvailable ? props.account.storage.used_mb : 0;\n\n  return (\n    <div className=\"section storage\">\n      <span className=\"icon\">&#xf1c0;</span> Storage\n      <div className=\"used-diskspace\">\n        <Meter\n          value={(quota > 0) ? Math.min(1, used / quota) : 0} />\n\n        <div className=\"label\">\n          <NumberFormat \n            displayType=\"text\"\n            value={used}\n            thousandSeparator={true} /> \n          {' of  '}\n          <NumberFormat \n            displayType=\"text\"\n            value={quota}\n            thousandSeparator={true} /> MB used\n        </div>\n      </div>\n    </div>\n  );\n\n}\n\nexport default Storage;\n","import React from 'react';\nimport ActivityHistory from '../../../common/account/ActivityHistory';\nimport TopCollaborators from '../../../common/account/TopCollaborators';\n\nconst MyActivity = props => {\n  \n  return (\n    <React.Fragment>\n      <ActivityHistory \n        className=\"section\" \n        width={237}\n        height={55}\n        fill=\"#4483c4\"\n        stats={props.account && props.account.stats} />\n\n      <TopCollaborators \n        className=\"section collaborators\"\n        title=\"My top collaborators\"\n        username={props.account && props.account.username} />\n    </React.Fragment>\n  );\n\n}\n\nexport default MyActivity;","import React from 'react';\nimport Account from './sections/Account';\nimport NewContent from './sections/NewContent';\nimport Views from './sections/Views';\nimport Storage from './sections/Storage';\nimport MyActivity from './sections/MyActivity';\n\nconst Sidebar = props => {\n\n  return (\n    <div className=\"sidebar\">\n      <Account \n        account={props.account} />\n\n      <NewContent \n        account={props.account}\n        onCreateFolder={props.onCreateFolder} \n        onUploadFiles={props.onUploadFiles} \n        onImportSource={props.onImportSource} /> \n\n      <Views\n        view={props.view} \n        onChangeView={props.onChangeView} />\n      \n      <Storage\n        account={props.account} />\n\n      <MyActivity \n        account={props.account} />\n    </div>\n  );\n\n}\n\nexport default Sidebar;\n","import React from 'react';\n\nimport Header from './header/Header';\nimport Readme from '../common/documents/Readme';\nimport Sidebar from './sidebar/Sidebar';\nimport GridPane from '../common/documents/grid/GridPane';\nimport TablePane from '../common/documents/table/TablePane';\n\nconst Workspace = props => {\n\n  return (\n    <React.Fragment>\n      <Sidebar\n        account={props.account}\n        view={props.view}\n        onChangeView={props.onChangeView}\n        onCreateFolder={props.onCreateFolder}\n        onUploadFiles={props.onUploadFiles}\n        onImportSource={props.onImportSource} />\n\n      <div className=\"main-content\">\n        <Header\n          account={props.account}\n          view={props.view}\n          presentation={props.presentation}\n          searchScope={props.searchScope}\n          tableConfig={props.tableConfig}\n          readme={props.page.readme}\n          breadcrumbs={props.page.breadcrumbs}\n          docCount={props.page.total_count}\n          selection={props.selection}\n          onTogglePresentation={props.onTogglePresentation} \n          onCreateReadme={props.onCreateReadme} \n          onMoveSelection={props.onMoveSelection}\n          onDuplicateSelection={props.onDuplicateSelection}\n          onDeleteSelection={props.onDeleteSelection} \n          onShareSelection={props.onShareSelection} \n          onExploreNetwork={props.onExploreNetwork}\n          onNER={props.onNER} \n          onSearchResponse={props.onSearchResponse}\n          onQuitSearch={props.onQuitSearch} />\n\n        { props.page.readme && \n          <Readme\n            content={props.page.readme} \n            onUpdate={props.onUpdateReadme} \n            onDelete={props.onDeleteReadme} />\n        }\n\n        { props.presentation === 'TABLE' &&\n          <TablePane\n            items={props.page.items}\n            config={props.tableConfig}\n            selection={props.selection}\n            busy={props.busy}\n            enableFiledrop={props.view === 'MY_DOCUMENTS'} \n            onSelect={props.onSelect} \n            onSort={props.onSortTable}\n            onChangeColumnConfig={props.onChangeColumnConfig} \n            onRenameFolder={props.onRenameFolder}\n            onDropFiles={props.onUploadFiles} \n            onDropSourceURL={url => props.onImportSource(null, url)} />\n        }\n\n        { props.presentation === 'GRID' &&\n          <GridPane\n            items={props.page.items}\n            selection={props.selection}\n            busy={props.busy}\n            enableFiledrop={props.view !== 'MY_DOCUMENTS'} \n            onSelect={props.onSelect} \n            onDropFiles={props.onUploadFiles} \n            onDropSourceURL={url => props.onImportSource(null, url)} />            \n        }\n      </div>\n    </React.Fragment>\n  );\n\n}\n\nexport default Workspace;","import React, { Component } from 'react';\nimport { render } from 'react-dom';\nimport axios from 'axios';\nimport { Columns } from '../common/documents/table/Columns';\nimport { initialState, persistState } from './initialState';\nimport operations from './operations';\nimport Selection from '../common/documents/Selection';\nimport Workspace from './Workspace';\n\nimport '../../assets/style/workspace/index.scss';\n\nexport default class App extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = initialState();\n\n    this._rootEl = document.getElementById('app');\n    window.onhashchange = this.changeFolder;\n  }\n\n  /** Init: add deselect listeners and load contents */\n  componentDidMount() {\n    this._rootEl.addEventListener('keydown', this.onKeydown, false);\n    this._rootEl.addEventListener('mousedown', this.onMousedown, false);\n\n    // Init account data\n    axios.get('/api/account/my').then(result => { \n      this.setState({ account: result.data }) \n    }).then(() => {\n      this.refreshPage();\n    });\n  }\n\n  /** Remove deselect listeners **/\n  componentWillUnmount() {\n    this._rootEl.removeEventListener('keydown', this.onKeydown, false);\n    this._rootEl.removeEventListener('mousedown', this.onMousedown, false);\n  }\n\n  onKeydown = evt => {\n    if (evt.which === 27) {\n      // Escape clears selection and quits search\n      this.setState({ selection: new Selection() });\n    } else if (evt.which === 46 && !this.state.selection.isEmpty()) {\n      // Delete key\n      this.deleteSelection();\n    }\n  }\n\n  /** Clear selection on click ouside the document pane **/\n  onMousedown = evt => {\n    const isClickOutside = !(\n      document.querySelector('.documents-pane').contains(evt.target) ||\n      document.querySelector('.main-header-icons').contains(evt.target)\n    );\n\n    if (isClickOutside) this.setState({ selection: new Selection() });\n  }\n\n  /** \n   * Refreshes the current page.\n   * \n   * Note that this doesn't work if the view is currently SEARCH.\n   */\n  refreshPage = () => {\n    this.setState({ busy: true });\n\n    const folderId = document.location.hash.substring(1);\n\n    const path = (this.state.view === 'MY_DOCUMENTS') ?\n       (folderId) ? `my/${folderId}` : 'my' :\n       (folderId) ? `my/shared/${folderId}` : 'my/shared';\n\n    const config = this.state.presentation === 'GRID' ? null :\n      {\n        columns: Columns.expandAggregatedColumns(this.state.table_config.columns),\n        sort: this.state.table_config.sorting\n      };\n\n    return axios.post(`/api/directory/${path}`, config).then(result => {\n      this.setState(prev => {\n        const { breadcrumbs, readme, total_count, items } = result.data;\n        return {\n          page : {\n            ...prev.page,\n            ...{\n              breadcrumbs,\n              readme,\n              total_count,\n              items\n            }\n          },\n          busy: false\n        } \n      });\n    });\n  }\n\n  changeFolder = () => {\n    this.setState({ selection: new Selection() }, () => {\n      this.refreshPage();\n    });\n  }\n  \n  changeView = view => {\n    persistState('view', view);\n    this.setState({ \n      view: view,\n      search_scope: null\n    }, this.refreshPage);\n  }\n\n  togglePresentation = () => {\n    this.setState(prev => { \n      const presentation = (prev.presentation === 'TABLE') ? 'GRID' : 'TABLE';\n      persistState('presentation', presentation);\n      return { presentation: presentation };\n    });\n  }\n\n  select = selection => {\n    this.setState({ selection: selection });\n  }\n\n  sortTable = (sorting) => {\n    this.setState(prev => {\n      const config = { ...prev.table_config, ...{ sorting: sorting } };\n      persistState('table_config', config);\n      return { table_config: config };\n    }, () => {\n      this.refreshPage();\n    });      \n  }\n\n  changeColumConfig = columns => {\n    this.setState(prev => { \n      const config = {...prev.table_config, ...{ columns: columns } };\n      persistState('table_config', config);\n      return { table_config: config };\n    });\n  }\n\n  createReadme = () => {\n    this.setState(prev => {\n      return { page: {...prev.page, ...{ readme: true }} }\n    });\n  }\n\n  updateReadme = (readme) => {\n    operations.updateReadme(readme, this.state.page).then(page => {\n      this.setState({ page: page });\n    });\n  }\n\n  deleteReadme = () => {\n    operations.deleteReadme(this.state.page).then(page => {\n      this.setState({ page: page });\n    });\n  }\n\n  moveSelection = () => {\n    operations.moveSelection({\n      view: this.state.view,\n      page: this.state.page,\n      selection: this.state.selection,\n      onComplete: this.refreshPage\n    });\n  }\n\n  duplicateSelection = () => {\n    this.setState({ busy: true });\n    operations.duplicateSelection(this.state.selection)\n      .then(this.refreshPage)\n  }\n\n  deleteSelection = () => {\n    operations.deleteSelection({\n      selection: this.state.selection,\n      view: this.state.view,\n      onStart: () => this.setState({ busy: true }),\n      onSuccess: this.refreshPage,\n      onError:   this.refreshPage\n    });\n  }\n\n  onSearchResponse = response => {\n    this.setState(prev => {\n      return { \n        view: 'SEARCH',\n        search_scope: prev.search_scope ? prev.search_scope : prev.view,\n        page: {\n          breadcrumbs: null,\n          readme: null,\n          total_count: response.total,\n          items: response.items\n        }\n      }\n    });\n  }\n\n  onQuitSearch = () => {\n    this.changeView(this.state.search_scope);\n  }\n\n  render() {\n    return(\n      <Workspace \n        account={this.state.account}\n        view={this.state.view}\n        presentation={this.state.presentation}\n        searchScope={this.state.search_scope}\n        page={this.state.page}\n        tableConfig={this.state.table_config}\n        selection={this.state.selection}\n        busy={this.state.busy}\n        onChangeView={this.changeView}\n        onTogglePresentation={this.togglePresentation}\n        onSelect={this.select}\n        onSortTable={this.sortTable}\n        onChangeColumnConfig={this.changeColumConfig}\n        onCreateReadme={this.createReadme}\n        onUpdateReadme={this.updateReadme}\n        onDeleteReadme={this.deleteReadme}\n        onCreateFolder={() => operations.createFolder().then(this.refreshPage)}\n        onRenameFolder={(folder, title) => operations.renameFolder(folder, title).then(this.refreshPage)}\n        onMoveSelection={this.moveSelection}\n        onDuplicateSelection={this.duplicateSelection}\n        onDeleteSelection={this.deleteSelection}\n        onShareSelection={() => operations.shareSelection(this.state.selection)}\n        onExploreNetwork={() => operations.exploreNetwork(this.state.selection, this.state.account)}\n        onNER={() => operations.entityRecognition(this.state.selection).then(this.refreshPage)}\n        onSearchResponse={this.onSearchResponse}\n        onQuitSearch={this.onQuitSearch}\n        onUploadFiles={files => operations.uploadFiles(files).then(this.refreshPage)}\n        onImportSource={(sourceType, url) => operations.importSource(sourceType, url).then(this.refreshPage)} />\n    )\n  }\n\n}\n\nrender(<App />, document.getElementById('app'));\n","/** Icons for possible content type values **/\nconst ICONS = {\n  TEXT_PLAIN   : 'icon_text.png',\n  TEXT_TEIXML  : 'icon_tei.png',\n  IMAGE_UPLOAD : 'icon_image.png',\n  IMAGE_IIIF   : 'icon_iiif.png',\n  DATA_CSV     : 'icon_csv.png'\n};\n\nexport default class TypeIcons {\n\n  static get = docType => ICONS[docType];\n\n}\n","import React from 'react';\n\nconst HeaderIcon = props => {\n\n  return (\n    <div\n      className={`header-icon ${props.className}`}\n      onClick={props.onClick}>\n      {(props.link) ? \n        <a href={props.link} className=\"icon inner\">\n          {props.icon}\n        </a> :\n\n        <span className=\"icon inner\">\n          {props.icon}\n        </span>\n      }\n    </div>\n  );\n\n}\n\nexport default HeaderIcon;"],"sourceRoot":""}